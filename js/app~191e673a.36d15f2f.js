(window.webpackJsonp=window.webpackJsonp||[]).push([["app~191e673a"],{"0876":function(t,e,i){"use strict";i("4e00")},"0da2":function(t,e,i){"use strict";i("9666")},"1e34":function(t,e,i){"use strict";var s=i("1dce"),a=i("b5ae"),r=i("2f62"),o=i("c1df"),n=i.n(o),d=i("1168"),l=i("2ef0");var c={mixins:[s.validationMixin],name:"NewShiftModal",props:["restaurantItemId","periodDate","shiftList","showModal"],validations:{driver_id:{required:a.required},start_time:{required:a.required},finish_time:{required:a.required},comment:{}},data:()=>({readOnly:!1,localLoading:!1,driver_id:0,start_time:"",finish_time:"",cost_per_hour:"",cost_total:"",cost_bonus:0,const_fuel_bonus:0,cost_extra_bonus:0,extra_request:0,comment:"",restaurant_selected:void 0,area_selected:void 0,is_initialized:!1,start_time_was_clean:!1,finish_time_was_clean:!1}),updated(){if(!this.$props.showModal)return this.restaurant_selected=void 0,this.area_selected=void 0,void(this.is_initialized=!1);this.$props.showModal&&!this.is_initialized&&(this.restaurant_selected=l.find(this.restaurants,t=>t.id==this.$props.restaurantItemId),this.area_selected=l.find(this.areas,t=>t.id==this.restaurant_selected.area_id),this.is_initialized=!0)},computed:{...Object(r.c)(["areas","restaurants","timeList"]),driver_list(){return this.is_initialized?this.$store.getters.drivers:[]},driverListSearched(){if(!this.is_initialized)return[];let t=this.restaurant_selected,e=l.filter(this.driver_list,e=>{if(0==e.area_ids.length)return!0;return-1!==l.map(e.area_ids,t=>t.area_id).indexOf(t.area_id)&&(0==e.restaurant_ids.length||!!l.find(e.restaurant_ids,e=>e.restaurant_id==t.id))});return e.unshift({id:0,full_name:"Open shift"}),e},selectedDriverWorkingDay(){let t=l.find(this.driver_list,t=>t.id==this.$data.driver_id);if(!t)return[];let e=l.filter(t.actual_override_working_time,t=>t.period_date==this.$props.periodDate);if(e.length>0)return e;let i=n()(this.$props.periodDate,"YYYY-MM-DD").isoWeekday()-1;return e=l.filter(t.default_working_time,t=>t.week_day==i),e},selectDriverErrors(){const t=[];if(!this.$v.driver_id.$dirty)return t;let e=l.filter(this.$props.shiftList,t=>t.driver_id==this.$data.driver_id&&t.period_date==this.$props.periodDate&&20==t.status);for(let i=0;i<e.length;i++)if(n()(this.$data.start_time,"HH:mm").format("HH:mm")<n()(this.$data.finish_time,"HH:mm").format("HH:mm")&&(this.isTimeIntersects(e[i].start_time,e[i].finish_time,this.$data.start_time)||this.isTimeIntersects(e[i].start_time,e[i].finish_time,this.$data.finish_time)||this.isTimeIntersects(this.$data.start_time,this.$data.finish_time,e[i].start_time)||this.isTimeIntersects(this.$data.start_time,this.$data.finish_time,e[i].finish_time))){t.push("Driver already have shift on this time");break}if(!l.isEmpty(this.selectedDriverWorkingDay)){let e=l.map(this.selectedDriverWorkingDay,t=>n()(t.start_at,"HH:mm").format("HH:mm")+"-"+n()(t.stop_at,"HH:mm").format("HH:mm")),i=!1,s=!1,a=!1;l.each(this.selectedDriverWorkingDay,t=>{i||s||a||(10==t.holiday&&(i=!0),this.isTimeIntersects(t.start_at,t.stop_at,this.$data.start_time)&&(s=!0),this.isTimeIntersects(t.start_at,t.stop_at,this.$data.finish_time)&&(a=!0))}),i&&t.push("Driver unavailable"),!s&&t.push("Driver working time: "+e.join(", ")),!a&&t.push("Driver working time: "+e.join(", ")),!this.$data.start_time&&t.push("Driver working time: "+e.join(", ")),!this.$data.finish_time&&t.push("Driver working time: "+e.join(", "))}return!this.$v.driver_id.required&&t.push("Driver is required"),t},startTimeErrors(){const t=[];return this.$v.start_time.$dirty?(!this.$v.start_time.required&&t.push("Start Time is required."),!n()(this.$data.start_time,"HH:mm").isValid()&&t.push("Start Time invalid format."),t):t},finishTimeErrors(){const t=[];return this.$v.finish_time.$dirty?(!this.$v.finish_time.required&&t.push("Start Time is required."),!n()(this.$data.finish_time,"HH:mm").isValid()&&t.push("Finish Time invalid format."),t):t},shiftLength:function(){let t=n()(this.$data.finish_time,"HH:mm"),e=n()(this.$data.start_time,"HH:mm");return t.isValid()&&e.isValid()?(this.$data.finish_time<this.$data.start_time&&t.add(1,"days"),((t-e)/6e4/60).toFixed(2)):0},shiftCostPerHour:function(){if(!this.$data.area_selected)return 0;let t=this.$data.restaurant_selected.standard_pay?this.$data.restaurant_selected.standard_pay:this.$data.area_selected.standardPayRate,e=n()(this.$props.periodDate,"YYYY-MM-DD");return 5!==e.isoWeekday()&&6!==e.isoWeekday()&&7!==e.isoWeekday()||(t=this.$data.restaurant_selected.weekend_pay?this.$data.restaurant_selected.weekend_pay:this.$data.area_selected.weekendPayRate),t},shiftCost:function(){return this.is_initialized?(+this.shiftCostPerHour*this.shiftLength+ +this.cost_bonus+ +this.const_fuel_bonus).toFixed(2):0}},methods:{closeDialog(){this.$emit("closeDialog")},submit(){if(this.$v.$touch(),!this.$v.$invalid){this.localLoading=!0,this.$data.cost_per_hour=this.shiftCostPerHour,this.$data.cost_total=this.shiftCost;const t={restaurant_id:this.restaurant_selected.id,driver_id:this.$data.driver_id,status:d.i,status_assigned:this.$data.driver_id?d.f:d.h,period_date:this.$props.periodDate,start_time:this.$data.start_time,finish_time:this.$data.finish_time,meal_time:0,rest_time:0,cost_per_hour:this.$data.cost_per_hour,cost_total:this.$data.cost_total,cost_bonus:this.$data.cost_bonus,const_fuel_bonus:this.$data.const_fuel_bonus,cost_extra_bonus:this.$data.cost_extra_bonus,extra_request:this.$data.extra_request,comment:this.$data.comment};0==t.driver_id&&(t.driver_id=null),this.$store.dispatch("createNewShift",t).then(()=>{this.closeDialog(),this.clear()}).finally(()=>{this.localLoading=!1})}},clear(){this.$v.$reset(),this.driver_id=0,this.start_time="",this.finish_time="",this.cost_bonus=0,this.const_fuel_bonus=0,this.cost_extra_bonus=0,this.extra_request=0,this.comment=""},isTimeIntersects:(t,e,i)=>!!i&&(n()(t,"HH:mm").format("HH:mm")<n()(e,"HH:mm").format("HH:mm")?n()(t,"HH:mm").format("HH:mm")<=n()(i,"HH:mm").format("HH:mm")&&n()(e,"HH:mm").format("HH:mm")>=n()(i,"HH:mm").format("HH:mm"):n()(t,"HH:mm").format("HH:mm")<=n()(i,"HH:mm").format("HH:mm")),onStartTimeFocused:function(){this.start_time||(this.start_time=this.timeToApproximation(n()().format("HH:mm")),this.start_time_was_clean=!0)},onStartTimeChanged:function(){this.$v.start_time.$touch(),this.start_time_was_clean=!1},onStartTimeBlur:function(){this.start_time_was_clean&&(this.start_time=void 0),this.$v.start_time.$touch()},onFinishTimeFocused:function(){this.finish_time||(this.finish_time=this.timeToApproximation(n()().format("HH:mm")),this.finish_time_was_clean=!0)},onFinishTimeChanged:function(){this.$v.finish_time.$touch(),this.finish_time_was_clean=!1},onFinishTimeBlur:function(){this.finish_time_was_clean&&(this.finish_time=void 0),this.$v.finish_time.$touch()},timeToApproximation:function(t){let e=n()(t,"HH:mm:ss");if(!e.isValid())return t;let i=l.find(this.timeList,t=>(n()(t.value,"HH:mm")-e)/36e5>-.125);return i?i.value:t}},filters:{formatDate:function(t){return n()(t,"YYYY-MM-DD").format("MMM Do")}}},_=i("2877"),m=i("6544"),h=i.n(m),u=i("c6a6"),v=i("8336"),f=i("b0af"),p=i("99d9"),g=i("ac7c"),b=i("62ad"),$=i("169a"),y=i("4bd4"),S=i("132d"),k=i("8860"),x=i("da13"),H=i("5d23"),T=i("34c3"),w=i("0fd9"),C=i("8654"),D=i("a844"),L=Object(_.a)(c,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-dialog",{attrs:{width:"700px"},on:{"click:outside":t.closeDialog},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[t.is_initialized?i("v-card",[i("v-card-title",[i("span",{staticClass:"headline"},[t._v("Add a New Shift, "+t._s(t._f("formatDate")(t.periodDate)))]),i("div",{staticClass:"dialog-closeBtn",on:{click:t.closeDialog}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-close")])],1)]),i("v-card-text",{staticClass:"dialog-card_body"},[i("v-row",{attrs:{align:"stretch"}},[i("v-col",{attrs:{xs:"12",sm:"3",md:"3"}},[i("v-row",[i("v-col",[t._v("\n                            Driver info\n                        ")])],1),i("v-row",[i("v-list",{attrs:{nav:"",dense:""}},[i("v-list-item",[i("v-list-item-icon",[i("v-icon",[t._v("mdi-calendar")])],1),i("v-list-item-content",[i("v-list-item-title",[t._v("__")]),i("v-list-item-subtitle",[t._v("Weekly Hours")])],1)],1)],1),i("v-list",{attrs:{nav:"",dense:""}},[i("v-list-item",[i("v-list-item-icon",[i("v-icon",[t._v("mdi-currency-gbp")])],1),i("v-list-item-content",[i("v-list-item-title",[t._v("___£")]),i("v-list-item-subtitle",[t._v("Weekly Cost")])],1)],1)],1),i("v-list",{attrs:{nav:"",dense:""}},[i("v-list-item",[i("v-list-item-icon",[i("v-icon",[t._v("mdi-clock-outline")])],1),i("v-list-item-content",[i("v-list-item-title",[t._v(t._s(t.shiftLength))]),i("v-list-item-subtitle",[t._v("Shift Length")])],1)],1)],1),i("v-list",{attrs:{nav:"",dense:""}},[i("v-list-item",[i("v-list-item-icon",[i("v-icon",[t._v("mdi-account")])],1),i("v-list-item-content",[i("v-list-item-title",[t._v("£"+t._s(t.shiftCost))]),i("v-list-item-subtitle",[t._v("Shift Cost")])],1)],1)],1)],1)],1),i("v-col",{attrs:{xs:"12",sm:"9",md:"9"}},[i("v-form",{ref:"form"},[i("v-row",[i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("v-autocomplete",{attrs:{label:"Select driver","item-text":"full_name","item-value":"id",items:t.driverListSearched,"error-messages":t.selectDriverErrors,required:"",dense:"",solo:""},on:{input:function(e){return t.$v.driver_id.$touch()},blur:function(e){return t.$v.driver_id.$touch()}},model:{value:t.driver_id,callback:function(e){t.driver_id=e},expression:"driver_id"}})],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-autocomplete",{staticClass:"hide-time-picker-indicator",attrs:{type:"time","menu-props":"auto, overflowY","clear-icon":"mdi-close","prepend-icon":"mdi-clock-outline",clearable:"",outlined:"",label:"Start Time*",hint:"Example: 08:00",required:"",items:t.timeList,"item-text":"name","item-value":"value","error-messages":t.startTimeErrors,"open-on-clear":"",dense:""},on:{focus:t.onStartTimeFocused,input:t.onStartTimeChanged,blur:t.onStartTimeBlur},model:{value:t.start_time,callback:function(e){t.start_time=e},expression:"start_time"}})],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-autocomplete",{staticClass:"hide-time-picker-indicator",attrs:{type:"time","menu-props":"auto, overflowY","clear-icon":"mdi-close","prepend-icon":"mdi-clock-outline",clearable:"",outlined:"",label:"Finish Time*",hint:"Example: 18:30",required:"",items:t.timeList,"item-text":"name","item-value":"value","error-messages":t.finishTimeErrors,"open-on-clear":"",dense:""},on:{focus:t.onFinishTimeFocused,input:t.onFinishTimeChanged,blur:t.onFinishTimeBlur},model:{value:t.finish_time,callback:function(e){t.finish_time=e},expression:"finish_time"}})],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-text-field",{attrs:{type:"number","prepend-icon":"mdi-wallet-giftcard",label:"Add Driver Bonus",required:"",outlined:"",dense:""},model:{value:t.cost_bonus,callback:function(e){t.cost_bonus=e},expression:"cost_bonus"}})],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-text-field",{attrs:{type:"number","prepend-icon":"mdi-gas-station",label:"Add Fuel Bonus",required:"",outlined:"",dense:""},model:{value:t.const_fuel_bonus,callback:function(e){t.const_fuel_bonus=e},expression:"const_fuel_bonus"}})],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-text-field",{attrs:{type:"number","prepend-icon":"mdi-wallet-giftcard",label:"Cancellation fee/bonus",hint:"hidden for restaurants",min:"0",required:"",outlined:"",dense:""},model:{value:t.cost_extra_bonus,callback:function(e){t.cost_extra_bonus=e},expression:"cost_extra_bonus"}})],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("span",{staticClass:"adjustment-type"},[t._v("Extra Request")]),i("v-checkbox",{attrs:{"true-value":1,"false-value":0,label:"Yes"},model:{value:t.extra_request,callback:function(e){t.extra_request=e},expression:"extra_request"}})],1),i("v-col",{staticClass:"pb-0",attrs:{cols:"12",sm:"12"}},[i("v-textarea",{attrs:{outlined:"",label:"Comment"},model:{value:t.comment,callback:function(e){t.comment=e},expression:"comment"}})],1),t.area_selected?i("v-col",{staticClass:"pb-0",attrs:{sm:"12"}},[i("v-row",[i("v-col",{staticClass:"d-flex flex-column justify-space-between pa-0 pr-3",staticStyle:{height:"80px"},attrs:{cols:"12",sm:"6"}},[i("span",{staticClass:"adjustment-type"},[t._v("Mon – Thurs Pay/Hr*")]),i("div",{staticClass:"adjustment"},[i("v-text-field",{staticClass:"adjustment-input",attrs:{prefix:"£",readonly:"",outlined:"",value:t.restaurant_selected.standard_pay?t.restaurant_selected.standard_pay:t.area_selected.standardPayRate,required:""}})],1)]),i("v-col",{staticClass:"d-flex flex-column justify-space-between pa-0 pl-3",staticStyle:{height:"80px"},attrs:{cols:"12",sm:"6"}},[i("span",{staticClass:"adjustment-type"},[t._v("Fri-Sun Pay/Hr*")]),i("div",{staticClass:"adjustment"},[i("v-text-field",{staticClass:"adjustment-input",attrs:{prefix:"£",readonly:"",outlined:"",value:t.restaurant_selected.weekend_pay?t.restaurant_selected.weekend_pay:t.area_selected.weekendPayRate,required:""}})],1)])],1)],1):t._e()],1),i("div",{staticClass:"d-flex justify-center"},[i("v-btn",{staticClass:"mr-4 primary",attrs:{depressed:"",disabled:this.$v.$invalid||t.localLoading||t.selectDriverErrors.length>0,loading:t.localLoading},on:{click:t.submit}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-upload")]),t._v("Create Shift")],1),i("v-btn",{staticClass:"mr-4",attrs:{loading:t.localLoading,depressed:""},on:{click:t.clear}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-rotate-left")]),t._v("Clear")],1),i("v-btn",{staticClass:"mr-4 warning",attrs:{loading:t.localLoading,depressed:""},on:{click:t.closeDialog}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-cancel")]),t._v("Cancel")],1)],1)],1)],1)],1)],1)],1):t._e()],1)}),[],!1,null,null,null);e.a=L.exports;h()(L,{VAutocomplete:u.a,VBtn:v.a,VCard:f.a,VCardText:p.b,VCardTitle:p.c,VCheckbox:g.a,VCol:b.a,VDialog:$.a,VForm:y.a,VIcon:S.a,VList:k.a,VListItem:x.a,VListItemContent:H.a,VListItemIcon:T.a,VListItemSubtitle:H.b,VListItemTitle:H.c,VRow:w.a,VTextField:C.a,VTextarea:D.a})},"1f4e":function(t,e,i){"use strict";var s=i("c1df"),a=i.n(s),r=i("2b0e"),o=i("2ef0"),n=i("2f62"),d=i("156f"),l=i("1168");var c={name:"ConfirmDialog",props:["messageText","pushDrivers"],data:()=>({dialog:!1,push_drivers:!0}),created(){this.push_drivers=20!=this.pushDrivers},methods:{submit(){this.dialog=!1,this.$emit("successClick",{push_drivers:this.push_drivers?10:20})}}},_=i("2877"),m=i("6544"),h=i.n(m),u=i("8336"),v=i("b0af"),f=i("99d9"),p=i("62ad"),g=i("169a"),b=i("132d"),$=i("0fd9"),y=i("b73d"),S=Object(_.a)(c,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-dialog",{attrs:{width:"450px"},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on;return[i("span",t._g({},s),[t._t("default")],2)]}}],null,!0),model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[t.dialog?i("v-card",[i("v-card-title",[i("span",{staticClass:"headline"},[t._v(t._s(t.messageText))]),i("div",{staticClass:"dialog-closeBtn",on:{click:function(e){t.dialog=!1}}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-close")])],1)]),i("v-card-text",[i("v-row",[i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("v-switch",{attrs:{label:"Send push message to drivers"},model:{value:t.push_drivers,callback:function(e){t.push_drivers=e},expression:"push_drivers"}})],1)],1),i("v-row",[i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("div",{staticClass:"d-flex justify-center"},[i("v-btn",{staticClass:"mr-4 primary",attrs:{depressed:""},on:{click:t.submit}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-content-copy")]),t._v("Confirm")],1),i("v-btn",{staticClass:"warning",attrs:{depressed:""},on:{click:function(e){t.dialog=!1}}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-cancel")]),t._v("Cancel")],1)],1)])],1)],1)],1):t._e()],1)}),[],!1,null,"0b10f3f4",null),k=S.exports;h()(S,{VBtn:u.a,VCard:v.a,VCardText:f.b,VCardTitle:f.c,VCol:p.a,VDialog:g.a,VIcon:b.a,VRow:$.a,VSwitch:y.a});var x={name:"Schedule",components:{"confirm-dialog":k},props:["restaurantId"],data:()=>({is_prod:!0,scroll_panel_height:window.innerHeight-122,TYPE_AREA:d.b,TYPE_RESTAURANT:d.c,STATUS_NEW:l.i,STATUS_PUBLICATED:l.j,STATUS_DRAFT:l.g,STATUS_FREE:l.h,STATUS_STALE:l.k,STATUS_ASSIGNED:l.f,INTERVAL_DAY:l.b,INTERVAL_WEEK:l.e,INTERVAL_TWO_WEEK:l.d,INTERVAL_MONTH:l.c,interval_list:[{id:l.b,name:"Day",$isDisabled:!0},{id:l.e,name:"Week"},{id:l.d,name:"2-Week"},{id:l.c,name:"Month"}],date_range_selected:null,menu_date_picker:!1,showOnlyUnavailable:!1,thisRestaurantId:null,localLoading:!1,publishPeriodLoading:!1,restaurant_selected_index:0,location_selected:void 0,interval_selected_id:l.e,selected_driver:void 0,search_driver:"",shift_to_copy:void 0,driver_list_calc:{},filter_empty_restaurants:!1,totals:{total_shifts:0,filled_hours:0,estimated_cost:0,expected_sales:0,published:0,draft:0,unpublished:0,free:0},restaurant_item_id:void 0,period_item_date:void 0,showNewShiftDialog:!1,showLoader:!1,attrs:{class:"mb-6",boilerplate:!0,elevation:2},bodyScrollLeft:0,is_mobile_version:!1,location_mobile_selected:void 0,restaurant_item_mobile_selected:void 0,period_list_loading:{}}),computed:{...Object(n.c)(["areas","locations","restaurants","drivers"]),locations_list(){return this.locations},restaurant_list(){return o.filter(this.restaurants,t=>10==t.status)},restaurantListOnlyLocSearched(){let t=this.restaurant_list;if(this.$data.location_selected)switch(this.$data.location_selected.type){case d.b:t=o.filter(t,t=>t.area_id==this.$data.location_selected.id);break;case d.c:t=[o.find(t,t=>t.id==this.$data.location_selected.id)]}return t},restaurantListSearched(){let t=this.restaurant_list;if(this.$data.location_selected)switch(this.$data.location_selected.type){case d.b:t=o.filter(t,t=>t.area_id==this.$data.location_selected.id);break;case d.c:t=[o.find(t,t=>t.id==this.$data.location_selected.id)]}if(this.selected_driver){if(!o.isEmpty(this.selected_driver.area_ids)){let e=o.map(this.selected_driver.area_ids,t=>t.area_id);t=o.filter(t,t=>-1!==e.indexOf(t.area_id))}if(!o.isEmpty(this.selected_driver.restaurant_ids)){let e=o.map(this.selected_driver.restaurant_ids,t=>t.restaurant_id);t=o.filter(t,t=>-1!==e.indexOf(t.id))}this.filter_empty_restaurants&&(t=o.filter(t,t=>!!o.find(this.shift_list,e=>e.restaurant_id==t.id&&(-2==this.selected_driver.id?e.status_assigned==l.h||e.status_assigned==l.k:this.selected_driver.id==e.driver_id))))}return t},driver_list(){return this.drivers},driverListSearched(){let t=o.map(this.driver_list,t=>t);if(this.$data.search_driver&&(t=o.filter(t,t=>-1!==t.full_name.toLowerCase().indexOf(this.$data.search_driver))),this.$data.location_selected){let e=o.map(this.restaurantListOnlyLocSearched,t=>+t.area_id);t=o.filter(t,t=>{let i=o.map(t.area_ids,t=>t.area_id);return o.intersection(e,i).length>0})}if(0==t.length||t.length>0&&null!==t[0].id){let e={id:-1,full_name:"All drivers ["+t.length+"]"},i={id:-2,full_name:"Open shifts"};t.unshift(i),t.unshift(e)}return t},shift_list(){return this.$store.getters.shifts},shiftListSearched(){let t=this.shift_list;if(void 0!==this.$data.location_selected){let e;o.map(this.restaurantListSearched,t=>+t.id);10===this.location_selected.type?(e=o.uniq(o.map(this.restaurantListSearched,t=>+t.area_id)),e&&e.length||(e=this.location_selected.id),e=e.length?e[0]:e):(e=o.uniq(o.map(this.restaurantListSearched,t=>+t.id)),e&&e.length||(e=this.location_selected.id),e.length&&(e=e[0])),t=10!==this.location_selected.type?o.filter(t,t=>e==t.restaurant_id):o.filter(t,t=>e==this.areaIdFromRestaurantId(+t.restaurant_id))}return t=o.filter(t,t=>t.status!=l.g),t},shiftListDriverSearched(){let t=this.shiftListSearched;return void 0!==this.$data.selected_driver&&(t=-2==this.$data.selected_driver.id?o.filter(t,t=>t.status_assigned==l.h||t.status_assigned==l.k):o.filter(t,t=>t.driver_id==this.$data.selected_driver.id)),t},area_list(){return this.$store.getters.areas},period_list(){if(!this.$data.date_range_selected)return;let t=this.driver_list;if(this.$data.location_selected){let e=o.map(this.restaurantListOnlyLocSearched,t=>+t.area_id);t=o.filter(t,t=>{let i=o.map(t.area_ids||[],t=>t.area_id);return o.intersection(e,i).length>0})}let e=this.shiftListDriverSearched,i=a()(this.$data.date_range_selected[0],"YYYY-MM-DD"),s=0,r=[];for(;i.format("YYYY-MM-DD")<=this.$data.date_range_selected[1];){if(31==s){alert("Invalid date range: "+this.$data.date_range_selected[0]+" ~ "+this.$data.date_range_selected[1]);break}let n=i.format("YYYY-MM-DD"),d=o.groupBy(o.filter(e,t=>t.period_date==n),"restaurant_id"),l=t.map(t=>{let e=this.getDriverWorkingDay(t,n),i=this.checkDriverShifts(t.id,n);return{driver:t,working_days:e.length>0?o.map(e,t=>10==t.holiday?"Driver unavailable":"Unavailable time: "+a()(t.start_at,"HH:mm").format("HH:mm")+"-"+a()(t.stop_at,"HH:mm").format("HH:mm")):[""],shift_details:i}}),c={date:n,restaurant_shifts:d,driver_working_time:l};r.push(c),i.add(1,"days"),s++}return r},unpublishedShifts(){return o.filter(this.shiftListDriverSearched,t=>t.status==l.i).length},publishedShifts(){return o.filter(this.shiftListDriverSearched,t=>t.status==l.j).length},freeShifts(){return o.filter(this.shiftListDriverSearched,t=>!t.driver_id).length}},watch:{shiftListSearched:function(t){this.$data.totals.total_shifts=t.length,this.$data.totals.filled_hours=0,this.$data.totals.estimated_cost=0,this.$data.totals.expected_sales=0,this.$data.totals.published=0,this.$data.totals.draft=0,this.$data.totals.unpublished=0,this.$data.totals.free=0;let e=[];for(let i=0;i<t.length;i++)e[i]=this.getShiftHours(t[i]),this.$data.totals.filled_hours+=e[i],t[i].status==l.j?(this.$data.totals.estimated_cost+=+t[i].cost_total,this.$data.totals.published+=1):t[i].status==l.g?this.$data.totals.draft+=1:this.$data.totals.unpublished+=1,t[i].status_assigned!=l.h&&t[i].status_assigned!=l.k||(this.$data.totals.free+=1),this.$data.totals.expected_sales+=+t[i].cost_total;let i=this.driverListSearched;for(let s=0;s<i.length;s++){let a={cost:0,hours:0,shifts:0};for(let r=0;r<t.length;r++)(t[r].driver_id==i[s].id&&t[r].status_assigned!=l.k||(null==t[r].driver_id||t[r].status_assigned==l.k)&&-2==i[s].id)&&(a.cost=+a.cost+ +t[r].cost_total,
//! cost_bonus and const_fuel_bonus already attached into cost_total
//! cost_extra_bonus already attached into cost_total
a.hours=+a.hours+e[r],a.shifts=a.shifts+1);this.$data.driver_list_calc[i[s].id]=a}}},mounted(){if(this.$nextTick(()=>{window.addEventListener("resize",this.onResize)}),this.showLoader=!0,Promise.all([this.$store.dispatch("fetchLocations"),this.$store.dispatch("fetchDrivers")]).then(()=>{let t=localStorage.getItem("redirrected_from_restaurants");if(localStorage.setItem("redirrected_from_restaurants",void 0),t&&"undefined"!==t){let e=o.find(this.locations_list,e=>+e._guid.id==+t&&e._guid.type==d.c);e&&(this.$data.location_selected=e._guid)}let e=a()();this.$data.date_range_selected=[e.startOf("isoWeek").format("YYYY-MM-DD"),null],this.dateRangeSelect()}),!this.restaurant_item_mobile_selected&&this.locations_list.length>0){let t=o.find(this.locations_list,t=>t._guid.type==d.c);this.location_mobile_selected=t,this.onSelectRestaurantMobile(this.location_mobile_selected._guid)}this.$store.dispatch("user/fetchUsers"),this.$store.dispatch("fetchRestaurateurs")},beforeDestroy(){window.removeEventListener("resize",this.onResize)},created(){let t=!1;var e;e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),this.is_mobile_version=t,this.restaurantId&&(this.thisRestaurantId=this.restaurantId)},methods:{filteredDriverList(t){if(this.showOnlyUnavailable){const e=t.filter(t=>t.working_days.includes("Driver unavailable")||t.working_days.some(t=>t.startsWith("Unavailable time:")));return e.length>0?e:null}return t},checkDriverShifts(t,e){const i=this.shift_list.filter(i=>i.driver_id===t&&i.period_date===e);return 0===i.length?[]:i.map(t=>{const e=this.restaurant_list.find(e=>e.id===t.restaurant_id);return`${e?e.name:"Unknown Restaurant"}: ${a()(t.start_time,"HH:mm").format("HH:mm")} - ${a()(t.finish_time,"HH:mm").format("HH:mm")}`})},isDriverUnavailableOrHasShift(t,e){const i=this.getDriverWorkingDay(t,e).some(t=>10==t.holiday),s=this.shift_list.some(i=>i.driver_id===t.id&&i.period_date===e);return i||s},areaIdFromRestaurantId(t){let e=null;return this.locations_list.forEach(i=>{i.area_id?t==i.id&&(e=i.area_id):t==i.id&&(e=t)}),e},showNewShift(t,e){this.restaurant_item_id=t,this.period_item_date=e,this.showNewShiftDialog=!0},onResize(){this.scroll_panel_height=window.innerHeight-122},dateRangeSelect(){this.showLoader=!0,this.$data.date_range_selected=this.dayToRange(this.$data.date_range_selected[0],this.$data.interval_selected_id),this.$store.dispatch("fetchShifts",{period_date_from:this.$data.date_range_selected[0],period_date_to:this.$data.date_range_selected[1],with_timesheet:"1",filter_draft:"1"}).finally(()=>{this.showLoader=!1})},getDriverFullName:function(t){if(t.status_assigned==l.h)return"Open shift";let e=o.find(this.driver_list,e=>e.id==t.driver_id);return e?e.full_name:"-"},getDriverPhone:function(t){if(a()(t.period_date).format("YYYY-MM-DD")!=a()().format("YYYY-MM-DD"))return;let e=o.find(this.driver_list,e=>e.id==t.driver_id);return e?e.phone:void 0},onSelectInterval:function(){if(this.$data.interval_selected_id==l.e||this.$data.interval_selected_id==l.d||this.$data.interval_selected_id==l.c){let t=a()(this.$data.date_range_selected[0],"YYYY-MM-DD");this.$data.date_range_selected=[t.startOf("isoWeek").format("YYYY-MM-DD"),null]}if(this.$data.interval_selected_id==l.b){let t=a()();this.$data.date_range_selected=[t.format("YYYY-MM-DD"),null]}r.a.nextTick(()=>{this.dateRangeSelect()})},onSelectRestaurantMobile:function(t){if(!t)return void(this.restaurant_item_mobile_selected=void 0);let e=void 0;switch(t.type){case d.b:break;case d.c:e=o.find(this.restaurant_list,e=>e.id==t.id)}this.restaurant_item_mobile_selected=e,this.location_selected=t},onPreviosRange:function(){let t=a()(this.$data.date_range_selected[0],"YYYY-MM-DD");switch(this.$data.interval_selected_id){case l.b:t.subtract(1,"days");break;case l.e:t.subtract(1,"weeks");break;case l.d:t.subtract(2,"weeks");break;case l.c:t.subtract(1,"months")}this.$data.date_range_selected=[t.format("YYYY-MM-DD"),null],this.dateRangeSelect()},onNextRange:function(){let t=a()(this.$data.date_range_selected[0],"YYYY-MM-DD");switch(this.$data.interval_selected_id){case l.b:t.add(1,"days");break;case l.e:t.add(1,"weeks");break;case l.d:t.add(2,"weeks");break;case l.c:t.add(1,"months")}this.$data.date_range_selected=[t.format("YYYY-MM-DD"),null],this.dateRangeSelect()},onChangeDriver:function(t){-1==t.id?r.a.nextTick(()=>{this.$data.selected_driver=void 0}):r.a.nextTick(()=>{this.$data.selected_driver&&this.$data.selected_driver.id==t.id?this.$data.selected_driver=void 0:this.$data.selected_driver=t})},removeShift:function(t){confirm("Remove shift "+t.period_date+"?")&&(t.localLoading=!0,this.$store.dispatch("removeShift",t).then(()=>{}).finally(()=>{t.localLoading=!1}),this.$data.shift_to_copy=void 0)},copyShift:function(t){this.$data.shift_to_copy=t},pasteShift:function(t,e){let i=this.getShiftHours(this.$data.shift_to_copy),s=o.find(this.area_list,e=>e.id==t.area_id),r=t.standard_pay?t.standard_pay:s.standardPayRate,n=a()(e.date,"YYYY-MM-DD");5!==n.isoWeekday()&&6!==n.isoWeekday()&&7!==n.isoWeekday()||(r=t.weekend_pay?t.weekend_pay:s.weekendPayRate);let d=(+r*i).toFixed(2);const c={restaurant_id:t.id,//!
driver_id:this.$data.shift_to_copy.driver_id?this.$data.shift_to_copy.driver_id:void 0,status:l.i,status_assigned:l.h,period_date:e.date,//!
start_time:this.$data.shift_to_copy.start_time,finish_time:this.$data.shift_to_copy.finish_time,meal_time:0,rest_time:0,cost_per_hour:r,//!
cost_total:d,//!
comment:this.$data.shift_to_copy.comment,cost_bonus:0,const_fuel_bonus:0,cost_extra_bonus:0};if(c.driver_id){let t=o.find(this.driver_list,t=>t.id==c.driver_id),e=this.getDriverWorkingDay(t,c.period_date);if(t&&!o.isEmpty(e)){let i=!1,s=!1,r=!1;if(o.each(e,t=>{i||s||r||(10==t.holiday&&(i=!0),this.isTimeIntersects(t.start_at,t.stop_at,this.$data.start_time)&&(s=!0),this.isTimeIntersects(t.start_at,t.stop_at,this.$data.finish_time)&&(r=!0))}),i||!s||!r){let s="Driver "+t.full_name+" unavailable at "+c.period_date;if(!i){let i=o.map(e,t=>a()(t.start_at,"HH:mm").format("HH:mm")+"-"+a()(t.stop_at,"HH:mm").format("HH:mm"));s="\r\nDriver "+t.full_name+" working time: "+i.join(", ")+" at "+shift.period_date}if(!confirm(s+"\r\n\r\n Paste Open shift?"))return;c.driver_id=void 0}}}e.localLoading=!0,this.localLoading=!0;let _=!window.event.shiftKey;this.$store.dispatch("createNewShift",c).then(()=>{_&&(this.$data.shift_to_copy=void 0)}).finally(()=>{e.localLoading=!1,this.localLoading=!1})},changeShiftStatus:function(t,e,i){if(t.driver_id){let e=o.find(this.driver_list,e=>e.id==t.driver_id),i=this.getDriverWorkingDay(e,t.period_date);if(e&&!o.isEmpty(i)){let s=!1,r=!1,n=!1;if(o.each(i,t=>{s||r||n||(10==t.holiday&&(s=!0),this.isTimeIntersects(t.start_at,t.stop_at,this.$data.start_time)&&(r=!0),this.isTimeIntersects(t.start_at,t.stop_at,this.$data.finish_time)&&(n=!0))}),s||!r||!n){let r="Driver "+e.full_name+" unavailable at "+t.period_date;if(!s){let s=o.map(i,t=>a()(t.start_at,"HH:mm").format("HH:mm")+"-"+a()(t.stop_at,"HH:mm").format("HH:mm"));r="\r\nDriver "+e.full_name+" working time: "+s.join(", ")+" at "+t.period_date}return void alert(r)}}}t.status=e,this.localLoading=!0,t.localLoading=!0,t.push_drivers=void 0,i&&i.push_drivers&&(t.push_drivers=i.push_drivers),this.$store.dispatch("editShift",t).then(()=>{}).finally(()=>{this.localLoading=!1,t.localLoading=!1}),this.$data.shift_to_copy=void 0},publishPeriodShifts(t){let e=o.filter(this.shiftListDriverSearched,t=>t.status==l.i),i=[],s=o.filter(e,t=>{if(!t.driver_id)return!0;let e=o.find(this.driver_list,e=>e.id==t.driver_id);if(!e)return!0;let s=this.getDriverWorkingDay(e,t.period_date);if(o.isEmpty(s))return!0;let r=o.map(s,t=>a()(t.start_at,"HH:mm").format("HH:mm")+"-"+a()(t.stop_at,"HH:mm").format("HH:mm")),n=!1,d=!1,l=!1;return o.each(s,t=>{n||d||l||(10==t.holiday&&(n=!0),this.isTimeIntersects(t.start_at,t.stop_at,this.$data.start_time)&&(d=!0),this.isTimeIntersects(t.start_at,t.stop_at,this.$data.finish_time)&&(l=!0))}),n?i.push("Driver "+e.full_name+" unavailable at "+t.period_date):d&&l||i.push("Driver "+e.full_name+" working time: "+r.join(", ")+" at "+t.period_date),!(n||!d||!l)});if(i.length>0){let t=e.length-s.length;if(!confirm("Some driver unvalilable on published shifts("+t+"):\r\n"+i.join("\r\n")+"\r\n\r\nSkip to publish incorrect shifts and publish correct shifts?"))return}0!=s.length?(this.localLoading=!0,this.publishPeriodLoading=!0,o.each(s,t=>{t.localLoading=!0}),this.$store.dispatch("publishShifts",{shifts:s,options:t}).then(()=>{}).finally(()=>{this.localLoading=!1,this.publishPeriodLoading=!1,o.each(s,t=>{t.localLoading=!1})}),this.$data.shift_to_copy=void 0):alert("No more shifts to publish")},unpublishPeriodShifts(t){let e=o.filter(this.shiftListDriverSearched,t=>t.status==l.j);this.localLoading=!0,this.publishPeriodLoading=!0,o.each(e,t=>{t.localLoading=!0}),this.$store.dispatch("unpublishShifts",{shifts:e,options:t}).then(()=>{}).finally(()=>{this.localLoading=!1,this.publishPeriodLoading=!1,o.each(e,t=>{t.localLoading=!1})}),this.$data.shift_to_copy=void 0},removePeriodShifts(t){let e=o.filter(this.shiftListDriverSearched,t=>t.status==l.i);this.localLoading=!0,this.publishPeriodLoading=!0,o.each(e,t=>{t.localLoading=!0}),this.$store.dispatch("removeShifts",{shifts:e,options:t}).then(()=>{}).finally(()=>{this.localLoading=!1,this.publishPeriodLoading=!1,o.each(e,t=>{t.localLoading=!1})}),this.$data.shift_to_copy=void 0},getDriverWorkingDay(t,e){let i=o.filter(t.actual_override_working_time,t=>t.period_date==e);if(i.length>0)return i;let s=a()(e,"YYYY-MM-DD").isoWeekday()-1;return i=o.filter(t.default_working_time,t=>t.week_day==s),i},dayToRange:function(t,e){return l.a.dayToRange(t,e)},dateRangeText:function(t){return l.a.dateRangeText(t)},getShiftHours:function(t){let e=a()(t.finish_time,"HH:mm"),i=a()(t.start_time,"HH:mm");return e.isValid()&&i.isValid()?(t.finish_time<t.start_time&&e.add(1,"days"),(e-i)/6e4/60):0},isTimeIntersects:(t,e,i)=>!!i&&(a()(t,"HH:mm").format("HH:mm")<a()(e,"HH:mm").format("HH:mm")?a()(t,"HH:mm").format("HH:mm")<=a()(i,"HH:mm").format("HH:mm")&&a()(e,"HH:mm").format("HH:mm")>=a()(i,"HH:mm").format("HH:mm"):a()(t,"HH:mm").format("HH:mm")<=a()(i,"HH:mm").format("HH:mm")),onScrollPanel(t){this.bodyScrollLeft=t.target.scrollLeft}},filters:{formatFloat:function(t){return Number(t).toFixed(2)},formatHours:function(t){return Number(t).toFixed(1)},headerData:function(t){return a()(t,"YYYY-MM-DD").format("ddd, MMM Do")},moment:function(t){return a()(t,"YYYY-MM-DD").format("MMM Do")},formatTime:function(t){return a()(t,"HH:mm").format("HH:mm")}}},H=(i("0876"),i("0da2"),i("40dc")),T=i("c6a6"),w=i("2e4b"),C=i("ce7e"),D=i("ce87"),L=i("8860"),I=i("da13"),E=i("8270"),V=i("5d23"),A=i("e449"),Y=i("f774"),R=i("b974"),M=i("3129"),P=i("2fa4"),U=i("8654"),q=i("71d9"),j=i("3a2f"),N=Object(_.a)(x,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-row",{attrs:{dense:""}},[t.is_mobile_version?t._e():i("v-col",{staticClass:"pt-0 pl-1 pr-1 pb-0"},[i("v-card",{staticStyle:{"margin-bottom":"6px"},attrs:{color:"grey lighten-4",flat:"",tile:""}},[i("v-app-bar",{staticStyle:{"margin-top":"70px"},attrs:{dense:"",fixed:"",color:"elevation-1"}},[i("v-row",{attrs:{"no-gutters":""}},[i("v-col",{staticClass:"d-flex pa-0"},[i("v-autocomplete",{staticStyle:{"max-width":"340px"},attrs:{items:t.locations_list,"item-text":"name","item-value":"_guid",label:"All locations",dense:"",solo:"",clearable:"","hide-details":""},scopedSlots:t._u([{key:"selection",fn:function(e){return[i("div",[i("div",{domProps:{innerHTML:t._s(e.item.name)}})])]}},{key:"item",fn:function(e){return[e.item._guid.type==t.TYPE_AREA?[i("div",{staticClass:"select-drop-item-group__area"},[i("div",{domProps:{innerHTML:t._s(e.item.name)}})])]:[i("div",{staticClass:"select-drop-item-sub_restaurant"},[i("div",{domProps:{innerHTML:t._s(e.item.name)}})])]]}}],null,!1,1090052647),model:{value:t.location_selected,callback:function(e){t.location_selected=e},expression:"location_selected"}}),i("div",{staticStyle:{"margin-left":"16px"}},[i("v-btn",{on:{click:t.onPreviosRange}},[i("v-icon",[t._v("mdi-menu-left")])],1),i("v-menu",{attrs:{transition:"scale-transition","close-on-content-click":!1,"nudge-width":200,"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on;return[i("v-btn",t._g({},s),[t._v("\n                    "+t._s(t.dateRangeText(t.date_range_selected))+"\n                  ")])]}}],null,!1,1263868741),model:{value:t.menu_date_picker,callback:function(e){t.menu_date_picker=e},expression:"menu_date_picker"}},[i("v-card",{attrs:{"max-width":"346px"}},[i("v-date-picker",{attrs:{scrollable:"",actions:"","full-width":"","first-day-of-week":"1",range:"","title-date-format":t.dateRangeText,"hide-details":""},on:{"click:date":t.dateRangeSelect},model:{value:t.date_range_selected,callback:function(e){t.date_range_selected=e},expression:"date_range_selected"}}),i("v-divider")],1)],1),i("v-btn",{on:{click:t.onNextRange}},[i("v-icon",[t._v("mdi-menu-right")])],1)],1),i("v-select",{staticStyle:{"max-width":"150px","margin-left":"16px"},attrs:{items:t.interval_list,"item-text":"name","item-value":"id",dense:"",solo:"","hide-details":""},on:{change:t.onSelectInterval},model:{value:t.interval_selected_id,callback:function(e){t.interval_selected_id=e},expression:"interval_selected_id"}})],1)],1),i("v-spacer"),i("div",[i("copy-shifts-modal",{attrs:{shiftList:t.shiftListDriverSearched,intervalId:t.interval_selected_id,dateRangeSelected:t.date_range_selected}}),i("confirm-dialog",{attrs:{messageText:"Publish "+t.unpublishedShifts+" Shift(s)?"},on:{successClick:t.publishPeriodShifts}},[i("v-btn",{staticClass:"blue lighten-3 ml-2",attrs:{loading:t.publishPeriodLoading}},[i("v-icon",[t._v("mdi-post")]),t._v(" Publish Shifts ["+t._s(t.unpublishedShifts)+"]\n            ")],1)],1),i("v-menu",{attrs:{"offset-y":"",left:""},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on,a=e.attrs;return[i("v-btn",t._g(t._b({staticClass:"blue lighten-3 pl-1 pr-1"},"v-btn",a,!1),s),[i("v-icon",[t._v("mdi-menu-down")])],1)]}}],null,!1,374402072)},[i("v-list",{attrs:{dense:""}},[i("confirm-dialog",{attrs:{messageText:"Unpublish "+t.publishedShifts+" shifts?"},on:{successClick:t.unpublishPeriodShifts}},[i("v-list-item",[i("v-list-item-title",{staticClass:"pointer"},[i("v-icon",{attrs:{left:""}},[t._v("mdi-eye-minus-outline")]),t._v("Unpublish Shifts ["+t._s(t.publishedShifts)+"]")],1)],1)],1),i("confirm-dialog",{attrs:{messageText:"Remove unpublished "+t.unpublishedShifts+" shifts?"},on:{successClick:t.removePeriodShifts}},[i("v-list-item",[i("v-list-item-title",{staticClass:"pointer"},[i("v-icon",{attrs:{left:""}},[t._v("mdi-close")]),t._v("Delete Unpublished Shifts ["+t._s(t.unpublishedShifts)+"]")],1)],1)],1)],1)],1)],1)],1)],1),i("div",{staticClass:"d-flex mb-auto",attrs:{flat:"",tile:""}},[i("v-navigation-drawer",{staticStyle:{"margin-top":"122px"},attrs:{permanent:"",clipped:"",left:"",fixed:"",width:"256",height:t.scroll_panel_height},scopedSlots:t._u([{key:"prepend",fn:function(){return[i("v-row",{staticClass:"pt-1"},[i("v-col",[i("v-card",{staticClass:"d-flex justify-space-between",attrs:{flat:"",tile:""}},[i("v-text-field",{attrs:{label:"Search","hide-details":"","append-outer-icon":"mdi-magnify",dense:"",clearable:""},model:{value:t.search_driver,callback:function(e){t.search_driver=e},expression:"search_driver"}}),i("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on;return[i("v-btn",t._g({staticClass:"dropdown-menu-activator",attrs:{tile:"",color:t.filter_empty_restaurants?"orange":"",disabled:!t.selected_driver,text:""}},s),[i("v-icon",[t._v("mdi-filter")]),i("v-icon",[t._v("mdi-menu-down")])],1)]}}],null,!1,2015559810)},[i("v-list",[i("v-list-item",{staticClass:"pointer"},[i("v-list-item-title",{on:{click:function(e){t.filter_empty_restaurants=!t.filter_empty_restaurants}}},[t.filter_empty_restaurants?[i("v-icon",{attrs:{color:"orange"}},[t._v("mdi-eye-minus-outline")]),t._v("\n                          Show restaurants with shifts\n                        ")]:t._e(),t.filter_empty_restaurants?t._e():[i("v-icon",[t._v("mdi-eye-check")]),t._v("\n                          Show restaurants with shifts\n                        ")]],2)],1)],1)],1)],1)],1)],1)]},proxy:!0}],null,!1,2420875052)},[i("v-divider"),i("v-list",{staticClass:"driver-list_leftpanel",attrs:{dense:""}},t._l(t.driverListSearched,(function(e,s){return i("v-list-item",{key:s,attrs:{"input-value":t.selected_driver&&t.selected_driver.id==e.id,color:"primary"},on:{click:function(i){return t.onChangeDriver(e)}}},[i("v-list-item-content",[i("v-list-item-title",{domProps:{innerHTML:t._s(e.full_name)}}),i("v-list-item-title",{domProps:{innerHTML:t._s(e.phone)}}),-1!=e.id&&t.driver_list_calc&&t.driver_list_calc[e.id]?i("v-list-item-subtitle",[t._v("["+t._s(t.driver_list_calc[e.id].shifts)+"] "+t._s(t._f("formatHours")(t.driver_list_calc[e.id].hours))+"Hrs/£"+t._s(t._f("formatFloat")(t.driver_list_calc[e.id].cost)))]):t._e()],1)],1)})),1)],1),i("v-app-bar",{staticClass:"d-flex",staticStyle:{"margin-top":"120px","margin-left":"256px","z-index":"3"},style:"left: -"+t.bodyScrollLeft+"px",attrs:{color:"white elevation-0",fixed:"",height:"auto"}},[i("v-card",{staticClass:"calendar-v-card-header",class:{"v-card-header-day":t.interval_selected_id==t.INTERVAL_DAY,"v-card-header-week":t.interval_selected_id==t.INTERVAL_WEEK,"v-card-header-two-week":t.interval_selected_id==t.INTERVAL_TWO_WEEK,"v-card-header-month":t.interval_selected_id==t.INTERVAL_MONTH},attrs:{color:"elevation-0"}},[i("v-row",{attrs:{"no-gutters":""}},t._l(t.period_list,(function(e){return i("v-col",{key:e.date,staticClass:"text-center"},[t._v("\n              "+t._s(t._f("headerData")(e.date))+"\n              "),i("v-menu",{attrs:{"offset-y":"",left:""},scopedSlots:t._u([{key:"activator",fn:function(s){var a=s.on;return[i("v-btn",t._g({staticClass:"pl-0 pr-0",class:{"grey--text":t.selected_driver&&t.isDriverUnavailableOrHasShift(t.selected_driver,e.date)},attrs:{"x-small":"",disabled:!t.location_selected||t.selected_driver&&t.isDriverUnavailableOrHasShift(t.selected_driver,e.date)}},a),[i("v-icon",[t._v("mdi-menu-down")])],1)]}}],null,!0)},[i("v-card",{staticStyle:{"max-height":"300px",width:"350px","overflow-y":"auto"}},[i("v-card-actions",{staticClass:"justify-end"},[i("v-btn",{attrs:{icon:""},on:{click:function(e){e.stopPropagation(),t.showOnlyUnavailable=!t.showOnlyUnavailable}}},[i("v-icon",{class:{"green--text":t.showOnlyUnavailable}},[t._v("mdi-filter")])],1)],1),t.filteredDriverList(e.driver_working_time)?i("v-list",{attrs:{dense:""}},t._l(t.filteredDriverList(e.driver_working_time),(function(e){return i("v-list-item",{key:e.driver.id},[i("v-list-item-avatar",{staticClass:"mt-0 mb-0"},[e.driver.photo_src?i("img",{staticClass:"working_time.driver-photo_src",attrs:{src:t.appConfig.app_url+"/images/thumb/"+e.driver.photo_src}}):i("v-icon",[t._v("mdi-account")])],1),i("v-list-item-content",{staticClass:"pt-0 pb-0"},[i("v-list-item-title",{domProps:{innerHTML:t._s(e.driver.full_name)}}),t._l(e.working_days,(function(e,s){return i("v-list-item-subtitle",{key:s,class:{"red--text":"Driver unavailable"===e,"orange--text":"Driver unavailable"!==e}},[t._v("\n                          "+t._s(e)+"\n                        ")])})),e.shift_details&&e.shift_details.length>0?i("v-list-item-subtitle",{staticClass:"font-weight-medium mt-1"},[t._v("\n                          Assigned Shifts:\n                        ")]):t._e(),t._l(e.shift_details,(function(e,s){return i("v-list-item-subtitle",{key:"shift-"+s,staticClass:"green--text"},[t._v("\n                          "+t._s(e)+"\n                        ")])}))],2)],1)})),1):t.showOnlyUnavailable?i("v-card-text",{staticClass:"text-center green--text"},[t._v("\n  All Drivers Available\n")]):t._e()],1)],1)],1)})),1)],1)],1),t.showLoader?t._e():i("v-card",{staticClass:"right-panel-calendar",attrs:{color:"elevation-1",height:t.scroll_panel_height-79},on:{"&scroll":function(e){return e.target!==e.currentTarget?null:t.onScrollPanel(e)}}},t._l(t.restaurantListSearched,(function(e,s){return i("v-card",{key:s,staticClass:"calendar-v-card-body",class:{"v-card-day":t.interval_selected_id==t.INTERVAL_DAY,"v-card-week":t.interval_selected_id==t.INTERVAL_WEEK,"v-card-two-week":t.interval_selected_id==t.INTERVAL_TWO_WEEK,"v-card-month":t.interval_selected_id==t.INTERVAL_MONTH},attrs:{color:"elevation-0","no-gutters":""}},[i("v-card",{attrs:{color:"grey lighten-2"}},[i("v-col",[t._v(t._s(e.name))])],1),i("v-row",{attrs:{align:"stretch"}},t._l(t.period_list,(function(s){return i("v-col",{key:s.date,staticClass:"text-center pl-0 pr-0"},[i("v-hover",{staticClass:"ml-2 mr-2",staticStyle:{height:"100%"},attrs:{"open-delay":"100"},scopedSlots:t._u([{key:"default",fn:function(a){var r=a.hover;return[i("div",[i("v-btn",{attrs:{outlined:"",color:"grey",small:"",disabled:t.selected_driver&&t.isDriverUnavailableOrHasShift(t.selected_driver.id,s.date)},on:{click:function(i){return t.showNewShift(e.id,s.date,s.restaurant_shifts)}}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-plus")]),t._v("Add\n                  ")],1),t.shift_to_copy&&(r||s.localLoading)?i("v-tooltip",{attrs:{bottom:"","nudge-left":"52","nudge-bottom":"4"},scopedSlots:t._u([{key:"activator",fn:function(a){var r=a.on;return[i("v-btn",t._g({attrs:{outlined:"",small:"",color:"grey",loading:s.localLoading},on:{click:function(i){return t.pasteShift(e,s)}}},r),[i("v-icon",{attrs:{left:""}},[t._v("mdi-content-paste")]),t._v("Paste\n                        ")],1)]}}],null,!0)},[i("span",[t._v("Hold the "),i("span",{staticClass:"yellow--text"},[t._v('"Shift"')]),t._v(" key to continue copying multiple times")])]):t._e(),t._l(s.restaurant_shifts[e.id],(function(e){return i("v-menu",{key:e.date,scopedSlots:t._u([{key:"activator",fn:function(s){var a=s.on;return[i("v-btn",t._g({staticClass:"shift-button_item",class:{"light-green lighten-3":e.status==t.STATUS_PUBLICATED&&!e.status_assigned==t.STATUS_STALE,"yellow lighten-3":e.status_assigned==t.STATUS_FREE||e.status_assigned==t.STATUS_STALE},attrs:{tile:"",small:"",block:"",loading:e.localLoading}},a),[i("div",[t._v("\n                                ("+t._s(t._f("formatTime")(e.start_time))+" - "+t._s(t._f("formatTime")(e.finish_time))+")\n                                "),i("v-tooltip",{attrs:{bottom:"","nudge-left":"52","nudge-bottom":"10"},scopedSlots:t._u([{key:"activator",fn:function(s){var a=s.on;return[i("span",t._g({},e.comment&&a),[e.status==t.STATUS_PUBLICATED?i("v-icon",{staticStyle:{"font-size":"14px"}},[t._v("mdi-eye")]):t._e(),e.status==t.STATUS_NEW?i("v-icon",{staticStyle:{"font-size":"14px",color:"red"}},[t._v("mdi-eye-off")]):t._e(),e.status==t.STATUS_DRAFT?i("v-icon",{staticStyle:{"font-size":"14px",color:"gray"}},[t._v("mdi-eye-off")]):t._e()],1)]}}],null,!0)},[e.comment?i("span",[t._v(t._s(e.comment))]):t._e()]),null!=e.timesheet?i("v-tooltip",{attrs:{bottom:"","nudge-left":"52","nudge-bottom":"10"},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on;return[i("span",t._g({},s),[i("v-icon",{staticStyle:{"font-size":"14px",color:"#FF5722"}},[t._v("mdi-lock")])],1)]}}],null,!0)},[i("span",[t._v("Timesheet exists by this shift")])]):t._e(),e.status_assigned==t.STATUS_STALE?i("div",[i("v-tooltip",{attrs:{bottom:"","nudge-left":"52","nudge-bottom":"10"},scopedSlots:t._u([{key:"activator",fn:function(s){var a=s.on;return[i("span",t._g({},e.comment&&a),[t._v("\n                                        Open shift "),i("v-icon",{staticStyle:{"font-size":"14px",color:"red"}},[t._v("mdi-close")])],1)]}}],null,!0)},[e.comment?i("span",[t._v("Rejected by: "+t._s(t.getDriverFullName(e)))]):t._e()])],1):t._e(),e.status_assigned!=t.STATUS_STALE?i("div",[t._v("\n                                  "+t._s(t.getDriverFullName(e))+"\n                                ")]):t._e()],1)])]}}],null,!0)},[i("v-list",[i("v-list-item",{on:{click:function(i){return t.copyShift(e)}}},[i("v-list-item-title",[t._v("Copy")])],1),i("edit-shift-modal",{attrs:{shiftItem:e,shiftList:t.shift_list}}),null==e.timesheet?i("v-list-item",{on:{click:function(i){return t.removeShift(e)}}},[i("v-list-item-title",[t._v("Remove")])],1):t._e(),e.status==t.STATUS_PUBLICATED?i("v-list-item",{on:{click:function(i){return t.changeShiftStatus(e,t.STATUS_NEW)}}},[i("v-list-item-title",[t._v("Unpublish")])],1):t._e(),e.status==t.STATUS_PUBLICATED&&e.status_assigned==t.STATUS_ASSIGNED?i("cancel-shift-modal",{attrs:{shiftItem:e,shiftList:t.shift_list}}):t._e(),e.status!=t.STATUS_NEW||e.status_assigned!=t.STATUS_FREE&&e.status_assigned!=t.STATUS_STALE?t._e():i("confirm-dialog",{attrs:{messageText:"Notify drivers?",pushDrivers:20},on:{successClick:function(i){return t.changeShiftStatus(e,t.STATUS_PUBLICATED,i)}}},[i("div",{staticClass:"v-list-item v-list-item--link theme--light"},[t._v("Publish")])]),e.status==t.STATUS_NEW&&e.status_assigned!=t.STATUS_FREE&&e.status_assigned!=t.STATUS_STALE?i("v-list-item",{on:{click:function(i){return t.changeShiftStatus(e,t.STATUS_PUBLICATED)}}},[i("v-list-item-title",[t._v("Publish")])],1):t._e()],1)],1)}))],2)]}}],null,!0)})],1)})),1)],1)})),1)],1),t.showLoader?i("div",{staticClass:"ml-16 pl-16 mt-9"},[i("v-skeleton-loader",t._b({staticClass:"ml-16 pl-16",attrs:{type:"list-item-three-line, list-item-three-line, list-item-three-line, list-item-three-line"}},"v-skeleton-loader",t.attrs,!1))],1):t._e(),i("v-card",{staticStyle:{"margin-bottom":"-5px"},attrs:{color:"grey lighten-4",flat:"",tile:""}},[i("v-app-bar",{attrs:{fixed:"",bottom:"",height:"36px",color:"elevation-1 tool-bar__totals-panel"}},[i("v-spacer"),i("div",[i("v-btn",{staticClass:"shift-button_item",attrs:{tile:"",small:""}},[i("div",{staticClass:"shift-total_value"},[t._v(t._s(t.totals.published))]),i("div",{staticClass:"shift-total_label"},[t._v("Published Shifts")])]),i("v-btn",{staticClass:"shift-button_item",attrs:{tile:"",small:""}},[i("div",{staticClass:"shift-total_value"},[t._v(t._s(t.totals.unpublished))]),i("div",{staticClass:"shift-total_label"},[t._v("Unpublished Shifts")])]),i("v-btn",{staticClass:"shift-button_item",attrs:{tile:"",small:""}},[i("div",{staticClass:"shift-total_value"},[t._v(t._s(t.totals.draft))]),i("div",{staticClass:"shift-total_label"},[t._v("Draft Shifts")])]),i("v-btn",{staticClass:"shift-button_item",attrs:{tile:"",small:""}},[i("div",{staticClass:"shift-total_value"},[t._v(t._s(t.totals.free))]),i("div",{staticClass:"shift-total_label"},[t._v("Open Shifts")])])],1),i("v-spacer"),i("div",[i("v-btn",{staticClass:"shift-button_item",attrs:{tile:"",small:""}},[i("div",{staticClass:"shift-total_value"},[t._v(t._s(t.totals.total_shifts))]),i("div",{staticClass:"shift-total_label"},[t._v("Total Shifts")])]),i("v-btn",{staticClass:"shift-button_item",attrs:{tile:"",small:""}},[i("div",{staticClass:"shift-total_value"},[t._v(t._s(t._f("formatHours")(t.totals.filled_hours)))]),i("div",{staticClass:"shift-total_label"},[t._v("Filled Hours")])]),i("v-btn",{staticClass:"shift-button_item",attrs:{tile:"",small:""}},[i("div",{staticClass:"shift-total_value"},[t._v(t._s(t._f("formatFloat")(t.totals.estimated_cost)))]),i("div",{staticClass:"shift-total_label"},[t._v("Est. Cost")])]),i("v-btn",{staticClass:"shift-button_item",attrs:{tile:"",small:""}},[i("div",{staticClass:"shift-total_value"},[t._v(t._s(t._f("formatFloat")(t.totals.expected_sales)))]),i("div",{staticClass:"shift-total_label"},[t._v("Expected Sales")])])],1)],1)],1)],1),t.is_mobile_version?i("v-col",[i("v-card",{staticStyle:{"margin-bottom":"6px"},attrs:{color:"grey lighten-4",flat:"",tile:""}},[i("v-toolbar",{attrs:{dense:"",color:"elevation-1 tool-bar__actions-panel header-btn-panel header-btn-panel-mobile",height:"40"}},[i("v-row",{staticClass:"d-flex mb-auto",attrs:{"no-gutters":""}},[i("div",{staticClass:"menu-date__picker-mobile"},[i("v-btn",{on:{click:t.onPreviosRange}},[i("v-icon",[t._v("mdi-menu-left")])],1),i("v-menu",{attrs:{transition:"scale-transition","close-on-content-click":!1,"nudge-width":200,"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on;return[i("v-btn",t._g({},s),[t._v("\n                  "+t._s(t.dateRangeText(t.date_range_selected))+"\n                ")])]}}],null,!1,3587149381),model:{value:t.menu_date_picker,callback:function(e){t.menu_date_picker=e},expression:"menu_date_picker"}},[i("v-card",{attrs:{"max-width":"346px"}},[i("v-date-picker",{attrs:{scrollable:"",actions:"","full-width":"","first-day-of-week":"1",range:"","title-date-format":t.dateRangeText},on:{"click:date":t.dateRangeSelect},model:{value:t.date_range_selected,callback:function(e){t.date_range_selected=e},expression:"date_range_selected"}}),i("v-divider")],1)],1),i("v-btn",{on:{click:t.onNextRange}},[i("v-icon",[t._v("mdi-menu-right")])],1)],1),i("div",{staticClass:"menu-interval-changer-mobile"},[i("v-select",{attrs:{items:t.interval_list,"item-text":"name","item-value":"id",dense:"",solo:"","hide-details":""},on:{change:t.onSelectInterval},model:{value:t.interval_selected_id,callback:function(e){t.interval_selected_id=e},expression:"interval_selected_id"}})],1),i("div",{staticClass:"menu-restaurant-changer-mobile"},[i("v-autocomplete",{staticStyle:{"max-width":"340px"},attrs:{items:t.locations_list,"item-text":"name","item-value":"_guid",label:"All locations",dense:"",solo:"","hide-details":""},on:{change:t.onSelectRestaurantMobile},scopedSlots:t._u([{key:"selection",fn:function(e){return[i("div",[i("div",{domProps:{innerHTML:t._s(e.item.name)}})])]}},{key:"item",fn:function(e){return[e.item._guid.type==t.TYPE_AREA?[i("div",{staticClass:"select-drop-item-group__area"},[i("div",{domProps:{innerHTML:t._s(e.item.name)}})])]:[i("div",{staticClass:"select-drop-item-sub_restaurant"},[i("div",{domProps:{innerHTML:t._s(e.item.name)}})])]]}}],null,!1,1090052647),model:{value:t.location_mobile_selected,callback:function(e){t.location_mobile_selected=e},expression:"location_mobile_selected"}})],1)]),i("v-row",[i("v-col",[i("copy-shifts-modal",{attrs:{shiftList:t.shiftListSearched,intervalId:t.interval_selected_id,dateRangeSelected:t.date_range_selected}}),i("v-btn",{staticClass:"blue lighten-3 ml-1",attrs:{loading:t.publishPeriodLoading},on:{click:t.publishPeriodShifts}},[i("v-icon",[t._v("mdi-post")]),t._v(" Publish shifts ["+t._s(t.unpublishedShifts)+"]\n            ")],1)],1)],1),i("v-spacer")],1)],1),i("div",{staticClass:"d-flex mb-auto",attrs:{flat:"",tile:""}},[i("v-card",{staticClass:"right-panel-calendar-mobile",attrs:{color:"elevation-0"}},[t.restaurant_item_mobile_selected?t._e():i("v-card",{staticClass:"calendar-v-card-header",attrs:{color:"elevation-1"}},[i("v-row",[i("v-col",{staticClass:"text-center"},[t._v("\n              No restaurant selected\n            ")])],1)],1),t.restaurant_item_mobile_selected?i("v-card",{staticClass:"calendar-v-card-header",attrs:{color:"elevation-1"}},t._l(t.period_list,(function(e){return i("v-row",{key:e.date},[i("v-col",{staticClass:"text-center"},[i("v-card",{staticClass:"calendar-v-card-body",attrs:{color:"elevation-0"}},[i("v-card",{attrs:{color:"grey lighten-2"}},[i("v-col",[t._v(t._s(t._f("moment")(e.date)))])],1),i("v-row",{attrs:{align:"stretch"}},[i("v-col",{staticClass:"text-center"},[i("v-btn",{attrs:{outlined:"",color:"grey",small:""},on:{click:function(i){return t.showNewShift(t.restaurant_item_mobile_selected.id,e.date,e.restaurant_shifts)}}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-plus")]),t._v("Add\n                    ")],1),t.restaurant_item_mobile_selected&&t.shift_to_copy?i("v-btn",{attrs:{outlined:"",small:"",color:"grey",loading:t.period_list_loading[e.date]},on:{click:function(i){return t.pasteShift(t.restaurant_item_mobile_selected,e)}}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-content-paste")]),t._v("Paste\n                    ")],1):t._e(),t._l(e.restaurant_shifts[t.restaurant_item_mobile_selected.id],(function(e){return i("v-menu",{key:e.date,scopedSlots:t._u([{key:"activator",fn:function(s){var a=s.on;return[i("v-btn",t._g({staticClass:"shift-button_item shift-button_item-fix_height",class:{"light-green lighten-3":e.status==t.STATUS_PUBLICATED&&!e.status_assigned==t.STATUS_STALE,"yellow lighten-3":e.status_assigned==t.STATUS_FREE,"red darken-3":e.status_assigned==t.STATUS_STALE},attrs:{tile:"",small:"",block:"",loading:e.localLoading}},a),[i("div",[i("v-tooltip",{attrs:{left:"","nudge-left":"50"},scopedSlots:t._u([{key:"activator",fn:function(s){var a=s.on;return[i("span",t._g({},a),[t._v("\n                                      ("+t._s(t._f("formatTime")(e.start_time))+" - "+t._s(t._f("formatTime")(e.finish_time))+")\n                                      "),e.status==t.STATUS_PUBLICATED?i("v-icon",{staticStyle:{"font-size":"14px"}},[t._v("mdi-eye")]):t._e(),e.status==t.STATUS_NEW?i("v-icon",{staticStyle:{"font-size":"14px",color:"red"}},[t._v("mdi-eye-off")]):t._e(),e.status==t.STATUS_DRAFT?i("v-icon",{staticStyle:{"font-size":"14px",color:"gray"}},[t._v("mdi-eye-off")]):t._e()],1)]}}],null,!0)},[e.comment?i("span",[t._v(t._s(e.comment))]):t._e(),e.comment?t._e():i("span",[t._v("(empty)")])]),null!=e.timesheet?i("v-tooltip",{attrs:{bottom:"","nudge-left":"52","nudge-bottom":"10"},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on;return[i("span",t._g({},s),[i("v-icon",{staticStyle:{"font-size":"14px",color:"#FF5722"}},[t._v("mdi-lock")])],1)]}}],null,!0)},[i("span",[t._v("Timesheet exists by this shift")])]):t._e(),i("div",[t._v("\n                                  "+t._s(t.getDriverFullName(e))),t.getDriverPhone(e)?i("span",[t._v(", phone: "+t._s(t.getDriverPhone(e)))]):t._e()])],1)])]}}],null,!0)},[i("v-list",[i("v-list-item",{on:{click:function(i){return t.copyShift(e)}}},[i("v-list-item-title",[t._v("Copy")])],1),i("edit-shift-modal",{attrs:{shiftItem:e,shiftList:t.shift_list}}),null==e.timesheet?i("v-list-item",{on:{click:function(i){return t.removeShift(e)}}},[i("v-list-item-title",[t._v("Remove")])],1):t._e(),e.status==t.STATUS_PUBLICATED?i("v-list-item",{on:{click:function(i){return t.changeShiftStatus(e,t.STATUS_NEW)}}},[i("v-list-item-title",[t._v("Unpublish")])],1):t._e(),e.status==t.STATUS_PUBLICATED&&e.status_assigned==t.STATUS_ASSIGNED?i("cancel-shift-modal",{attrs:{shiftItem:e,shiftList:t.shift_list}}):t._e(),e.status!=t.STATUS_NEW||e.status_assigned!=t.STATUS_FREE&&e.status_assigned!=t.STATUS_STALE?t._e():i("confirm-dialog",{attrs:{messageText:"Notify drivers?",pushDrivers:20},on:{successClick:function(i){return t.changeShiftStatus(e,t.STATUS_PUBLICATED,i)}}},[i("div",{staticClass:"v-list-item v-list-item--link theme--light"},[t._v("Publish")])]),e.status==t.STATUS_NEW&&e.status_assigned!=t.STATUS_FREE&&e.status_assigned!=t.STATUS_STALE?i("v-list-item",{on:{click:function(i){return t.changeShiftStatus(e,t.STATUS_PUBLICATED)}}},[i("v-list-item-title",[t._v("Publish")])],1):t._e()],1)],1)}))],2)],1)],1)],1)],1)})),1):t._e()],1)],1)],1):t._e(),i("new-shift-modal",{attrs:{restaurantItemId:t.restaurant_item_id,periodDate:t.period_item_date,shiftList:t.shift_list,"show-modal":t.showNewShiftDialog},on:{closeDialog:function(e){t.showNewShiftDialog=!1}}})],1)}),[],!1,null,"dcf245da",null);e.a=N.exports;h()(N,{VAppBar:H.a,VAutocomplete:T.a,VBtn:u.a,VCard:v.a,VCardActions:f.a,VCardText:f.b,VCol:p.a,VDatePicker:w.a,VDivider:C.a,VHover:D.a,VIcon:b.a,VList:L.a,VListItem:I.a,VListItemAvatar:E.a,VListItemContent:V.a,VListItemSubtitle:V.b,VListItemTitle:V.c,VMenu:A.a,VNavigationDrawer:Y.a,VRow:$.a,VSelect:R.a,VSkeletonLoader:M.a,VSpacer:P.a,VTextField:U.a,VToolbar:q.a,VTooltip:j.a})},"4e00":function(t,e,i){},8271:function(t,e,i){"use strict";var s=i("1dce"),a=i("b5ae"),r=i("2f62"),o=i("c1df"),n=i.n(o),d=i("2ef0"),l=i("1168"),c=i("c64f");var _={mixins:[s.validationMixin],name:"CancelShiftModal",props:["shiftItem","shiftList"],validations:{driver_id:{required:a.required},start_time:{required:a.required},finish_time:{required:a.required},comment_cancelled:{}},data:()=>({readOnly:!1,localLoading:!1,dialog:!1,driver_id:0,driver_rejected_id:0,status:"",status_assigned:"",period_date:"",start_time:"",finish_time:"",cost_per_hour:"",cost_total:"",cost_bonus:0,const_fuel_bonus:0,cost_extra_bonus:0,cost:"",comment_cancelled:"",restaurant_selected:void 0,area_selected:void 0,is_initialized:!1}),updated(){this.$data.dialog&&!this.$data.is_initialized&&(this.$data.restaurant_selected=d.find(this.restaurants,t=>t.id==this.$props.shiftItem.restaurant_id),this.$data.area_selected=d.find(this.areas,t=>t.id==this.$data.restaurant_selected.area_id),this.$props.shiftItem.status_assigned==l.k?(this.$data.driver_id=0,this.driver_rejected_id=+this.$props.shiftItem.driver_id):this.$data.driver_id=this.$props.shiftItem.driver_id?+this.$props.shiftItem.driver_id:0,this.$data.status=this.$props.shiftItem.status,this.$data.status_assigned=this.$props.shiftItem.status_assigned,this.$data.period_date=this.$props.shiftItem.period_date,this.$data.start_time=this.$props.shiftItem.start_time.substr(0,5),this.$data.finish_time=this.$props.shiftItem.finish_time.substr(0,5),this.$data.cost_per_hour=this.$props.shiftItem.cost_per_hour,this.$data.cost_total=this.$props.shiftItem.cost_total,this.$data.cost_bonus=+this.$props.shiftItem.cost_bonus,this.$data.const_fuel_bonus=+this.$props.shiftItem.const_fuel_bonus,this.$data.cost_extra_bonus=+this.$props.shiftItem.cost_extra_bonus,this.$data.is_initialized=!0)},computed:{...Object(r.c)(["areas","restaurants","restaurateurs"]),...Object(r.c)("user",{users:"users"}),driver_list(){return this.$store.getters.drivers},creator(){return d.find(this.users,t=>t.id==this.$props.shiftItem.creator_id)},moderator(){return d.find(this.users,t=>t.id==this.$props.shiftItem.moderator_id)},restaurateur_creator(){return d.find(this.restaurateurs,t=>t.id==this.$props.shiftItem.restaurateur_creator_id)},restaurateur_moderator(){return d.find(this.restaurateurs,t=>t.id==this.$props.shiftItem.restaurateur_moderator_id)},driverListSearched(){let t=d.find(this.restaurants,t=>t.id==this.$props.shiftItem.restaurant_id),e=d.filter(this.driver_list,e=>{if(0==e.area_ids.length)return!0;return-1!==d.map(e.area_ids,t=>t.area_id).indexOf(t.area_id)&&(0==e.restaurant_ids.length||!!d.find(e.restaurant_ids,e=>e.restaurant_id==t.id))});return e.unshift({id:0,full_name:"Open shift"}),e},selectedDriverWorkingDay(){let t=d.find(this.driver_list,t=>t.id==this.$data.driver_id);if(!t)return[];let e=d.filter(t.actual_override_working_time,t=>t.period_date==this.$data.period_date);if(e.length>0)return e;let i=n()(this.$data.period_date,"YYYY-MM-DD").isoWeekday()-1;return e=d.filter(t.default_working_time,t=>t.week_day==i),e},shiftLength:function(){let t=n()(this.$data.finish_time,"HH:mm"),e=n()(this.$data.start_time,"HH:mm");return t.isValid()&&e.isValid()?(this.$data.finish_time<this.$data.start_time&&t.add(1,"days"),((t-e)/6e4/60).toFixed(2)):0},shiftCostPerHour:function(){if(!this.$data.area_selected||!this.$data.restaurant_selected)return 0;let t=this.$data.restaurant_selected.standard_pay?this.$data.restaurant_selected.standard_pay:this.$data.area_selected.standardPayRate,e=n()(this.$data.period_date,"YYYY-MM-DD");return 5!==e.isoWeekday()&&6!==e.isoWeekday()&&7!==e.isoWeekday()||(t=this.$data.restaurant_selected.weekend_pay?this.$data.restaurant_selected.weekend_pay:this.$data.area_selected.weekendPayRate),t},shiftCost:function(){return(+this.shiftCostPerHour*this.shiftLength+ +this.cost_bonus+ +this.const_fuel_bonus).toFixed(2)}},methods:{submit(){if(this.localLoading=!0,this.$v.$touch(),!this.$v.$invalid){this.$data.cost_per_hour=this.shiftCostPerHour,this.$data.cost_total=this.shiftCost;const t={id:this.$props.shiftItem.id,restaurant_id:this.$props.shiftItem.restaurant_id,driver_id:0,driver_id_canceled:this.$props.shiftItem.driver_id,status:this.$data.status,status_assigned:l.k,period_date:this.$data.period_date,start_time:this.$data.start_time,finish_time:this.$data.finish_time,shift_id:this.$data.shift_id,meal_time:0,rest_time:0,cost_per_hour:this.$data.cost_per_hour,cost_total:this.$data.cost_total,cost_bonus:this.$data.cost_bonus,const_fuel_bonus:this.$data.const_fuel_bonus,cost_extra_bonus:this.$data.cost_extra_bonus,cost:this.$data.cost,comment_cancelled:this.$data.comment_cancelled,model_type:10,event:40,model_id:this.$props.shiftItem.id};let e={id:this.$props.shiftItem.id,restaurant_id:this.$props.shiftItem.restaurant_id,driver_id:this.$props.shiftItem.driver_id,status:c.a,status_progress:c.h,period_date:this.$data.period_date,start_time:this.$data.start_time,finish_time:this.$data.start_time,shift_id:0,meal_time:0,rest_time:0,cost_per_hour:0,cost_total:0,cost_bonus:this.$data.cost_bonus,const_fuel_bonus:0,cost_extra_bonus:this.$data.cost,fuel_bonus_6:0,fuel_bonus_3:0,fuel_bonus_0:0,comment:this.$props.shiftItem.id+":"+this.$data.comment_cancelled,modified_shift_id:this.$props.shiftItem.id};0==t.driver_id&&(t.driver_id=null),this.$store.dispatch("editShift",t),this.$store.dispatch("cancelShift",t).then(()=>{this.dialog=!1,this.is_initialized=!1,this.$store.dispatch("createNewTimesheet",e)}).finally(()=>{this.localLoading=!1})}},clear(){this.$v.$reset(),this.$data.restaurant_id=this.$props.shiftItem.restaurant_id,this.$props.shiftItem.status_assigned==l.k?(this.$data.driver_id=0,this.driver_rejected_id=+this.$props.shiftItem.driver_id):this.$data.driver_id=this.$props.shiftItem.driver_id?+this.$props.shiftItem.driver_id:0,this.$data.status=this.$props.shiftItem.status,this.$data.status_assigned=this.$props.shiftItem.status_assigned,this.$data.period_date=this.$props.shiftItem.period_date,this.$data.start_time=this.$props.shiftItem.start_time.substr(0,5),this.$data.finish_time=this.$props.shiftItem.finish_time.substr(0,5),this.$data.cost=0,this.$data.comment_cancelled=""},isTimeIntersects:(t,e,i)=>!!i&&(n()(t,"HH:mm").format("HH:mm")<n()(e,"HH:mm").format("HH:mm")?n()(t,"HH:mm").format("HH:mm")<=n()(i,"HH:mm").format("HH:mm")&&n()(e,"HH:mm").format("HH:mm")>=n()(i,"HH:mm").format("HH:mm"):n()(t,"HH:mm").format("HH:mm")<=n()(i,"HH:mm").format("HH:mm")),getDriverFullName:function(t){let e=d.find(this.driver_list,e=>e.id==t);return e?e.full_name:"-"},validateNegative(t){t>=0?(this.$v.$reset(),this.cost=0):this.cost=t}},filters:{formatDate:function(t){return n()(t,"YYYY-MM-DD").format("MMM Do")}}},m=i("2877"),h=i("6544"),u=i.n(h),v=i("c6a6"),f=i("8336"),p=i("b0af"),g=i("99d9"),b=i("62ad"),$=i("169a"),y=i("ce7e"),S=i("4bd4"),k=i("132d"),x=i("8860"),H=i("da13"),T=i("5d23"),w=i("34c3"),C=i("0fd9"),D=i("8654"),L=i("a844"),I=Object(m.a)(_,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("v-list-item",{on:{click:function(e){e.stopPropagation(),t.dialog=!0}}},[i("v-list-item-title",[t._v("Cancel")])],1),i("v-dialog",{attrs:{width:"700px"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[t.dialog?i("v-card",[i("v-card-title",[i("span",{staticClass:"headline"},[t._v("Cancel Shift, "+t._s(t._f("formatDate")(t.period_date)))]),i("div",{staticClass:"dialog-closeBtn",on:{click:function(e){t.dialog=!1}}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-close")])],1)]),i("v-card-text",{staticClass:"dialog-card_body"},[i("v-row",{attrs:{align:"stretch"}},[i("v-col",{attrs:{xs:"12",sm:"3",md:"3"}},[i("v-row",[i("v-col",{attrs:{xs:"12",sm:"12",md:"12"}},[t._v("\n                                Driver info\n                            ")])],1),i("v-row",[i("v-list",{staticClass:"col",attrs:{nav:"",dense:""}},[i("v-list-item",[i("v-list-item-icon",[i("v-icon",[t._v("mdi-calendar")])],1),i("v-list-item-content",[i("v-list-item-title",[t._v("__")]),i("v-list-item-subtitle",[t._v("Weekly Hours")])],1)],1)],1),i("v-list",{attrs:{nav:"",dense:""}},[i("v-list-item",[i("v-list-item-icon",[i("v-icon",[t._v("mdi-currency-gbp")])],1),i("v-list-item-content",[i("v-list-item-title",[t._v("___£")]),i("v-list-item-subtitle",[t._v("Weekly Cost")])],1)],1)],1),i("v-list",{attrs:{nav:"",dense:""}},[i("v-list-item",[i("v-list-item-icon",[i("v-icon",[t._v("mdi-clock-outline")])],1),i("v-list-item-content",[i("v-list-item-title",[t._v(t._s(t.shiftLength))]),i("v-list-item-subtitle",[t._v("Shift Length")])],1)],1)],1),i("v-list",{attrs:{nav:"",dense:""}},[i("v-list-item",[i("v-list-item-icon",[i("v-icon",[t._v("mdi-account")])],1),i("v-list-item-content",[i("v-list-item-title",[t._v("£"+t._s(t.shiftCost))]),i("v-list-item-subtitle",[t._v("Shift Cost")])],1)],1)],1)],1),i("v-row",[i("v-col",{staticClass:"pl-0 pr-0"},[i("v-divider"),i("v-row",{attrs:{"no-gutters":""}},[t.creator?i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[t._v("\n                                        Shift Creator: #"+t._s(t.creator.id)+" "+t._s(t.creator.full_name)+" ("+t._s(t.creator.email)+")\n                                    ")]):t._e(),t.moderator?i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[t._v("\n                                        Shift Moderator: #"+t._s(t.moderator.id)+" "+t._s(t.moderator.full_name)+" ("+t._s(t.moderator.email)+")\n                                    ")]):t._e(),t.restaurateur_creator?i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[t._v("\n                                        Shift Creator: #"+t._s(t.restaurateur_creator.id)+" "+t._s(t.restaurateur_creator.name)+" ("+t._s(t.restaurateur_creator.email)+")\n                                    ")]):t._e(),t.restaurateur_moderator?i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[t._v("\n                                        Shift Moderator: #"+t._s(t.restaurateur_moderator.id)+" "+t._s(t.restaurateur_moderator.name)+" ("+t._s(t.restaurateur_moderator.email)+")\n                                    ")]):t._e()],1)],1)],1)],1),i("v-col",{attrs:{xs:"12",sm:"9",md:"9"}},[i("v-form",{ref:"form"},[i("v-row",[i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[t.driver_rejected_id?i("i",{staticClass:"blue lighten-4"},[i("v-icon",{staticStyle:{"font-size":"14px",color:"#2196F3"}},[t._v("mdi-information-outline")]),t._v(" Shift rejected by "+t._s(t.getDriverFullName(t.driver_rejected_id)))],1):t._e(),i("v-autocomplete",{attrs:{label:"Select driver","item-text":"full_name","item-value":"id",items:t.driverListSearched,required:"",dense:"",solo:""},on:{input:function(e){return t.$v.driver_id.$touch()},blur:function(e){return t.$v.driver_id.$touch()}},model:{value:t.driver_id,callback:function(e){t.driver_id=e},expression:"driver_id"}})],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-text-field",{attrs:{type:"number","prepend-icon":"mdi-wallet-giftcard",label:"Cancellation fee/bonus",hint:"hidden for restaurants",placeholder:"Enter a negative number",required:"",outlined:"",dense:""},on:{change:t.validateNegative},model:{value:t.cost,callback:function(e){t.cost=e},expression:"cost"}})],1),i("v-col",{staticClass:"pb-0",attrs:{cols:"12",sm:"12"}},[i("v-textarea",{attrs:{outlined:"",label:"Comment"},model:{value:t.comment_cancelled,callback:function(e){t.comment_cancelled=e},expression:"comment_cancelled"}})],1)],1),i("div",{staticClass:"d-flex justify-center"},[i("v-btn",{staticClass:"mr-4 primary",attrs:{depressed:"",disabled:this.$v.$invalid||t.localLoading,loading:t.localLoading},on:{click:t.submit}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-upload")]),t._v("Save")],1),i("v-btn",{staticClass:"mr-4",attrs:{loading:t.localLoading,depressed:""},on:{click:t.clear}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-rotate-left")]),t._v("Restore")],1),i("v-btn",{staticClass:"mr-4 warning",attrs:{loading:t.localLoading,depressed:""},on:{click:function(e){t.dialog=!1}}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-cancel")]),t._v("Cancel")],1)],1)],1)],1)],1)],1)],1):t._e()],1)],1)}),[],!1,null,null,null);e.a=I.exports;u()(I,{VAutocomplete:v.a,VBtn:f.a,VCard:p.a,VCardText:g.b,VCardTitle:g.c,VCol:b.a,VDialog:$.a,VDivider:y.a,VForm:S.a,VIcon:k.a,VList:x.a,VListItem:H.a,VListItemContent:T.a,VListItemIcon:w.a,VListItemSubtitle:T.b,VListItemTitle:T.c,VRow:C.a,VTextField:D.a,VTextarea:L.a})},9666:function(t,e,i){},e477:function(t,e,i){"use strict";var s=i("1dce"),a=i("b5ae"),r=i("2f62"),o=i("c1df"),n=i.n(o),d=i("2ef0"),l=i("1168");var c={mixins:[s.validationMixin],name:"EditShiftModal",props:["shiftItem","shiftList"],validations:{driver_id:{required:a.required},start_time:{required:a.required},finish_time:{required:a.required},comment:{}},data:()=>({readOnly:!1,localLoading:!1,dialog:!1,driver_id:0,driver_rejected_id:0,status:"",status_assigned:"",period_date:"",start_time:"",finish_time:"",cost_per_hour:"",cost_total:"",cost_bonus:0,const_fuel_bonus:0,cost_extra_bonus:0,comment:"",extra_request:0,restaurant_selected:void 0,area_selected:void 0,is_initialized:!1}),updated(){this.$data.dialog&&!this.$data.is_initialized&&(this.$data.restaurant_selected=d.find(this.restaurants,t=>t.id==this.$props.shiftItem.restaurant_id),this.$data.area_selected=d.find(this.areas,t=>t.id==this.$data.restaurant_selected.area_id),this.$props.shiftItem.status_assigned==l.k?(this.$data.driver_id=0,this.driver_rejected_id=+this.$props.shiftItem.driver_id):this.$data.driver_id=this.$props.shiftItem.driver_id?+this.$props.shiftItem.driver_id:0,this.$data.status=this.$props.shiftItem.status,this.$data.status_assigned=this.$props.shiftItem.status_assigned,this.$data.period_date=this.$props.shiftItem.period_date,this.$data.start_time=this.$props.shiftItem.start_time.substr(0,5),this.$data.finish_time=this.$props.shiftItem.finish_time.substr(0,5),this.$data.cost_per_hour=this.$props.shiftItem.cost_per_hour,this.$data.cost_total=this.$props.shiftItem.cost_total,this.$data.cost_bonus=+this.$props.shiftItem.cost_bonus,this.$data.const_fuel_bonus=+this.$props.shiftItem.const_fuel_bonus,this.$data.cost_extra_bonus=+this.$props.shiftItem.cost_extra_bonus,this.$data.comment=this.$props.shiftItem.comment,this.$data.extra_request=+this.$props.shiftItem.extra_request,this.$data.is_initialized=!0)},computed:{...Object(r.c)(["areas","restaurants","timeList","restaurateurs"]),...Object(r.c)("user",{users:"users"}),driver_list(){return this.$store.getters.drivers},creator(){return d.find(this.users,t=>t.id==this.$props.shiftItem.creator_id)},moderator(){return d.find(this.users,t=>t.id==this.$props.shiftItem.moderator_id)},restaurateur_creator(){return d.find(this.restaurateurs,t=>t.id==this.$props.shiftItem.restaurateur_creator_id)},restaurateur_moderator(){return d.find(this.restaurateurs,t=>t.id==this.$props.shiftItem.restaurateur_moderator_id)},driverListSearched(){let t=d.find(this.restaurants,t=>t.id==this.$props.shiftItem.restaurant_id),e=d.filter(this.driver_list,e=>{if(0==e.area_ids.length)return!0;return-1!==d.map(e.area_ids,t=>t.area_id).indexOf(t.area_id)&&(0==e.restaurant_ids.length||!!d.find(e.restaurant_ids,e=>e.restaurant_id==t.id))});return e.unshift({id:0,full_name:"Open shift"}),e},selectedDriverWorkingDay(){let t=d.find(this.driver_list,t=>t.id==this.$data.driver_id);if(!t)return[];let e=d.filter(t.actual_override_working_time,t=>t.period_date==this.$data.period_date);if(e.length>0)return e;let i=n()(this.$data.period_date,"YYYY-MM-DD").isoWeekday()-1;return e=d.filter(t.default_working_time,t=>t.week_day==i),e},selectDriverErrors(){const t=[];let e=d.filter(this.$props.shiftList,t=>t.driver_id==this.$data.driver_id&&t.period_date==this.$data.period_date&&t.id!=this.$props.shiftItem.id&&20==t.status);for(let i=0;i<e.length;i++)if(n()(this.$data.start_time,"HH:mm").format("HH:mm")<n()(this.$data.finish_time,"HH:mm").format("HH:mm")&&(this.isTimeIntersects(e[i].start_time,e[i].finish_time,this.$data.start_time)||this.isTimeIntersects(e[i].start_time,e[i].finish_time,this.$data.finish_time)||this.isTimeIntersects(this.$data.start_time,this.$data.finish_time,e[i].start_time)||this.isTimeIntersects(this.$data.start_time,this.$data.finish_time,e[i].finish_time))){t.push("Driver already have shift on this time");break}if(!d.isEmpty(this.selectedDriverWorkingDay)){let e=d.map(this.selectedDriverWorkingDay,t=>n()(t.start_at,"HH:mm").format("HH:mm")+"-"+n()(t.stop_at,"HH:mm").format("HH:mm")),i=!1,s=!1,a=!1;d.each(this.selectedDriverWorkingDay,t=>{i||s||a||(10==t.holiday&&(i=!0),this.isTimeIntersects(t.start_at,t.stop_at,this.$data.start_time)&&(s=!0),this.isTimeIntersects(t.start_at,t.stop_at,this.$data.finish_time)&&(a=!0))}),i&&t.push("Driver unavailable"),!s&&t.push("Driver working time: "+e.join(", ")),!a&&t.push("Driver working time: "+e.join(", ")),!this.$data.start_time&&t.push("Driver working time: "+e.join(", ")),!this.$data.finish_time&&t.push("Driver working time: "+e.join(", "))}return!this.$v.driver_id.required&&t.push("Driver is required"),t},startTimeErrors(){const t=[];return this.$v.start_time.$dirty?(!this.$v.start_time.required&&t.push("Start Time is required."),!n()(this.$data.start_time,"HH:mm").isValid()&&t.push("Start Time invalid format."),t):t},finishTimeErrors(){const t=[];return this.$v.finish_time.$dirty?(!this.$v.finish_time.required&&t.push("Start Time is required."),!n()(this.$data.finish_time,"HH:mm").isValid()&&t.push("Finish Time invalid format."),t):t},contactNameErrors(){const t=[];return this.$v.contactName.$dirty?(!this.$v.contactName.required&&t.push("Contact Name is required."),t):t},shiftLength:function(){let t=n()(this.$data.finish_time,"HH:mm"),e=n()(this.$data.start_time,"HH:mm");return t.isValid()&&e.isValid()?(this.$data.finish_time<this.$data.start_time&&t.add(1,"days"),((t-e)/6e4/60).toFixed(2)):0},shiftCostPerHour:function(){if(!this.$data.area_selected||!this.$data.restaurant_selected)return 0;let t=this.$data.restaurant_selected.standard_pay?this.$data.restaurant_selected.standard_pay:this.$data.area_selected.standardPayRate,e=n()(this.$data.period_date,"YYYY-MM-DD");return 5!==e.isoWeekday()&&6!==e.isoWeekday()&&7!==e.isoWeekday()||(t=this.$data.restaurant_selected.weekend_pay?this.$data.restaurant_selected.weekend_pay:this.$data.area_selected.weekendPayRate),t},shiftCost:function(){return(+this.shiftCostPerHour*this.shiftLength+ +this.cost_bonus+ +this.const_fuel_bonus).toFixed(2)}},methods:{submit(){if(this.localLoading=!0,this.$v.$touch(),!this.$v.$invalid){this.$data.cost_per_hour=this.shiftCostPerHour,this.$data.cost_total=this.shiftCost;const t={id:this.$props.shiftItem.id,restaurant_id:this.$props.shiftItem.restaurant_id,driver_id:this.$data.driver_id,status:this.$data.status,status_assigned:this.$data.driver_id?l.f:l.h,period_date:this.$data.period_date,start_time:this.$data.start_time,finish_time:this.$data.finish_time,meal_time:0,rest_time:0,cost_per_hour:this.$data.cost_per_hour,cost_total:this.$data.cost_total,cost_bonus:this.$data.cost_bonus,const_fuel_bonus:this.$data.const_fuel_bonus,cost_extra_bonus:this.$data.cost_extra_bonus,comment:this.$data.comment,extra_request:this.$data.extra_request};0==t.driver_id&&(t.driver_id=null),this.$store.dispatch("editShift",t).then(()=>{if(this.dialog=!1,this.is_initialized=!1,Number(this.cost_extra_bonus)>0){const t={restaurant_id:this.$props.shiftItem.restaurant_id,driver_id:this.$data.driver_id?this.$data.driver_id:null,shift_id:this.$props.shiftItem.id,period_date:this.$data.period_date,cost:Number(this.$data.cost_extra_bonus),comment_cancelled:this.$data.comment,model_type:10,event:10,model_id:this.$props.shiftItem.id};this.$store.dispatch("cancelShift",t)}}).finally(()=>{this.localLoading=!1})}},clear(){this.$v.$reset(),this.$data.restaurant_id=this.$props.shiftItem.restaurant_id,this.$props.shiftItem.status_assigned==l.k?(this.$data.driver_id=0,this.driver_rejected_id=+this.$props.shiftItem.driver_id):this.$data.driver_id=this.$props.shiftItem.driver_id?+this.$props.shiftItem.driver_id:0,this.$data.status=this.$props.shiftItem.status,this.$data.status_assigned=this.$props.shiftItem.status_assigned,this.$data.period_date=this.$props.shiftItem.period_date,this.$data.start_time=this.$props.shiftItem.start_time.substr(0,5),this.$data.finish_time=this.$props.shiftItem.finish_time.substr(0,5),this.$data.cost_per_hour=this.$props.shiftItem.cost_per_hour,this.$data.cost_total=this.$props.shiftItem.cost_total,this.$data.cost_bonus=+this.$props.shiftItem.cost_bonus,this.$data.const_fuel_bonus=+this.$props.shiftItem.const_fuel_bonus,this.$data.cost_extra_bonus=+this.$props.shiftItem.cost_extra_bonus,this.$data.comment=this.$data.shiftItem.comment,this.$data.extra_request=this.$props.shiftItem.extra_request},isTimeIntersects:(t,e,i)=>!!i&&(n()(t,"HH:mm").format("HH:mm")<n()(e,"HH:mm").format("HH:mm")?n()(t,"HH:mm").format("HH:mm")<=n()(i,"HH:mm").format("HH:mm")&&n()(e,"HH:mm").format("HH:mm")>=n()(i,"HH:mm").format("HH:mm"):n()(t,"HH:mm").format("HH:mm")<=n()(i,"HH:mm").format("HH:mm")),getDriverFullName:function(t){let e=d.find(this.driver_list,e=>e.id==t);return e?e.full_name:"-"}},filters:{formatDate:function(t){return n()(t,"YYYY-MM-DD").format("MMM Do")}}},_=i("2877"),m=i("6544"),h=i.n(m),u=i("c6a6"),v=i("8336"),f=i("b0af"),p=i("99d9"),g=i("ac7c"),b=i("62ad"),$=i("169a"),y=i("ce7e"),S=i("4bd4"),k=i("132d"),x=i("8860"),H=i("da13"),T=i("5d23"),w=i("34c3"),C=i("0fd9"),D=i("8654"),L=i("a844"),I=Object(_.a)(c,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("v-list-item",{on:{click:function(e){e.stopPropagation(),t.dialog=!0}}},[i("v-list-item-title",[t._v("Edit")])],1),i("v-dialog",{attrs:{width:"700px"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[t.dialog?i("v-card",[i("v-card-title",[i("span",{staticClass:"headline"},[t._v("Edit Shift, "+t._s(t._f("formatDate")(t.period_date)))]),i("div",{staticClass:"dialog-closeBtn",on:{click:function(e){t.dialog=!1}}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-close")])],1)]),i("v-card-text",{staticClass:"dialog-card_body"},[i("v-row",{attrs:{align:"stretch"}},[i("v-col",{attrs:{xs:"12",sm:"3",md:"3"}},[i("v-row",[i("v-col",{attrs:{xs:"12",sm:"12",md:"12"}},[t._v("\n                                Driver info\n                            ")])],1),i("v-row",[i("v-list",{staticClass:"col",attrs:{nav:"",dense:""}},[i("v-list-item",[i("v-list-item-icon",[i("v-icon",[t._v("mdi-calendar")])],1),i("v-list-item-content",[i("v-list-item-title",[t._v("__")]),i("v-list-item-subtitle",[t._v("Weekly Hours")])],1)],1)],1),i("v-list",{attrs:{nav:"",dense:""}},[i("v-list-item",[i("v-list-item-icon",[i("v-icon",[t._v("mdi-currency-gbp")])],1),i("v-list-item-content",[i("v-list-item-title",[t._v("___£")]),i("v-list-item-subtitle",[t._v("Weekly Cost")])],1)],1)],1),i("v-list",{attrs:{nav:"",dense:""}},[i("v-list-item",[i("v-list-item-icon",[i("v-icon",[t._v("mdi-clock-outline")])],1),i("v-list-item-content",[i("v-list-item-title",[t._v(t._s(t.shiftLength))]),i("v-list-item-subtitle",[t._v("Shift Length")])],1)],1)],1),i("v-list",{attrs:{nav:"",dense:""}},[i("v-list-item",[i("v-list-item-icon",[i("v-icon",[t._v("mdi-account")])],1),i("v-list-item-content",[i("v-list-item-title",[t._v("£"+t._s(t.shiftCost))]),i("v-list-item-subtitle",[t._v("Shift Cost")])],1)],1)],1)],1),i("v-row",[i("v-col",{staticClass:"pl-0 pr-0"},[i("v-divider"),i("v-row",{attrs:{"no-gutters":""}},[t.creator?i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[t._v("\n                                        Shift Creator: #"+t._s(t.creator.id)+" "+t._s(t.creator.full_name)+" ("+t._s(t.creator.email)+")\n                                    ")]):t._e(),t.moderator?i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[t._v("\n                                        Shift Moderator: #"+t._s(t.moderator.id)+" "+t._s(t.moderator.full_name)+" ("+t._s(t.moderator.email)+")\n                                    ")]):t._e(),t.restaurateur_creator?i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[t._v("\n                                        Shift Creator: #"+t._s(t.restaurateur_creator.id)+" "+t._s(t.restaurateur_creator.name)+" ("+t._s(t.restaurateur_creator.email)+")\n                                    ")]):t._e(),t.restaurateur_moderator?i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[t._v("\n                                        Shift Moderator: #"+t._s(t.restaurateur_moderator.id)+" "+t._s(t.restaurateur_moderator.name)+" ("+t._s(t.restaurateur_moderator.email)+")\n                                    ")]):t._e()],1)],1)],1)],1),i("v-col",{attrs:{xs:"12",sm:"9",md:"9"}},[i("v-form",{ref:"form"},[i("v-row",[i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[t.driver_rejected_id?i("i",{staticClass:"blue lighten-4"},[i("v-icon",{staticStyle:{"font-size":"14px",color:"#2196F3"}},[t._v("mdi-information-outline")]),t._v(" Shift rejected by "+t._s(t.getDriverFullName(t.driver_rejected_id)))],1):t._e(),i("v-autocomplete",{attrs:{label:"Select driver","item-text":"full_name","item-value":"id",items:t.driverListSearched,"error-messages":t.selectDriverErrors,required:"",dense:"",solo:""},on:{input:function(e){return t.$v.driver_id.$touch()},blur:function(e){return t.$v.driver_id.$touch()}},model:{value:t.driver_id,callback:function(e){t.driver_id=e},expression:"driver_id"}})],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-autocomplete",{staticClass:"hide-time-picker-indicator",attrs:{type:"time","menu-props":"auto, overflowY","clear-icon":"mdi-close","prepend-icon":"mdi-clock-outline",clearable:"",outlined:"",label:"Start Time*",hint:"Example: 08:00",required:"",items:t.timeList,"item-text":"name","item-value":"value","error-messages":t.startTimeErrors,dense:""},on:{input:function(e){return t.$v.start_time.$touch()},blur:function(e){return t.$v.start_time.$touch()}},model:{value:t.start_time,callback:function(e){t.start_time=e},expression:"start_time"}})],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-autocomplete",{staticClass:"hide-time-picker-indicator",attrs:{type:"time","menu-props":"auto, overflowY","clear-icon":"mdi-close","prepend-icon":"mdi-clock-outline",clearable:"",outlined:"",label:"Finish Time*",hint:"Example: 18:30",required:"",items:t.timeList,"item-text":"name","item-value":"value","error-messages":t.finishTimeErrors,dense:""},on:{input:function(e){return t.$v.finish_time.$touch()},blur:function(e){return t.$v.finish_time.$touch()}},model:{value:t.finish_time,callback:function(e){t.finish_time=e},expression:"finish_time"}})],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-text-field",{attrs:{type:"number","prepend-icon":"mdi-wallet-giftcard",label:"Add Driver Bonus",required:"",outlined:"",dense:""},model:{value:t.cost_bonus,callback:function(e){t.cost_bonus=e},expression:"cost_bonus"}})],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-text-field",{attrs:{type:"number","prepend-icon":"mdi-gas-station",label:"Add Fuel Bonus",required:"",outlined:"",dense:""},model:{value:t.const_fuel_bonus,callback:function(e){t.const_fuel_bonus=e},expression:"const_fuel_bonus"}})],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-text-field",{attrs:{type:"number","prepend-icon":"mdi-wallet-giftcard",label:"Cancellation fee/bonus",hint:"hidden for restaurants",min:"0",required:"",outlined:"",dense:""},model:{value:t.cost_extra_bonus,callback:function(e){t.cost_extra_bonus=e},expression:"cost_extra_bonus"}})],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("span",{staticClass:"adjustment-type"},[t._v("Extra Request")]),i("v-checkbox",{attrs:{"true-value":1,"false-value":0,label:"Yes"},model:{value:t.extra_request,callback:function(e){t.extra_request=e},expression:"extra_request"}})],1),i("v-col",{staticClass:"pb-0",attrs:{cols:"12",sm:"12"}},[i("v-textarea",{attrs:{outlined:"",label:"Comment"},model:{value:t.comment,callback:function(e){t.comment=e},expression:"comment"}})],1),t.area_selected?i("v-col",{staticClass:"pb-0",attrs:{sm:"12"}},[i("v-row",[i("v-col",{staticClass:"d-flex flex-column justify-space-between pa-0 pr-3",staticStyle:{height:"80px"},attrs:{cols:"12",sm:"6"}},[i("span",{staticClass:"adjustment-type"},[t._v("Mon – Thurs Pay/Hr*")]),i("div",{staticClass:"adjustment"},[i("v-text-field",{staticClass:"adjustment-input",attrs:{prefix:"£",readonly:"",outlined:"",value:t.restaurant_selected.standard_pay?t.restaurant_selected.standard_pay:t.area_selected.standardPayRate,required:""}})],1)]),i("v-col",{staticClass:"d-flex flex-column justify-space-between pa-0 pl-3",staticStyle:{height:"80px"},attrs:{cols:"12",sm:"6"}},[i("span",{staticClass:"adjustment-type"},[t._v("Fri-Sun Pay/Hr*")]),i("div",{staticClass:"adjustment"},[i("v-text-field",{staticClass:"adjustment-input",attrs:{prefix:"£",readonly:"",outlined:"",value:t.restaurant_selected.weekend_pay?t.restaurant_selected.weekend_pay:t.area_selected.weekendPayRate,required:""}})],1)])],1)],1):t._e()],1),i("div",{staticClass:"d-flex justify-center"},[i("v-btn",{staticClass:"mr-4 primary",attrs:{depressed:"",disabled:this.$v.$invalid||t.localLoading||t.selectDriverErrors.length>0,loading:t.localLoading},on:{click:t.submit}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-upload")]),t._v("Save")],1),i("v-btn",{staticClass:"mr-4",attrs:{loading:t.localLoading,depressed:""},on:{click:t.clear}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-rotate-left")]),t._v("Restore")],1),i("v-btn",{staticClass:"mr-4 warning",attrs:{loading:t.localLoading,depressed:""},on:{click:function(e){t.dialog=!1}}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-cancel")]),t._v("Cancel")],1)],1)],1)],1)],1)],1)],1):t._e()],1)],1)}),[],!1,null,"3e29c9f9",null);e.a=I.exports;h()(I,{VAutocomplete:u.a,VBtn:v.a,VCard:f.a,VCardText:p.b,VCardTitle:p.c,VCheckbox:g.a,VCol:b.a,VDialog:$.a,VDivider:y.a,VForm:S.a,VIcon:k.a,VList:x.a,VListItem:H.a,VListItemContent:T.a,VListItemIcon:w.a,VListItemSubtitle:T.b,VListItemTitle:T.c,VRow:C.a,VTextField:D.a,VTextarea:L.a})},f465:function(t,e,i){"use strict";var s=i("c1df"),a=i.n(s),r=i("2ef0"),o=i("1168"),n={name:"CopyShiftsModal",props:["shiftList","intervalId","dateRangeSelected"],data:()=>({readOnly:!1,localLoading:!1,dialog:!1,date_range_selected:null,INTERVAL_DAY:o.b}),watch:{dialog:function(t){if(t){let t=a()();switch(this.isShiftsEmpty||(t=a()(this.$props.shiftList[0].period_date,"YYYY-MM-DD")),this.$props.intervalId){case o.b:alert("unready");break;case o.e:t.add(1,"weeks");break;case o.d:t.add(2,"weeks");break;case o.c:t.add(1,"months")}this.$data.date_range_selected=this.dateRangeSelected,this.dateRangeSelect()}}},created(){this.$data.date_range_selected=this.dateRangeSelected},updated(){},computed:{isShiftsEmpty(){return r.isEmpty(this.$props.shiftList)},shiftsRangeText(){if(this.isShiftsEmpty)return"no shifts";let t=this.dayToRange(this.dateRangeSelected,this.$props.intervalId);return o.a.dateRangeText(t)}},methods:{submit(){this.localLoading=!0,this.$store.dispatch("copyShifts",{shifts:this.$props.shiftList,to_date:this.$data.date_range_selected[0]}).then(()=>{this.dialog=!1}).finally(()=>{this.localLoading=!1})},dateRangeSelect:async function(){this.$data.date_range_selected=this.dayToRange(this.$data.date_range_selected[0],this.$props.intervalId)},dayToRange:function(t,e){return o.a.dayToRange(t,e)},dateRangeText:function(t){return"to: "+o.a.dateRangeText(t)}}},d=i("2877"),l=i("6544"),c=i.n(l),_=i("8336"),m=i("b0af"),h=i("99d9"),u=i("62ad"),v=i("2e4b"),f=i("169a"),p=i("132d"),g=i("0fd9"),b=Object(d.a)(n,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-dialog",{attrs:{width:"450px"},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on;return[i("v-btn",t._g({attrs:{disabled:t.INTERVAL_DAY==t.intervalId}},s),[i("v-icon",[t._v("mdi-content-copy")]),t._v(" Copy Shifts\n        ")],1)]}}]),model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[t.dialog?i("v-card",[i("v-card-title",[i("span",{staticClass:"headline"},[t._v("Copy shifts from: "+t._s(t.shiftsRangeText))]),i("div",{staticClass:"dialog-closeBtn",on:{click:function(e){t.dialog=!1}}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-close")])],1)]),i("v-row",[i("v-col",[t._v("\n                    Please select period where to copy current shifts:\n                ")])],1),i("v-row",[i("v-col",[i("v-date-picker",{attrs:{scrollable:"",actions:"","full-width":"","first-day-of-week":"1",range:"","title-date-format":t.dateRangeText},on:{"click:date":t.dateRangeSelect},model:{value:t.date_range_selected,callback:function(e){t.date_range_selected=e},expression:"date_range_selected"}})],1)],1),i("v-row",[i("v-col",[i("div",{staticClass:"d-flex justify-center"},[i("v-btn",{staticClass:"mr-4 primary",attrs:{depressed:"",disabled:t.localLoading||t.isShiftsEmpty,loading:t.localLoading},on:{click:t.submit}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-content-copy")]),t._v("Make Copy of Shifts")],1),i("v-btn",{staticClass:"warning",attrs:{loading:t.localLoading,depressed:""},on:{click:function(e){t.dialog=!1}}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-cancel")]),t._v("Cancel")],1)],1)])],1)],1):t._e()],1)}),[],!1,null,"5951d3ce",null);e.a=b.exports;c()(b,{VBtn:_.a,VCard:m.a,VCardTitle:h.c,VCol:u.a,VDatePicker:v.a,VDialog:f.a,VIcon:p.a,VRow:g.a})}}]);