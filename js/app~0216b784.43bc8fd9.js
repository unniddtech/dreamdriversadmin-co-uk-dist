(window.webpackJsonp=window.webpackJsonp||[]).push([["app~0216b784"],{"136a":function(t,e,i){"use strict";var s=i("1dce"),a=i("b5ae"),r={mixins:[s.validationMixin],name:"RequestInvoiceRestaurantModal",props:["periodDateFrom","periodDateTo","restaurantId","driverId","disabled"],validations:{invoice_number:{required:a.required},comission:{required:a.required}},data:()=>({localLoading:!1,dialog:!1,invoice_number:void 0,comission:1.5}),computed:{invoiceNumberErrors(){const t=[];return this.$v.invoice_number.$dirty?(!this.$v.invoice_number.required&&t.push("Invoice number is required"),t):t},invoiceComissionErrors(){const t=[];return this.$v.comission.$dirty?(!this.$v.comission.required&&t.push("Сommission is required"),t):t}},methods:{submit(){this.$v.$touch(),this.$v.$invalid||(this.localLoading=!0,this.$store.dispatch("requestInvoice",{invoice_number:this.invoice_number,comission:this.comission,period_date_from:this.periodDateFrom,period_date_to:this.periodDateTo,restaurant_id:this.restaurantId,driver_id:this.driverId}).then(()=>{this.clear(),this.dialog=!1}).finally(()=>{this.localLoading=!1}))},preview(){this.$v.$touch(),this.$v.$invalid||(this.localLoading=!0,this.$store.dispatch("previewInvoice",{invoice_number:this.invoice_number,comission:this.comission,period_date_from:this.periodDateFrom,period_date_to:this.periodDateTo,restaurant_id:this.restaurantId,driver_id:this.driverId}).then(()=>{}).finally(()=>{this.localLoading=!1}))},clear(){this.$v.$reset(),this.invoice_number=void 0,this.comission=1.5}}},o=i("2877"),n=i("6544"),l=i.n(n),d=i("8336"),c=i("b0af"),_=i("99d9"),m=i("62ad"),u=i("169a"),h=i("4bd4"),v=i("132d"),p=i("0fd9"),f=i("8654"),b=i("3a2f"),g=Object(o.a)(r,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-dialog",{attrs:{width:"400px"},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on.click;return[i("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on;return[i("span",t._g({},t.disabled&&a),[i("v-btn",{attrs:{disabled:t.disabled},on:{click:s}},[i("v-icon",[t._v("mdi-file-document-outline")]),t._v(" Invoice\n                    ")],1)],1)]}}],null,!0)},[i("span",[t._v("Restaurant not selected")])])]}}]),model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[t.dialog?i("v-card",[i("v-card-title",[i("span",{staticClass:"headline"},[t._v("Request invoice")]),i("div",{staticClass:"dialog-closeBtn",on:{click:function(e){t.dialog=!1}}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-close")])],1)]),i("v-card-text",[i("v-row",{attrs:{align:"stretch"}},[i("v-col",[i("v-form",{ref:"form"},[i("v-row",[i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("v-text-field",{attrs:{outlined:"",label:"Invoice number*",hint:"A000125",required:"","error-messages":t.invoiceNumberErrors,dense:""},on:{input:function(e){return t.$v.invoice_number.$touch()},blur:function(e){return t.$v.invoice_number.$touch()}},model:{value:t.invoice_number,callback:function(e){t.invoice_number=e},expression:"invoice_number"}})],1)],1),i("v-row",[i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("v-text-field",{attrs:{outlined:"",label:"Сommission £ / hour *",hint:"Dream Drivers Сommission",required:"","error-messages":t.invoiceComissionErrors,dense:""},on:{input:function(e){return t.$v.comission.$touch()},blur:function(e){return t.$v.comission.$touch()}},model:{value:t.comission,callback:function(e){t.comission=e},expression:"comission"}})],1)],1),i("div",{staticClass:"d-flex justify-center"},[i("v-btn",{staticClass:"mr-4 primary",attrs:{depressed:"",disabled:this.$v.$invalid||t.localLoading,loading:t.localLoading},on:{click:t.preview}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-eye")]),t._v("Preview")],1),i("v-btn",{staticClass:"mr-4 primary",attrs:{depressed:"",disabled:this.$v.$invalid||t.localLoading,loading:t.localLoading},on:{click:t.submit}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-upload")]),t._v("Download")],1),i("v-btn",{staticClass:"mr-4 warning",attrs:{loading:t.localLoading,depressed:""},on:{click:function(e){t.dialog=!1}}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-cancel")]),t._v("Cancel")],1)],1)],1)],1)],1)],1)],1):t._e()],1)}),[],!1,null,"b78e3b9e",null);e.a=g.exports;l()(g,{VBtn:d.a,VCard:c.a,VCardText:_.b,VCardTitle:_.c,VCol:m.a,VDialog:u.a,VForm:h.a,VIcon:v.a,VRow:p.a,VTextField:f.a,VTooltip:b.a})},"1cbf":function(t,e,i){"use strict";var s=i("1dce"),a=i("b5ae"),r=i("2f62"),o=i("c1df"),n=i.n(o),l=i("c64f"),d=i("1168"),c=i("2ef0"),_={mixins:[s.validationMixin],name:"NewTimesheetModal",validations:{restaurant_id:{required:a.required},driver_id:{required:a.required},period_date:{required:a.required},start_time:{required:a.required},finish_time:{required:a.required},comment:{}},data:()=>({readOnly:!1,localLoading:!1,dialog:!1,period_date_max:n()().format("YYYY-MM-DD"),menu_date_picker:!1,timesheet_date_picker:!1,period_date_selected:null,restaurant_selected:void 0,area_selected:void 0,restaurant_id:void 0,driver_id:void 0,period_date:void 0,start_time:void 0,finish_time:void 0,comment:void 0,start_time_was_clean:!1,finish_time_was_clean:!1}),updated(){},watch:{period_date:function(t,e){e!=t&&/\d\d\/\d\d\/\d\d\d\d/.test(t)&&(this.$data.period_date_selected=n()(t,"DD/MM/YYYY").format("YYYY-MM-DD"))},restaurant_id:function(t){this.$data.restaurant_selected=c.find(this.restaurant_list,e=>+e.id==+t),this.$data.restaurant_selected&&(this.$data.area_selected=c.find(this.areas,t=>+t.id==+this.$data.restaurant_selected.area_id))}},computed:{...Object(r.c)(["areas","timeList"]),driver_list(){return this.$store.getters.drivers},restaurant_list(){return this.$store.getters.restaurants},driverListSearched(){if(!this.$data.restaurant_id)return[];let t=c.find(this.restaurant_list,t=>+t.id==+this.$data.restaurant_id);return t?c.filter(this.driver_list,e=>{if(0==e.area_ids.length)return!0;return-1!==c.map(e.area_ids,t=>t.area_id).indexOf(t.area_id)&&(0==e.restaurant_ids.length||!!c.find(e.restaurant_ids,e=>e.restaurant_id==t.id))}):[]},selectDriverErrors(){const t=[];return this.$v.driver_id.$dirty?(!this.$v.driver_id.required&&t.push("Driver is required"),t):t},selectAreaErrors(){const t=[];return this.$v.restaurant_id.$dirty?(!this.$v.restaurant_id.required&&t.push("Area is required"),t):t},periodDateErrors(){const t=[];return this.$v.period_date.$dirty?(!this.$v.period_date.required&&t.push("Date is required."),!n()(this.$data.period_date,"DD/MM/YYYY").isValid()&&t.push("Date invalid format."),t):t},startTimeErrors(){const t=[];return this.$v.start_time.$dirty?(!this.$v.start_time.required&&t.push("Start Time is required."),!n()(this.$data.start_time,"HH:mm").isValid()&&t.push("Start Time invalid format."),t):t},finishTimeErrors(){const t=[];return this.$v.finish_time.$dirty?(!this.$v.finish_time.required&&t.push("Start Time is required."),!n()(this.$data.finish_time,"HH:mm").isValid()&&t.push("Finish Time invalid format."),t):t}},methods:{submit(){if(this.$v.$touch(),!this.$v.$invalid){let t=c.find(this.restaurant_list,t=>+t.id==+this.$data.restaurant_id),e=c.find(this.areas,e=>e.id==t.area_id),i=this.$data.restaurant_selected.standard_pay?this.$data.restaurant_selected.standard_pay:e.standardPayRate,s=n()(this.$data.period_date,"DD/MM/YYYY");5!==s.isoWeekday()&&6!==s.isoWeekday()&&7!==s.isoWeekday()||(i=this.$data.restaurant_selected.weekend_pay?this.$data.restaurant_selected.weekend_pay:e.weekendPayRate);const a={shift_id:null,restaurant_id:this.$data.restaurant_id,driver_id:this.$data.driver_id,status:l.c,status_progress:l.i,period_date:n()(this.$data.period_date,"DD/MM/YYYY").format("YYYY-MM-DD"),start_time:this.$data.start_time,finish_time:this.$data.finish_time,meal_time:0,rest_time:0,cost_per_hour:i,cost_bonus:0,const_fuel_bonus:0,cost_extra_bonus:0,fuel_bonus_0:0,fuel_bonus_3:0,fuel_bonus_6:0,comment:this.$data.comment};let r=this.getShiftHours(a);a.cost_total=+a.cost_per_hour*+r,this.localLoading=!0,this.$store.dispatch("createNewTimesheet",a).then(()=>{}).finally(()=>{this.localLoading=!1,this.clear(),this.dialog=!1})}},periodDateSelect:function(){this.$data.period_date=n()(this.$data.period_date_selected,"YYYY-MM-DD").format("DD/MM/YYYY"),this.$data.timesheet_date_picker=!1},getPeriodDateText:function(t){return n()(t,"YYYY-MM-DD").format("DD/MM/YYYY")},getShiftHours:function(t){return d.a.getShiftHours(t)},clear(){this.$v.$reset(),this.area_selected=void 0,this.restaurant_id=void 0,this.driver_id=void 0,this.start_time="",this.finish_time="",this.period_date=void 0},onStartTimeFocused:function(){this.start_time||(this.start_time=this.timeToApproximation(n()().format("HH:mm")),this.start_time_was_clean=!0)},onStartTimeChanged:function(){this.$v.start_time.$touch(),this.start_time_was_clean=!1},onStartTimeBlur:function(){this.start_time_was_clean&&(this.start_time=void 0),this.$v.start_time.$touch()},onFinishTimeFocused:function(){this.finish_time||(this.finish_time=this.timeToApproximation(n()().format("HH:mm")),this.finish_time_was_clean=!0)},onFinishTimeChanged:function(){this.$v.finish_time.$touch(),this.finish_time_was_clean=!1},onFinishTimeBlur:function(){this.finish_time_was_clean&&(this.finish_time=void 0),this.$v.finish_time.$touch()},timeToApproximation:function(t){let e=n()(t,"HH:mm:ss");if(!e.isValid())return t;let i=c.find(this.timeList,t=>(n()(t.value,"HH:mm")-e)/36e5>-.125);return i?i.value:t}}},m=i("2877"),u=i("6544"),h=i.n(u),v=i("c6a6"),p=i("8336"),f=i("b0af"),b=i("99d9"),g=i("62ad"),S=i("2e4b"),$=i("169a"),x=i("4bd4"),T=i("132d"),D=i("e449"),k=i("0fd9"),w=i("8654"),C=i("a844"),y=Object(m.a)(_,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-dialog",{attrs:{width:"700px"},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on;return[i("v-btn",t._g({},s),[i("v-icon",{attrs:{left:""}},[t._v("mdi-plus")]),t._v("Add Time Sheet\n        ")],1)]}}]),model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[t.dialog?i("v-card",[i("v-card-title",[i("span",{staticClass:"headline"},[t._v("Add a New Time Sheet")]),i("div",{staticClass:"dialog-closeBtn",on:{click:function(e){t.dialog=!1}}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-close")])],1)]),i("v-card-text",[i("v-row",{attrs:{align:"stretch"}},[i("v-col",[i("v-form",{ref:"form"},[i("v-row",[i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("v-autocomplete",{attrs:{"prepend-icon":"mdi-map-marker",label:"Select Restaurant","item-text":"name","item-value":"id",items:t.restaurant_list,"error-messages":t.selectAreaErrors,required:"",dense:""},on:{blur:function(e){return t.$v.restaurant_id.$touch()}},model:{value:t.restaurant_id,callback:function(e){t.restaurant_id=e},expression:"restaurant_id"}})],1),i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("v-autocomplete",{attrs:{"prepend-icon":"mdi-account",label:"Select driver","item-text":"full_name","item-value":"id",disabled:!t.restaurant_id,items:t.driverListSearched,"error-messages":t.selectDriverErrors,required:"",dense:""},on:{blur:function(e){return t.$v.driver_id.$touch()}},model:{value:t.driver_id,callback:function(e){t.driver_id=e},expression:"driver_id"}})],1),i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("v-menu",{attrs:{transition:"scale-transition","close-on-content-click":!1,"nudge-width":200,"max-width":"346px","offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on;return[i("v-text-field",t._g({attrs:{"clear-icon":"mdi-close","prepend-icon":"mdi-calendar",clearable:"",outlined:"",label:"Date*",hint:"22/11/2019",required:"","error-messages":t.periodDateErrors,autocomplete:"off"},on:{input:function(e){return t.$v.period_date.$touch()},blur:function(e){return t.$v.period_date.$touch()}},model:{value:t.period_date,callback:function(e){t.period_date=e},expression:"period_date"}},s))]}}],null,!1,2937805055),model:{value:t.timesheet_date_picker,callback:function(e){t.timesheet_date_picker=e},expression:"timesheet_date_picker"}},[i("v-card",{attrs:{"max-width":"346px"}},[i("v-date-picker",{attrs:{scrollable:"",actions:"","full-width":"","first-day-of-week":"1","title-date-format":t.getPeriodDateText,max:t.period_date_max},on:{"click:date":t.periodDateSelect},model:{value:t.period_date_selected,callback:function(e){t.period_date_selected=e},expression:"period_date_selected"}})],1)],1)],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-autocomplete",{staticClass:"hide-time-picker-indicator",attrs:{type:"text","menu-props":"auto, overflowY","clear-icon":"mdi-close","prepend-icon":"mdi-clock-outline",clearable:"",outlined:"",label:"Start Time*",hint:"Example: 08:00",required:"",items:t.timeList,"item-text":"name","item-value":"value","error-messages":t.startTimeErrors,"open-on-clear":"",dense:""},on:{focus:t.onStartTimeFocused,input:t.onStartTimeChanged,blur:t.onStartTimeBlur},model:{value:t.start_time,callback:function(e){t.start_time=e},expression:"start_time"}})],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-autocomplete",{staticClass:"hide-time-picker-indicator",attrs:{type:"text","menu-props":"auto, overflowY","clear-icon":"mdi-close","prepend-icon":"mdi-clock-outline",clearable:"",outlined:"",label:"Finish Time*",hint:"Example: 18:30",required:"",items:t.timeList,"item-text":"name","item-value":"value","error-messages":t.finishTimeErrors,"open-on-clear":"",dense:""},on:{focus:t.onFinishTimeFocused,input:t.onFinishTimeChanged,blur:t.onFinishTimeBlur},model:{value:t.finish_time,callback:function(e){t.finish_time=e},expression:"finish_time"}})],1),i("v-col",{staticClass:"pb-0",attrs:{cols:"12",sm:"12"}},[i("v-textarea",{attrs:{outlined:"",label:"Comment"},model:{value:t.comment,callback:function(e){t.comment=e},expression:"comment"}})],1),t.area_selected?i("v-col",{staticClass:"pb-0",attrs:{sm:"12"}},[i("v-row",[i("v-col",{staticClass:"d-flex flex-column justify-space-between pa-0 pr-3",staticStyle:{height:"80px"},attrs:{cols:"12",sm:"6"}},[i("span",{staticClass:"adjustment-type"},[t._v("Mon – Thurs Pay/Hr*")]),i("div",{staticClass:"adjustment"},[i("v-text-field",{staticClass:"adjustment-input",attrs:{prefix:"£",readonly:"",outlined:"",value:t.restaurant_selected.standard_pay?t.restaurant_selected.standard_pay:t.area_selected.standardPayRate,required:""}})],1)]),i("v-col",{staticClass:"d-flex flex-column justify-space-between pa-0 pl-3",staticStyle:{height:"80px"},attrs:{cols:"12",sm:"6"}},[i("span",{staticClass:"adjustment-type"},[t._v("Fri-Sun Pay/Hr*")]),i("div",{staticClass:"adjustment"},[i("v-text-field",{staticClass:"adjustment-input",attrs:{prefix:"£",readonly:"",outlined:"",value:t.restaurant_selected.weekend_pay?t.restaurant_selected.weekend_pay:t.area_selected.weekendPayRate,required:""}})],1)])],1)],1):t._e()],1),i("div",{staticClass:"d-flex justify-center"},[i("v-btn",{staticClass:"mr-4 primary",attrs:{depressed:"",disabled:this.$v.$invalid||t.localLoading,loading:t.localLoading},on:{click:t.submit}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-upload")]),t._v("Create Time Sheet")],1),i("v-btn",{staticClass:"mr-4",attrs:{loading:t.localLoading,depressed:""},on:{click:t.clear}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-rotate-left")]),t._v("Clear")],1),i("v-btn",{staticClass:"mr-4 warning",attrs:{loading:t.localLoading,depressed:""},on:{click:function(e){t.dialog=!1}}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-cancel")]),t._v("Cancel")],1)],1)],1)],1)],1)],1)],1):t._e()],1)}),[],!1,null,"57aa8eb8",null);e.a=y.exports;h()(y,{VAutocomplete:v.a,VBtn:p.a,VCard:f.a,VCardText:b.b,VCardTitle:b.c,VCol:g.a,VDatePicker:S.a,VDialog:$.a,VForm:x.a,VIcon:T.a,VMenu:D.a,VRow:k.a,VTextField:w.a,VTextarea:C.a})},"252d":function(t,e,i){"use strict";i("bf0f")},"30d0":function(t,e,i){},4750:function(t,e,i){"use strict";var s=i("c1df"),a=i.n(s),r=i("2b0e"),o=i("2ef0"),n=i("2f62"),l=i("156f"),d=i("1168"),c=i("c64f"),_=i("1dce"),m=i("b5ae"),u=i("755e"),h=i("c459"),v=i.n(h),p=i("2a83"),f=i.n(p),b=i("2744"),g=i.n(b);const S={lat:51.4,lng:0};var $={name:"TimesheetRestaurant",mixins:[_.validationMixin],validations:{restaurant_id:{required:m.required},period_date:{required:m.required},start_time:{required:m.required},finish_time:{required:m.required},comment:{},driver_comment:{}},data:()=>({scroll_panel_height:window.innerHeight-122,TYPE_AREA:l.b,TYPE_RESTAURANT:l.c,STATUS_PENDING:c.c,STATUS_DISCARDED:c.b,STATUS_APPROVED:c.a,STATUS_PROGRESS_IN_WORK:c.f,STATUS_PROGRESS_SUBMITED:c.i,STATUS_PROGRESS_NOT_SUBMITED:c.g,STATUS_PROGRESS_PAY_APPROVED:c.h,STATUS_PROGRESS_TIME_APPROVED:c.j,STATUS_PROGRESS_DISCARDED:c.d,STATUS_PROGRESS_DISCARDED_BY_DRIVER:c.e,ICON_START:v.a,ICON_FINISH:f.a,ICON_RESTAURANT:g.a,interval_list:[{id:d.b,name:"Day",$isDisabled:!0},{id:d.e,name:"Week"},{id:d.d,name:"2-Week"},{id:d.c,name:"Month"}],status_list:[{id:10,name:"Active"},{id:20,name:"Pending"},{id:50,name:"All"}],bonus_list:[{id:0,name:"no bonus"},{id:10,name:"+£10"},{id:20,name:"+£20"},{id:-10,name:"-£10"},{id:-20,name:"-£20"}],localLoading:!1,approvePeriodLoading:!1,xlsExportLoading:!1,date_range_selected:null,period_date_selected:null,period_date_max:a()().add(1,"days").format("YYYY-MM-DD"),timesheet_selected:null,menu_date_picker:!1,timesheet_date_picker:!1,location_selected:void 0,interval_selected_id:d.e,status_selected_id:50,selected_driver_index:void 0,selected_driver:void 0,search_driver:"",driver_list_calc:[],select_time_sheet:void 0,select_time_sheet_index:0,compatable_shift:void 0,restaurant_id:void 0,period_date:void 0,start_time:void 0,finish_time:void 0,comment:void 0,driver_comment:void 0,cost_bonus:0,const_fuel_bonus:0,cost_extra_bonus:0,fuel_bonus_0:0,fuel_bonus_3:0,fuel_bonus_6:0,fuel_bonus_0_default:0,fuel_bonus_3_default:0,fuel_bonus_6_default:0,const_fuel_bonus:0,map_center:S,map_zoom:8,map_marker_start:void 0,map_marker_finish:void 0,map_marker_resturant:void 0,totals:{total_timesheets:0,filled_hours:0,estimated_cost:0,expected_sales:0,approved:0,unapproved:0,free:0},fixed_panel:!0,tool_bar_timesheet_form_height:396,area_list:[{name:"All restaurants",type:l.b,_guid:{type:l.b}}],restaurant_list:[],is_mobile_version:!1,restaurant_id_mobile_selected:void 0,restaurant_item_mobile_selected:void 0,driver_id_mobile_selected:void 0,driver_item_mobile_selected:void 0,start_time_was_clean:!1,finish_time_was_clean:!1,showModalMobile:!1}),created(){let t=!1;var e;e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),this.is_mobile_version=t},computed:{...Object(n.c)({timeList:"timeList",driver_list:"drivers",shift_list:"shifts",timesheet_list:"timesheets",options:"options"}),locations_list(){let t=[];return t.push(this.area_list[0]),o.each(this.restaurant_list,e=>{e._guid={id:e.id,type:l.c},t.push(e)}),t},restaurantListSearched(){if(!this.$data.location_selected)return this.restaurant_list;if(this.$data.location_selected.type==l.c){let t=o.find(this.restaurant_list,t=>t.id==this.$data.location_selected.id);return t?[t]:[]}return this.restaurant_list},driverListSearched(){let t=o.map(this.driver_list,t=>t);this.$data.search_driver&&(t=o.filter(t,t=>-1!==t.full_name.toLowerCase().indexOf(this.$data.search_driver)));let e=o.map(this.timesheetListSearched,t=>+t.driver_id);if(t=o.filter(t,t=>-1!==e.indexOf(+t.id)),this.$data.location_selected&&this.$data.location_selected.type==l.c&&(t=o.filter(t,t=>{if(!t.restaurant_ids||0==t.restaurant_ids.length)return!0;return-1!==o.map(t.restaurant_ids,t=>t.restaurant_id).indexOf(this.$data.location_selected.id)})),0==t.length||t.length>0&&null!==t[0].id){let e={id:-1,full_name:"All drivers"},i={id:-2,full_name:"Open shift"};t.unshift(i),t.unshift(e)}return t},timesheetListSearched(){let t=this.shift_list;t=o.filter(t,t=>t.status!=d.g);let e=[];if(10==this.$data.status_selected_id||50==this.$data.status_selected_id)for(let t=0;t<this.timesheet_list.length;t++)e.push(this.timesheet_list[t]);if(20==this.$data.status_selected_id||50==this.$data.status_selected_id)for(let i=0;i<t.length;i++){let s=o.find(this.timesheet_list,e=>+e.shift_id==+t[i].id);if(o.isEmpty(s)){let s={id:-i,//! negative
shift_id:t[i].id,restaurant_id:t[i].restaurant_id,driver_id:t[i].driver_id,status:c.c,status_progress:c.g,period_date:t[i].period_date,start_time:t[i].start_time,finish_time:t[i].finish_time,meal_time:0,rest_time:0,cost_per_hour:t[i].cost_per_hour,cost_bonus:t[i].cost_bonus,const_fuel_bonus:t[i].const_fuel_bonus,cost_extra_bonus:t[i].cost_extra_bonus,cost_total:t[i].cost_total,//! BUG need recalculate
comment:t[i].comment};e.push(s)}}for(let t=0;t<e.length;t++){let i=+e[t].cost_per_hour*this.getShiftHours(e[t]);e[t].cost_bonus&&(i=parseFloat(i)+ +parseFloat(e[t].cost_bonus)),e[t].const_fuel_bonus&&(i=parseFloat(i)+ +parseFloat(e[t].const_fuel_bonus)),e[t].cost_total=i}if(void 0!==this.$data.location_selected){let t=o.map(this.restaurantListSearched,t=>+t.id);e=o.filter(e,e=>-1!==t.indexOf(+e.restaurant_id))}return e=o.orderBy(e,t=>t.start_time),e=o.orderBy(e,t=>t.period_date),e},timesheetListSearchedFilterDriver(){let t=this.timesheetListSearched;return void 0!==this.$data.selected_driver&&(t=o.filter(t,t=>t.driver_id==this.$data.selected_driver.id)),void 0!==this.$data.driver_item_mobile_selected&&(t=o.filter(t,t=>t.driver_id==this.$data.driver_item_mobile_selected.id)),t},periodDateErrors(){const t=[];return this.$v.period_date.$dirty?(!this.$v.period_date.required&&t.push("Date is required."),!a()(this.$data.period_date,"DD/MM/YYYY").isValid()&&t.push("Date invalid format."),t):t},selectAreaErrors(){const t=[];return this.$v.restaurant_id.$dirty?(!this.$v.restaurant_id.required&&t.push("Area is required"),t):t},startTimeErrors(){const t=[];return this.$v.start_time.$dirty?(!this.$v.start_time.required&&t.push("Start Time is required."),!a()(this.$data.start_time,"HH:mm").isValid()&&t.push("Start Time invalid format."),t):t},finishTimeErrors(){const t=[];return this.$v.finish_time.$dirty?(!this.$v.finish_time.required&&t.push("Start Time is required."),!a()(this.$data.finish_time,"HH:mm").isValid()&&t.push("Finish Time invalid format."),t):t},timeSheetEditDisabled(){return!this.$data.select_time_sheet||this.$data.select_time_sheet.status==c.a},unapprovedTimesheets(){return o.filter(this.timesheetListSearchedFilterDriver,t=>t.status==c.c&&t.driver_id).length},google:u.gmapApi},watch:{period_date:function(t){this.$data.period_date_selected!=t&&/\d\d\/\d\d\/\d\d\d\d/.test(t)&&(this.$data.period_date_selected=a()(t,"DD/MM/YYYY").format("YYYY-MM-DD"))},timesheetListSearched:function(t){if(0==t.length)return;let e=[];for(let i=0;i<t.length;i++)e[i]=this.getShiftHours(t[i]);let i=this.driverListSearched;this.$data.driver_list_calc=[];for(let s=0;s<i.length;s++){let a={cost:0,hours:0,timesheets:0};for(let r=0;r<t.length;r++)(t[r].driver_id==i[s].id||null==t[r].driver_id&&-2==i[s].id)&&(a.cost=+a.cost+ +t[r].cost_total,
//! cost_bonus and const_fuel_bonus already attached into cost_total
a.hours=+a.hours+e[r],a.timesheets=a.timesheets+1);this.$data.driver_list_calc[s]=a}},timesheetListSearchedFilterDriver:function(t){if(this.$data.totals.total_timesheets=t.length,this.$data.totals.filled_hours=0,this.$data.totals.estimated_cost=0,this.$data.totals.expected_sales=0,this.$data.totals.approved=0,this.$data.totals.unapproved=0,this.$data.totals.free=0,0==t.length)return;if(void 0!==this.$data.selected_driver){let e=this.$data.selected_driver.id;t=o.filter(t,t=>t.driver_id==e)}let e=[];for(let i=0;i<t.length;i++)e[i]=this.getShiftHours(t[i]),this.$data.totals.filled_hours+=e[i],t[i].status==c.a?(this.$data.totals.estimated_cost+=+t[i].cost_total,this.$data.totals.approved+=1):this.$data.totals.unapproved+=1,0==+t[i].driver_id&&(this.$data.totals.free+=1),this.$data.totals.expected_sales+=+t[i].cost_total;this.onSelectTimeSheet(this.$data.select_time_sheet_index)}},mounted(){this.$nextTick(()=>{window.addEventListener("resize",this.onResize)}),Promise.all([this.$store.dispatch("fetchOptions"),this.$store.dispatch("fetchDrivers")]).then(()=>{let t=o.find(this.options,t=>"map_center_default"==t.okey),e=JSON.parse(t.ovalue),i=o.find(this.options,t=>"fuel_bonus_0"==t.okey),s=o.find(this.options,t=>"fuel_bonus_3"==t.okey),r=o.find(this.options,t=>"fuel_bonus_6"==t.okey);i&&i.ovalue&&(this.fuel_bonus_0_default=i.ovalue),s&&s.ovalue&&(this.fuel_bonus_3_default=s.ovalue),r&&r.ovalue&&(this.fuel_bonus_6_default=r.ovalue),this.map_center={lat:e.lat,lng:e.lng},this.map_zoom=e.map_zoom;let n=a()();this.$data.date_range_selected=[n.startOf("isoWeek").format("YYYY-MM-DD"),null],this.dateRangeSelect().then(()=>{this.onSelectTimeSheet(0)})});let t=JSON.parse(localStorage.getItem("user")),e=[];o.each(t.restaurants,i=>{e.push({id:i.id,name:i.name,contact_name:i.contact_name,email:t.email,type:l.c,map_latitude:i.map_latitude,map_longitude:i.map_longitude})}),this.restaurant_list=e,!this.restaurant_item_mobile_selected&&this.restaurantListSearched.length>0&&(this.restaurant_id_mobile_selected=this.restaurantListSearched[0].id,this.onSelectRestaurantMobile(this.restaurant_id_mobile_selected))},beforeDestroy(){window.removeEventListener("resize",this.onResize)},methods:{calculateBonus(){this.const_fuel_bonus=this.fuel_bonus_0*this.fuel_bonus_0_default+this.fuel_bonus_3*this.fuel_bonus_3_default+this.fuel_bonus_6*this.fuel_bonus_6_default},onResize(){this.scroll_panel_height=window.innerHeight-122},dateRangeSelect:async function(){this.$data.date_range_selected=this.dayToRange(this.$data.date_range_selected[0],this.$data.interval_selected_id),await Promise.all([this.$store.dispatch("fetchShifts",{period_date_from:this.$data.date_range_selected[0],period_date_to:this.$data.date_range_selected[1],filter_draft:"1"}),this.$store.dispatch("fetchTimesheets",{period_date_from:this.$data.date_range_selected[0],period_date_to:this.$data.date_range_selected[1]}),this.$store.dispatch("fetchDrivers")]).then(()=>{})},periodDateSelect:function(){this.$data.period_date=a()(this.$data.period_date_selected,"YYYY-MM-DD").format("DD/MM/YYYY"),this.$data.timesheet_date_picker=!1},getDriverFullName:function(t){let e=o.find(this.driver_list,e=>e.id==t);return e?e.full_name:"Open shift"},onSelectInterval:function(){if(this.$data.interval_selected_id==d.e||this.$data.interval_selected_id==d.d||this.$data.interval_selected_id==d.c){let t=a()(this.$data.date_range_selected[0],"YYYY-MM-DD");this.$data.date_range_selected=[t.startOf("isoWeek").format("YYYY-MM-DD"),null]}if(this.$data.interval_selected_id==d.b){let t=a()();this.$data.date_range_selected=[t.format("YYYY-MM-DD"),null]}r.a.nextTick(()=>{this.dateRangeSelect().then(()=>{this.onSelectTimeSheet(0)})})},onSelectRestaurantMobile:function(t){this.restaurant_item_mobile_selected=o.find(this.restaurantListSearched,e=>e.id==t)},onSelectDriverMobile:function(t){this.driver_item_mobile_selected=o.find(this.driverListSearched,e=>e.id==t)},onPreviosRange:function(){let t=a()(this.$data.date_range_selected[0],"YYYY-MM-DD");switch(this.$data.interval_selected_id){case d.b:t.subtract(1,"day");break;case d.e:t.subtract(1,"weeks");break;case d.d:t.subtract(2,"weeks");break;case d.c:t.subtract(1,"months")}this.$data.date_range_selected=[t.format("YYYY-MM-DD"),null],this.dateRangeSelect().then(()=>{this.onSelectTimeSheet(0)})},onNextRange:function(){let t=a()(this.$data.date_range_selected[0],"YYYY-MM-DD");switch(this.$data.interval_selected_id){case d.b:t.add(1,"days");break;case d.e:t.add(1,"weeks");break;case d.d:t.add(2,"weeks");break;case d.c:t.add(1,"months")}this.$data.date_range_selected=[t.format("YYYY-MM-DD"),null],this.dateRangeSelect().then(()=>{this.onSelectTimeSheet(0)})},onChangeDriver:function(t){-1==t.id?r.a.nextTick(()=>{this.$data.selected_driver_index=void 0,this.$data.selected_driver=void 0}):r.a.nextTick(()=>{void 0!==this.$data.selected_driver_index?this.$data.selected_driver=t:this.$data.selected_driver=void 0})},onSelectTimeSheet:function(t){if(!this.timesheetListSearchedFilterDriver[t])return void this.zoomOnRestaurants();if(this.$data.select_time_sheet=this.timesheetListSearchedFilterDriver[t],this.$data.select_time_sheet_index=t,this.$data.restaurant_id=void 0,this.$data.period_date=void 0,this.$data.start_time=void 0,this.$data.finish_time=void 0,this.$data.comment=void 0,this.$data.driver_comment=void 0,this.$data.cost_bonus=0,this.$data.const_fuel_bonus=0,this.$data.cost_extra_bonus=0,this.$data.fuel_bonus_0=0,this.$data.fuel_bonus_3=0,this.$data.fuel_bonus_6=0,this.$v.$reset(),this.$data.select_time_sheet.status_progress!=c.g&&(this.$data.restaurant_id=+this.$data.select_time_sheet.restaurant_id,this.$data.period_date=a()(this.$data.select_time_sheet.period_date,"YYYY-MM-DD").format("DD/MM/YYYY"),this.$data.start_time=this.timeToApproximation(this.$data.select_time_sheet.start_time),this.$data.finish_time=this.timeToApproximation(this.$data.select_time_sheet.finish_time),this.$data.comment=this.$data.select_time_sheet.comment,this.$data.driver_comment=this.$data.select_time_sheet.driver_comment,this.$data.cost_bonus=+this.$data.select_time_sheet.cost_bonus,this.$data.const_fuel_bonus=+this.$data.select_time_sheet.const_fuel_bonus,this.$data.cost_extra_bonus=+this.$data.select_time_sheet.cost_extra_bonus,this.$data.fuel_bonus_0=+this.$data.select_time_sheet.fuel_bonus_0,this.$data.fuel_bonus_3=+this.$data.select_time_sheet.fuel_bonus_3,this.$data.fuel_bonus_6=+this.$data.select_time_sheet.fuel_bonus_6),this.$data.compatable_shift=o.find(this.shift_list,t=>+t.id==this.$data.select_time_sheet.shift_id),o.isEmpty(this.$data.comment)&&this.$data.compatable_shift&&this.$data.select_time_sheet.status_progress==c.g&&(this.$data.comment=this.$data.compatable_shift.comment),this.$data.map_marker_start=void 0,this.$data.select_time_sheet.map_start_lat&&this.$data.select_time_sheet.map_start_lng&&(this.$data.map_marker_start=this.google&&new this.google.maps.LatLng(this.$data.select_time_sheet.map_start_lat,this.$data.select_time_sheet.map_start_lng)),this.$data.map_marker_finish=void 0,this.$data.select_time_sheet.map_finish_lat&&this.$data.select_time_sheet.map_finish_lng&&(this.$data.map_marker_finish=this.google&&new this.google.maps.LatLng(this.$data.select_time_sheet.map_finish_lat,this.$data.select_time_sheet.map_finish_lng)),o.isEmpty(this.$data.map_marker_start)&&o.isEmpty(this.$data.map_marker_finish))this.zoomOnRestaurants();else{var e=[];o.isEmpty(this.$data.map_marker_start)||e.push(this.$data.map_marker_start),o.isEmpty(this.$data.map_marker_finish)||e.push(this.$data.map_marker_finish);var i=this.google&&new this.google.maps.LatLngBounds;o.each(e,t=>{i.extend(t)}),this.$refs.mapRef.$mapPromise.then(t=>{t.setCenter(i.getCenter()),t.fitBounds(i),t.setZoom(t.getZoom()-1),t.getZoom()>15&&t.setZoom(15)})}this.$data.map_marker_resturant=void 0;let s=o.find(this.restaurant_list,t=>+this.$data.select_time_sheet.restaurant_id==+t.id);s&&s.map_latitude&&s.map_longitude&&(this.$data.map_marker_resturant=this.google&&new this.google.maps.LatLng(s.map_latitude,s.map_longitude)),this.is_mobile_version||this.$nextTick(()=>{this.$data.tool_bar_timesheet_form_height=this.$refs.toolBarTimesheetForm.$el.clientHeight})},zoomOnRestaurants(){var t=[];if(o.each(this.restaurant_list,e=>{if(e&&e.map_latitude&&e.map_longitude){let i=this.google&&new this.google.maps.LatLng(e.map_latitude,e.map_longitude);i&&t.push(i)}}),o.isEmpty(t)){let t=o.find(this.options,t=>"map_center_default"==t.okey),e=JSON.parse(t.ovalue);e&&(this.map_center={lat:e.lat,lng:e.lng},this.map_zoom=e.map_zoom)}else{var e=this.google&&new this.google.maps.LatLngBounds;o.each(t,t=>{e.extend(t)}),this.$refs.mapRef.$mapPromise.then(t=>{t.setCenter(e.getCenter()),t.fitBounds(e),t.setZoom(t.getZoom()-1),t.getZoom()>15&&t.setZoom(15)})}},onImportScheduledDetails:function(){this.$data.compatable_shift&&(this.$data.restaurant_id=+this.$data.compatable_shift.restaurant_id,this.$data.period_date=a()(this.$data.compatable_shift.period_date,"YYYY-MM-DD").format("DD/MM/YYYY"),this.$data.start_time=a()(this.$data.compatable_shift.start_time,"HH:mm").format("HH:mm"),this.$data.finish_time=a()(this.$data.compatable_shift.finish_time,"HH:mm").format("HH:mm"),this.$data.cost_bonus=this.$data.compatable_shift.cost_bonus,this.$data.const_fuel_bonus=this.$data.compatable_shift.const_fuel_bonus,this.$data.cost_extra_bonus=this.$data.compatable_shift.cost_extra_bonus,this.$data.comment=this.$data.compatable_shift.comment)},onApproveSelected:function(){if(0!=+this.$data.select_time_sheet.driver_id){if(this.$v.$touch(),!this.$v.$invalid){let t={shift_id:this.$data.select_time_sheet.shift_id,restaurant_id:this.$data.restaurant_id,driver_id:this.$data.select_time_sheet.driver_id,status:c.a,status_progress:c.h,period_date:a()(this.$data.period_date,"DD/MM/YYYY").format("YYYY-MM-DD"),start_time:this.$data.start_time,finish_time:this.$data.finish_time,meal_time:0,rest_time:0,cost_per_hour:this.$data.select_time_sheet.cost_per_hour,//!? get from shift
cost_bonus:this.$data.cost_bonus,const_fuel_bonus:this.$data.const_fuel_bonus,cost_extra_bonus:this.$data.cost_extra_bonus,fuel_bonus_0:this.$data.fuel_bonus_0,fuel_bonus_3:this.$data.fuel_bonus_3,fuel_bonus_6:this.$data.fuel_bonus_6,comment:this.$data.comment,driver_comment:this.$data.driver_comment},e=this.getShiftHours(t);t.cost_total=+t.cost_per_hour*+e,t.cost_bonus&&(t.cost_total=parseFloat(t.cost_total)+ +parseFloat(t.cost_bonus)),t.const_fuel_bonus&&(t.cost_total=parseFloat(t.cost_total)+ +parseFloat(t.const_fuel_bonus)),this.$data.select_time_sheet.status_progress==c.e&&(t.status_progress=c.e),t.cost_total=t.cost_total.toFixed(2),this.$data.select_time_sheet.id>0?(t.id=this.$data.select_time_sheet.id,this.localLoading=!0,this.$store.dispatch("editTimesheet",t).then(()=>{}).finally(()=>{this.localLoading=!1})):(this.localLoading=!0,this.$store.dispatch("createNewTimesheet",t).then(t=>{let e=o.findIndex(this.timesheetListSearchedFilterDriver,e=>+e.id==+t.id);this.onSelectTimeSheet(e)}).finally(()=>{this.localLoading=!1}))}}else this.$store.dispatch("setError","Can't approve Open shift")},onUnapproveTimeSelected:function(){const t=this.copyTimeSheet(this.$data.select_time_sheet);t.status=c.c,t.status_progress==c.e?t.status_progress=c.e:t.status_progress=c.i,this.localLoading=!0,this.$store.dispatch("editTimesheet",t).then(()=>{}).finally(()=>{this.localLoading=!1})},onUnapprovePaySelected:function(){const t=this.copyTimeSheet(this.$data.select_time_sheet);t.status=c.c,t.status_progress==c.e?t.status_progress=c.e:t.status_progress=c.j,this.localLoading=!0,this.$store.dispatch("editTimesheet",t).then(()=>{}).finally(()=>{this.localLoading=!1})},onDiscardSelected:function(){if(0==+this.$data.select_time_sheet.driver_id)return void this.$store.dispatch("setError","Can't discard Open shift");const t=this.copyTimeSheet(this.$data.select_time_sheet);t.status=c.b,t.status_progress==c.e?t.status_progress=c.e:t.status_progress=c.d,this.$data.select_time_sheet.id>0?(t.id=this.$data.select_time_sheet.id,this.localLoading=!0,this.$store.dispatch("editTimesheet",t).then(()=>{}).finally(()=>{this.localLoading=!1})):(t.id=void 0,this.localLoading=!0,this.$store.dispatch("createNewTimesheet",t).then(()=>{}).finally(()=>{this.localLoading=!1}))},onRemoveSelected:function(){0!=+this.$data.select_time_sheet.driver_id?this.$data.select_time_sheet.id<=0?this.$store.dispatch("setError","Can't not remove submited Timesheet"):confirm("Remove timesheet "+a()(this.$data.select_time_sheet.period_date,"YYYY-MM-DD").format("DD/MM/YYYY")+"?")&&(this.localLoading=!0,this.$store.dispatch("removeTimesheet",this.$data.select_time_sheet).then(()=>{}).finally(()=>{this.localLoading=!1})):this.$store.dispatch("setError","Can't remove Open shift")},onStartTimeFocused:function(){this.start_time||(this.start_time=this.timeToApproximation(a()().format("HH:mm")),this.start_time_was_clean=!0)},onStartTimeChanged:function(){this.$v.start_time.$touch(),this.start_time_was_clean=!1},onStartTimeBlur:function(){this.start_time_was_clean&&(this.start_time=void 0),this.$v.start_time.$touch()},onFinishTimeFocused:function(){this.finish_time||(this.finish_time=this.timeToApproximation(a()().format("HH:mm")),this.finish_time_was_clean=!0)},onFinishTimeChanged:function(){this.$v.finish_time.$touch(),this.finish_time_was_clean=!1},onFinishTimeBlur:function(){this.finish_time_was_clean&&(this.finish_time=void 0),this.$v.finish_time.$touch()},xlsExportTimesheets:function(){this.xlsExportLoading=!0,this.$store.dispatch("requestXls",{period_date_from:this.$data.date_range_selected&&this.$data.date_range_selected[0]?this.$data.date_range_selected[0]:null,period_date_to:this.$data.date_range_selected&&this.$data.date_range_selected[1]?this.$data.date_range_selected[1]:null,restaurant_id:this.$data.location_selected&&this.$data.location_selected.type==l.c?this.$data.location_selected.id:void 0}).then(()=>{}).finally(()=>{this.xlsExportLoading=!1})},approvePeriodTimesheets:function(){let t=o.filter(this.timesheetListSearchedFilterDriver,t=>t.status_progress==c.g&&t.driver_id),e=[];if(e=t.length>0&&confirm("Also fill and approve ("+t.length+") not submited timesheets?")?o.filter(this.timesheetListSearchedFilterDriver,t=>t.status==c.c&&t.driver_id):o.filter(this.timesheetListSearchedFilterDriver,t=>t.status==c.c&&t.status_progress!=c.g&&t.driver_id),0==e.length)return;if(!confirm("Approve ("+e.length+") timesheets?"))return;this.localLoading=!0,this.approvePeriodLoading=!0;let i=[];for(let t=0;t<e.length;t++){let s=o.find(this.shift_list,i=>+i.id==e[t].shift_id),r={shift_id:e[t].shift_id,restaurant_id:e[t].restaurant_id?e[t].restaurant_id:s?s.restaurant_id:void 0,driver_id:e[t].driver_id,status:c.a,status_progress:c.h,period_date:e[t].period_date?e[t].period_date:s?s.period_date:void 0,start_time:e[t].start_time?e[t].start_time:s?a()(s.start_time,"HH:mm").format("HH:mm"):void 0,finish_time:e[t].finish_time?e[t].finish_time:s?a()(s.finish_time,"HH:mm").format("HH:mm"):void 0,cost_per_hour:e[t].cost_per_hour,//!? get from shift
cost_bonus:e[t].cost_bonus?e[t].cost_bonus:s?s.cost_bonus:0,const_fuel_bonus:e[t].const_fuel_bonus?e[t].const_fuel_bonus:s?s.const_fuel_bonus:0,cost_extra_bonus:e[t].cost_extra_bonus?e[t].cost_extra_bonus:s?s.cost_extra_bonus:0,comment:e[t].comment?e[t].comment:void 0,driver_comment:e[t].driver_comment?e[t].driver_comment:void 0},n=this.getShiftHours(r);r.cost_total=+r.cost_per_hour*+n,r.cost_bonus&&(r.cost_total=parseFloat(r.cost_total)+parseFloat(+r.cost_bonus)),r.const_fuel_bonus&&(r.cost_total=parseFloat(r.cost_total)+parseFloat(+r.const_fuel_bonus)),e[t].status_progress==c.e&&(r.status_progress=c.e),r.cost_total=r.cost_total.toFixed(2),e[t].id>0&&(r.id=e[t].id),i.push(r)}this.$store.dispatch("approveTimesheets",i).then(t=>{if(t&&t.fail&&t.fail.length>0)for(let e=0;e<t.fail.length;e++){let i="Can't approve timesheet "+a()(t.fail[e].data.period_date,"YYYY-MM-DD").format("DD/MM/YYYY"),s=o.first(o.first(o.values(t.fail[e].errors)));s&&(i+=". "+s),this.$store.dispatch("setError",i)}}).finally(()=>{this.localLoading=!1,this.approvePeriodLoading=!1})},copyTimeSheet:function(t){return{id:t.id,//!
shift_id:t.shift_id,restaurant_id:t.restaurant_id,driver_id:t.driver_id,status:t.status,status_progress:t.status_progress,period_date:t.period_date,start_time:t.start_time,finish_time:t.finish_time,meal_time:0,rest_time:0,cost_per_hour:t.cost_per_hour,cost_bonus:t.cost_bonus,const_fuel_bonus:t.const_fuel_bonus,cost_extra_bonus:t.cost_extra_bonus,cost_total:t.cost_total,comment:t.comment,driver_comment:t.driver_comment,fuel_bonus_0:t.fuel_bonus_0,fuel_bonus_3:t.fuel_bonus_3,fuel_bonus_6:t.fuel_bonus_6}},onShowDialog(t){this.showModalMobile=!0,this.$nextTick(()=>{this.onSelectTimeSheet(t)})},onCloseDialog(){this.showModalMobile=!1},dayToRange:function(t,e){return d.a.dayToRange(t,e)},dateRangeText:function(t){return d.a.dateRangeText(t)},getPeriodDateText:function(t){return a()(t,"YYYY-MM-DD").format("DD/MM/YYYY")},getShiftHours:function(t){return d.a.getShiftHours(t)},getDrvierNameById:function(t){let e=o.find(this.driver_list,e=>e.id==t);return e?e.full_name:"-"},timeToApproximation:function(t){let e=a()(t,"HH:mm:ss");if(!e.isValid())return t;let i=o.find(this.timeList,t=>(a()(t.value,"HH:mm")-e)/36e5>-.125);return i?i.value:t},getRestaurantNameByID:function(t){let e=o.find(this.restaurant_list,e=>+t==+e.id);return e?e.name:"-"},scrollToCurrentLine(){const t=this.$el.getElementsByClassName("timeSheetItem_"+this.$data.select_time_sheet_index)[0];if(!t)return;const e=t.offsetTop-30;window.scrollTo({top:e,behavior:"smooth"})},header2IsoDate:function(t){return a()(t,"DD/MM/YYYY").format("YYYY-MM-DD")},moment:a.a},filters:{formatFloat:function(t){return Number(t).toFixed(2)},formatHours:function(t){return Number(t).toFixed(2)},headerData:function(t){return a()(t,"YYYY-MM-DD").format("DD/MM/YYYY")},formatTime:function(t){return t?a()(t,"HH:mm").format("HH:mm"):"__:__"},minutesToHourFormat:function(t){return a.a.utc().startOf("day").add({minutes:t}).format("H:mm")},moment:function(t){return a()(t,"YYYY-MM-DD").format("MMM Do")}}},x=(i("252d"),i("fd10"),i("2877")),T=i("6544"),D=i.n(T),k=i("40dc"),w=i("c6a6"),C=i("8336"),y=i("b0af"),Y=i("99d9"),E=i("62ad"),R=i("2e4b"),M=i("169a"),A=i("ce7e"),L=i("4bd4"),P=i("132d"),I=i("8860"),V=i("da13"),O=i("5d23"),q=i("1baa"),F=i("34c3"),H=i("e449"),U=i("f774"),B=i("0fd9"),N=i("b974"),G=i("2fa4"),z=i("8654"),j=i("a844"),W=i("71d9"),Z=i("3a2f"),J=Object(x.a)($,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-row",[t.is_mobile_version?t._e():i("v-col",{staticClass:"pa-1"},[i("v-card",{staticStyle:{"margin-bottom":"6px"},attrs:{color:"grey lighten-4",flat:"",tile:""}},[i("v-app-bar",{staticStyle:{"margin-top":"70px"},attrs:{dense:"",fixed:"",color:"elevation-1"}},[i("v-row",{attrs:{"no-gutters":""}},[i("v-col",{staticClass:"d-flex pa-0"},[i("v-autocomplete",{staticStyle:{"max-width":"340px"},attrs:{items:t.locations_list,"item-text":"name","item-value":"_guid",label:"All locations",dense:"",solo:"",clearable:"","hide-details":""},scopedSlots:t._u([{key:"selection",fn:function(e){return[i("div",[i("div",{domProps:{innerHTML:t._s(e.item.name)}})])]}},{key:"item",fn:function(e){return[e.item._guid.type==t.TYPE_AREA?[i("div",{staticClass:"select-drop-item-group__area"},[i("div",{domProps:{innerHTML:t._s(e.item.name)}})])]:[i("div",{staticClass:"select-drop-item-sub_restaurant"},[i("div",{domProps:{innerHTML:t._s(e.item.name)}})])]]}}],null,!1,1090052647),model:{value:t.location_selected,callback:function(e){t.location_selected=e},expression:"location_selected"}}),i("div",{staticStyle:{"margin-left":"8px"}},[i("v-btn",{on:{click:t.onPreviosRange}},[i("v-icon",[t._v("mdi-menu-left")])],1),i("v-menu",{attrs:{transition:"scale-transition","close-on-content-click":!1,"nudge-width":200,"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on;return[i("v-btn",t._g({},s),[t._v("\n                      "+t._s(t.dateRangeText(t.date_range_selected))+"\n                    ")])]}}],null,!1,3017730117),model:{value:t.menu_date_picker,callback:function(e){t.menu_date_picker=e},expression:"menu_date_picker"}},[i("v-card",{attrs:{"max-width":"346px"}},[i("v-date-picker",{attrs:{scrollable:"",actions:"","full-width":"","first-day-of-week":"1",range:"","title-date-format":t.dateRangeText},on:{"click:date":t.dateRangeSelect},model:{value:t.date_range_selected,callback:function(e){t.date_range_selected=e},expression:"date_range_selected"}}),i("v-divider")],1)],1),i("v-btn",{on:{click:t.onNextRange}},[i("v-icon",[t._v("mdi-menu-right")])],1)],1),i("v-select",{staticStyle:{"max-width":"150px","margin-left":"4px"},attrs:{items:t.interval_list,"item-text":"name","item-value":"id",dense:"",solo:"","hide-details":""},on:{change:t.onSelectInterval},model:{value:t.interval_selected_id,callback:function(e){t.interval_selected_id=e},expression:"interval_selected_id"}}),i("v-select",{staticStyle:{"max-width":"150px","margin-left":"4px"},attrs:{items:t.status_list,"item-text":"name","item-value":"id","prepend-icon":"mdi-filter",dense:"",solo:"","hide-details":""},on:{change:t.onSelectInterval},model:{value:t.status_selected_id,callback:function(e){t.status_selected_id=e},expression:"status_selected_id"}})],1)],1),i("v-spacer"),i("v-row",{attrs:{"no-gutters":""}},[i("v-col",{staticClass:"d-flex justify-end pa-0"},[i("new-timesheet-restaurant-modal"),i("v-btn",{attrs:{loading:t.approvePeriodLoading},on:{click:t.approvePeriodTimesheets}},[i("v-icon",[t._v("mdi-post")]),t._v(" Approve All ["+t._s(t.unapprovedTimesheets)+"]\n              ")],1)],1)],1)],1)],1),i("div",{staticClass:"d-flex mb-auto",attrs:{flat:"",tile:""}},[i("v-navigation-drawer",{staticStyle:{"margin-top":"122px"},attrs:{permanent:"",clipped:"",left:"",fixed:"",width:"256",height:t.scroll_panel_height},scopedSlots:t._u([{key:"prepend",fn:function(){return[i("v-list",{attrs:{dense:""}},[i("v-list-item",{attrs:{link:"","two-line":""}},[i("v-list-item-content",[i("v-list-item-title",{staticClass:"title"},[i("v-text-field",{attrs:{label:"Search","hide-details":"","append-outer-icon":"mdi-magnify",dense:""},model:{value:t.search_driver,callback:function(e){t.search_driver=e},expression:"search_driver"}})],1)],1)],1)],1)]},proxy:!0}],null,!1,839438347)},[i("v-divider"),i("v-list",{staticClass:"driver-list_leftpanel",attrs:{dense:""}},[i("v-list-item-group",{attrs:{color:"primary"},model:{value:t.selected_driver_index,callback:function(e){t.selected_driver_index=e},expression:"selected_driver_index"}},t._l(t.driverListSearched,(function(e,s){return i("v-list-item",{key:s,on:{click:function(i){return t.onChangeDriver(e)}}},[i("v-list-item-icon",{staticClass:"driver-profile_icon"},[e.photo_src?i("img",{staticClass:"driver-photo_src",attrs:{src:t.appConfig.app_url+"/images/thumb/"+e.photo_src}}):t._e(),e.photo_src?t._e():i("v-icon",[t._v("mdi-account")])],1),i("v-list-item-content",[i("v-list-item-title",{domProps:{innerHTML:t._s(e.full_name)}}),-1!=e.id&&t.driver_list_calc&&t.driver_list_calc[s]?i("v-list-item-subtitle",[t._v("["+t._s(t.driver_list_calc[s].timesheets)+"] "+t._s(t._f("formatHours")(t.driver_list_calc[s].hours))+"Hrs/£"+t._s(t._f("formatFloat")(t.driver_list_calc[s].cost)))]):t._e()],1)],1)})),1)],1)],1),i("v-card",{staticClass:"right-panel-work-area",attrs:{outlined:"",tile:""}},[i("v-card",{staticClass:"time-sheet-table mb-2",style:t.fixed_panel?"padding-bottom: "+(t.tool_bar_timesheet_form_height-25)+"px;":"",attrs:{color:"elevation-1",tile:""}},[i("v-card",{staticClass:"time-sheet-table__header",staticStyle:{"margin-bottom":"2px"},attrs:{color:"elevation-1",tile:""}},[i("v-row",{attrs:{"no-gutters":""}},[i("v-col",{staticClass:"col-1 pa-1 pl-2",staticStyle:{"max-width":"98px","min-width":"98px"}},[t._v("Date")]),i("v-col",{staticClass:"pa-1 flex-grow-1 flex-shrink-0"},[t._v("Driver")]),i("v-col",{staticClass:"col-1 pa-1",staticStyle:{"max-width":"100px","min-width":"100px"}},[t._v("Status")]),i("v-col",{staticClass:"col-1 pa-1",staticStyle:{"max-width":"150px","min-width":"150px"}},[t._v("Progress")]),i("v-col",{staticClass:"pa-1 flex-grow-1 flex-shrink-0"},[t._v("Location")]),i("v-col",{staticClass:"col-2 pa-1",staticStyle:{"min-width":"104px","max-width":"104px"}},[t._v("Time")]),i("v-col",{staticClass:"col-1 pa-1",staticStyle:{"min-width":"90px","max-width":"90px"}},[t._v("Hours")]),i("v-col",{staticClass:"col-2 pa-1",staticStyle:{"min-width":"150px","max-width":"150px"}},[t._v("Earned (+£bonus)")])],1)],1),t._l(t.timesheetListSearchedFilterDriver,(function(e,s){return i("v-card",{key:e.id,staticClass:"time-sheet-table__line",class:[{"blue-grey lighten-3":t.select_time_sheet_index==s},"timeSheetItem_"+s],staticStyle:{"margin-bottom":"1px",cursor:"pointer"},attrs:{color:"elevation-1","no-gutters":"",tile:""},on:{click:function(e){return t.onSelectTimeSheet(s)}}},[i("v-row",{attrs:{align:"stretch"}},[i("v-col",{staticClass:"col-1 pa-1 pl-2",staticStyle:{"max-width":"98px","min-width":"98px"}},[t._v(t._s(t._f("headerData")(e.period_date)))]),i("v-col",{staticClass:"pa-1 flex-grow-1 flex-shrink-0"},[t._v(t._s(t.getDrvierNameById(e.driver_id)))]),i("v-col",{staticClass:"col-1 pa-1",staticStyle:{"max-width":"100px","min-width":"100px"}},[i("v-btn",{class:{orange:e.status==t.STATUS_PENDING,"red accent-4":e.status==t.STATUS_DISCARDED,green:e.status==t.STATUS_APPROVED},attrs:{outlined:"",color:"white",small:""}},[e.status==t.STATUS_PENDING?i("span",[t._v("Pending")]):t._e(),e.status==t.STATUS_DISCARDED?i("span",[t._v("Discarded")]):t._e(),e.status==t.STATUS_APPROVED?i("span",[t._v("Approved")]):t._e()])],1),i("v-col",{staticClass:"col-1 pa-1",staticStyle:{"max-width":"150px","min-width":"150px"}},[i("v-btn",{class:{blue:e.status_progress==t.STATUS_PROGRESS_IN_WORK,orange:e.status_progress==t.STATUS_PROGRESS_SUBMITED,"blue-grey lighten-4":e.status_progress==t.STATUS_PROGRESS_NOT_SUBMITED&&0==+e.driver_id,"blue-grey":e.status_progress==t.STATUS_PROGRESS_NOT_SUBMITED&&0!=+e.driver_id,green:e.status_progress==t.STATUS_PROGRESS_PAY_APPROVED,"deep-orange":e.status_progress==t.STATUS_PROGRESS_TIME_APPROVED,"red darken-4":e.status_progress==t.STATUS_PROGRESS_DISCARDED,"pink darken-4":e.status_progress==t.STATUS_PROGRESS_DISCARDED_BY_DRIVER},attrs:{outlined:"",color:"white",small:""}},[e.status_progress==t.STATUS_PROGRESS_IN_WORK?i("span",[t._v("In work")]):t._e(),e.status_progress==t.STATUS_PROGRESS_SUBMITED?i("span",[t._v("Submited")]):t._e(),e.status_progress==t.STATUS_PROGRESS_NOT_SUBMITED&&0==+e.driver_id?i("span",[t._v("Open shift")]):t._e(),e.status_progress==t.STATUS_PROGRESS_NOT_SUBMITED&&0!=+e.driver_id?i("span",[t._v("Not submited")]):t._e(),e.status_progress==t.STATUS_PROGRESS_PAY_APPROVED?i("span",[t._v("Pay approved")]):t._e(),e.status_progress==t.STATUS_PROGRESS_TIME_APPROVED?i("span",[t._v("Time approved")]):t._e(),e.status_progress==t.STATUS_PROGRESS_DISCARDED?i("span",[t._v("Discarded")]):t._e(),e.status_progress==t.STATUS_PROGRESS_DISCARDED_BY_DRIVER?i("span",[t._v("Discarded by driver")]):t._e()])],1),i("v-col",{staticClass:"pa-1 flex-grow-1 flex-shrink-0"},[t._v(t._s(t.getRestaurantNameByID(e.restaurant_id))+"\n                  ")]),i("v-col",{staticClass:"col-2 pa-1",staticStyle:{"min-width":"104px","max-width":"104px"}},[i("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(s){var a=s.on;return[i("span",t._g({},a),[t._v("\n                        "+t._s(t._f("formatTime")(e.start_time))+" - "+t._s(t._f("formatTime")(e.finish_time))+"\n                      ")])]}}],null,!0)},[i("span",[t._v(t._s(t._f("formatTime")(e.driver_start_time))+" - "+t._s(t._f("formatTime")(e.driver_finish_time)))])])],1),i("v-col",{staticClass:"col-1 pa-1",staticStyle:{"min-width":"90px","max-width":"90px"}},[t._v(t._s(t._f("formatHours")(t.getShiftHours(e)))+" Hrs")]),i("v-col",{staticClass:"col-2 pa-1",staticStyle:{"min-width":"150px","max-width":"150px"}},[i("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(s){var a=s.on;return[i("span",t._g({},a),[+e.cost_total<0?i("span",[t._v("-£"+t._s(Math.abs(e.cost_total)))]):i("span",[t._v("£"+t._s(t._f("formatFloat")(e.cost_total)))])])]}}],null,!0)},[i("span",[t._v(t._s(e.cost_per_hour)+"£ / Hr")])]),t._v("\n\n                   \n                  "),+e.cost_bonus>0?i("span",{staticClass:"bonus-plus"},[t._v(" +£"+t._s(e.cost_bonus)+" ")]):t._e(),+e.cost_bonus<0?i("span",{staticClass:"bonus-minus"},[t._v(" -£"+t._s(Math.abs(e.cost_bonus.toFixed(0))))]):t._e(),t._v("\n                   \n                  "),+e.const_fuel_bonus>0?i("span",{staticClass:"bonus-plus"},[t._v(" +£"+t._s(e.const_fuel_bonus)+" ")]):t._e(),+e.const_fuel_bonus<0?i("span",{staticClass:"bonus-minus"},[t._v(" -£"+t._s(Math.abs(e.const_fuel_bonus.toFixed(0))))]):t._e()],1)],1)],1)}))],2),i("v-app-bar",{ref:"toolBarTimesheetForm",staticClass:"d-flex tool-bar__timesheet-form",class:{"tool-bar__timesheet-form-fixed":t.fixed_panel},style:t.fixed_panel?"margin-bottom: 25px;":"",attrs:{color:"white elevation-0",bottom:t.fixed_panel,fixed:t.fixed_panel,height:"auto"}},[i("v-card",{staticClass:"ml-1 mr-1 mt-0",staticStyle:{width:"70%"},attrs:{color:"grey lighten-4"}},[i("v-card-title",{staticClass:"pt-1 pb-1"},[i("span",{staticClass:"summary_headline"},[t._v("Timesheet summary")]),i("v-spacer"),i("v-btn",{attrs:{small:""},on:{click:function(e){return t.scrollToCurrentLine()}}},[i("span",[i("v-icon",{attrs:{color:"indigo accent-3",left:""}},[t._v("mdi-arrow-collapse-up")]),t._v("Scroll To")],1)]),i("v-btn",{staticClass:"ml-1",attrs:{small:""},on:{click:function(e){t.fixed_panel=!t.fixed_panel}}},[t.fixed_panel?i("span",[i("v-icon",{attrs:{color:"deep-orange darken-2",left:""}},[t._v("mdi-lock-outline")]),t._v("Pinned")],1):t._e(),t.fixed_panel?t._e():i("span",[i("v-icon",{attrs:{left:""}},[t._v("mdi-lock-open-variant-outline")]),t._v("Pinned")],1)])],1),i("v-card-text",[t.compatable_shift?i("v-card",{staticClass:"yellow lighten-4 mb-3",attrs:{color:"elevation-1"}},[i("v-row",{attrs:{dense:""}},[i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[t._v("\n                          Scheduled Details:\n                            "),i("span",{class:{"orange accent-4":t.compatable_shift.period_date!=t.header2IsoDate(t.period_date)}},[t._v(t._s(t._f("headerData")(t.compatable_shift.period_date)))]),t._v("\n                             \n                            "),i("span",{class:{"orange accent-4":t.compatable_shift.restaurant_id!=t.restaurant_id}},[t._v("\n                              -\n                            ")]),t._v("\n                             \n                            "),i("span",{class:{"orange accent-4":t.compatable_shift.start_time!=t.start_time+":00"}},[t._v(t._s(t._f("formatTime")(t.compatable_shift.start_time)))]),t._v("\n                             - \n                            "),i("span",{class:{"orange accent-4":t.compatable_shift.finish_time!=t.finish_time+":00"}},[t._v(t._s(t._f("formatTime")(t.compatable_shift.finish_time)))]),t._v("\n                             , bonus: \n                            "),i("span",{class:{"orange accent-4":t.compatable_shift.cost_bonus!=t.cost_bonus}},[t._v("+£"+t._s(t.compatable_shift.cost_bonus))]),t._v("\n                             , Fuel bonus: \n                            "),i("span",{class:{"orange accent-4":t.compatable_shift.const_fuel_bonus!=t.const_fuel_bonus}},[t._v("+£"+t._s(t.compatable_shift.const_fuel_bonus))])]),i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("v-btn",{on:{click:t.onImportScheduledDetails}},[i("v-icon",[t._v("mdi-calendar-import")]),t._v(" Import Scheduled Details\n                          ")],1)],1)],1)],1):t._e(),i("v-form",{ref:"form"},[i("v-row",{attrs:{dense:""}},[i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("v-autocomplete",{attrs:{"prepend-icon":"mdi-map-marker",label:"Restaurant","item-text":"name","item-value":"id",disabled:t.timeSheetEditDisabled,items:t.restaurant_list,"error-messages":t.selectAreaErrors,required:"",dense:"","hide-details":""},on:{blur:function(e){return t.$v.restaurant_id.$touch()}},model:{value:t.restaurant_id,callback:function(e){t.restaurant_id=e},expression:"restaurant_id"}})],1)],1),i("v-row",[i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-menu",{attrs:{transition:"scale-transition","close-on-content-click":!1,"nudge-width":200,"max-width":"346px","offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on;return[i("v-text-field",t._g({attrs:{"clear-icon":"mdi-close","prepend-icon":"mdi-calendar",clearable:"",outlined:"",label:"Date*",hint:"22/11/2019",required:"",disabled:t.timeSheetEditDisabled,"error-messages":t.periodDateErrors,autocomplete:"off",dense:""},on:{input:function(e){return t.$v.period_date.$touch()},blur:function(e){return t.$v.period_date.$touch()}},model:{value:t.period_date,callback:function(e){t.period_date=e},expression:"period_date"}},s))]}}],null,!1,1221811328),model:{value:t.timesheet_date_picker,callback:function(e){t.timesheet_date_picker=e},expression:"timesheet_date_picker"}},[i("v-card",{attrs:{"max-width":"346px"}},[i("v-date-picker",{attrs:{scrollable:"",actions:"","full-width":"","first-day-of-week":"1","title-date-format":t.getPeriodDateText,max:t.period_date_max},on:{"click:date":t.periodDateSelect},model:{value:t.period_date_selected,callback:function(e){t.period_date_selected=e},expression:"period_date_selected"}})],1)],1)],1),i("v-col",{attrs:{cols:"12",sm:"3",md:"3"}},[i("v-autocomplete",{staticClass:"hide-time-picker-indicator",attrs:{type:"time","menu-props":"auto, overflowY","clear-icon":"mdi-close","prepend-icon":"mdi-clock-outline",clearable:"",outlined:"",label:"Start Time*",hint:"Example: 08:00",required:"",disabled:t.timeSheetEditDisabled,items:t.timeList,"item-text":"name","item-value":"value","error-messages":t.startTimeErrors,"open-on-clear":"",dense:""},on:{input:[function(e){return t.$v.start_time.$touch()},t.onStartTimeChanged],focus:t.onStartTimeFocused,blur:t.onStartTimeBlur},model:{value:t.start_time,callback:function(e){t.start_time=e},expression:"start_time"}})],1),i("v-col",{attrs:{cols:"12",sm:"3",md:"3"}},[i("v-autocomplete",{staticClass:"hide-time-picker-indicator",attrs:{type:"time","menu-props":"auto, overflowY","clear-icon":"mdi-close","prepend-icon":"mdi-clock-outline",clearable:"",outlined:"",label:"Finish Time*",hint:"Example: 18:30",required:"",disabled:t.timeSheetEditDisabled,items:t.timeList,"item-text":"name","item-value":"value","error-messages":t.finishTimeErrors,"open-on-clear":"",dense:""},on:{focus:t.onFinishTimeFocused,input:t.onFinishTimeChanged,blur:t.onFinishTimeBlur},model:{value:t.finish_time,callback:function(e){t.finish_time=e},expression:"finish_time"}})],1)],1),i("v-row",[i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-autocomplete",{attrs:{"prepend-icon":"mdi-wallet-giftcard",label:"Add Driver Bonus","item-text":"name","item-value":"id",disabled:t.timeSheetEditDisabled,items:t.bonus_list,required:"",outlined:"",dense:""},model:{value:t.cost_bonus,callback:function(e){t.cost_bonus=e},expression:"cost_bonus"}})],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-row",[i("v-col",{attrs:{cols:"xl-2"}},[i("v-text-field",{attrs:{type:"number",label:"0-3",disabled:t.timeSheetEditDisabled,min:"0",required:"",outlined:"",dense:"","persistent-hint":""},on:{input:t.calculateBonus},model:{value:t.fuel_bonus_0,callback:function(e){t.fuel_bonus_0=e},expression:"fuel_bonus_0"}})],1),i("v-col",{attrs:{cols:"xl-2"}},[i("v-text-field",{attrs:{type:"number",label:"3-6",disabled:t.timeSheetEditDisabled,min:"0",required:"",outlined:"",dense:"","persistent-hint":""},on:{input:t.calculateBonus},model:{value:t.fuel_bonus_3,callback:function(e){t.fuel_bonus_3=e},expression:"fuel_bonus_3"}})],1),i("v-col",{attrs:{cols:"xl-2"}},[i("v-text-field",{attrs:{type:"number",label:"6+",disabled:t.timeSheetEditDisabled,min:"0",required:"",outlined:"",dense:"","persistent-hint":""},on:{input:t.calculateBonus},model:{value:t.fuel_bonus_6,callback:function(e){t.fuel_bonus_6=e},expression:"fuel_bonus_6"}})],1),i("v-col",{attrs:{cols:"1.5"}},[i("v-text-field",{attrs:{type:"number","prepend-icon":"mdi-gas-station",label:"Fuel Bonus",disabled:t.timeSheetEditDisabled,outlined:"",dense:""},model:{value:t.const_fuel_bonus,callback:function(e){t.const_fuel_bonus=e},expression:"const_fuel_bonus"}})],1)],1)],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-textarea",{attrs:{outlined:"",label:"Shift comment",disabled:t.timeSheetEditDisabled,"hide-details":"",rows:"2",dense:""},model:{value:t.comment,callback:function(e){t.comment=e},expression:"comment"}})],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-textarea",{attrs:{outlined:"",label:"Driver's comment",disabled:t.timeSheetEditDisabled,"hide-details":"",rows:"2",dense:""},model:{value:t.driver_comment,callback:function(e){t.driver_comment=e},expression:"driver_comment"}})],1)],1)],1)],1)],1),i("div",{staticClass:"d-flex flex-column",staticStyle:{width:"30%"}},[i("v-card",{staticClass:"mt-0 ml-0 mb-0 mr-0",attrs:{color:"grey lighten-4",tile:""}},[i("v-col",[i("v-row",[i("v-col",{staticClass:"pa-1",attrs:{cols:"12",sm:"12",md:"6",lg:"4"}},[i("v-btn",{staticClass:"mr-4 green",attrs:{depressed:"",disabled:this.$v.$invalid||t.localLoading||t.select_time_sheet&&t.select_time_sheet.status==t.STATUS_APPROVED,loading:t.localLoading,width:"100%"},on:{click:t.onApproveSelected}},[i("v-icon",[t._v("mdi-check-outline")]),t._v(" Approve\n                      ")],1)],1),i("v-col",{staticClass:"pa-1",attrs:{cols:"12",sm:"12",md:"6",lg:"4"}},[i("v-btn",{staticClass:"mr-4 red darken-4",attrs:{depressed:"",disabled:this.$v.$invalid||t.localLoading||t.select_time_sheet&&t.select_time_sheet.status==t.STATUS_DISCARDED,loading:t.localLoading,width:"100%"},on:{click:t.onDiscardSelected}},[i("v-icon",[t._v("mdi-delete-outline")]),t._v(" Discard\n                      ")],1)],1),i("v-col",{staticClass:"pa-1",attrs:{cols:"12",sm:"12",md:"6",lg:"4"}},[i("v-btn",{staticClass:"mr-4 red darken-4",attrs:{depressed:"",disabled:t.localLoading||!t.select_time_sheet||t.select_time_sheet.id<=0,loading:t.localLoading,width:"100%"},on:{click:t.onRemoveSelected}},[i("v-icon",[t._v("mdi-close-circle")]),t._v(" Remove\n                      ")],1)],1)],1),!t.select_time_sheet||t.select_time_sheet.status!=t.STATUS_APPROVED&&t.select_time_sheet.status_progress!=t.STATUS_PROGRESS_TIME_APPROVED?t._e():i("v-row",[i("v-col",{staticClass:"pa-1",attrs:{cols:"12",sm:"12",md:"12",lg:"6"}},[i("v-btn",{staticClass:"mr-4 deep-orange",attrs:{depressed:"",disabled:this.$v.$invalid||t.localLoading,loading:t.localLoading,width:"100%"},on:{click:t.onUnapproveTimeSelected}},[i("v-icon",[t._v("mdi-timer-off")]),t._v(" Unapprove Time\n                      ")],1)],1),i("v-col",{staticClass:"pa-1",attrs:{cols:"12",sm:"12",md:"12",lg:"6"}},[i("v-btn",{staticClass:"mr-4 orange",attrs:{depressed:"",disabled:this.$v.$invalid||t.localLoading||t.select_time_sheet.status_progress==t.STATUS_PROGRESS_TIME_APPROVED,loading:t.localLoading,width:"100%"},on:{click:t.onUnapprovePaySelected}},[i("v-icon",[t._v("mdi-steering-off")]),t._v(" Unapprove Pay\n                      ")],1)],1)],1)],1)],1),i("v-card",{staticStyle:{margin:"7px 0px 0px 0px"},attrs:{color:"grey lighten-4",tile:""}},[i("v-col",[i("GmapMap",{ref:"mapRef",staticStyle:{width:"100%",height:"320px"},attrs:{options:{zoomControl:!0,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,rotateControl:!1,fullscreenControl:!0,disableDefaultUi:!1},center:t.map_center,zoom:t.map_zoom,"map-type-id":"terrain"}},[t.map_marker_start?i("GmapMarker",{attrs:{position:t.map_marker_start,title:"Started at: "+t.moment(t.select_time_sheet.driver_start_time?t.select_time_sheet.driver_start_time:t.select_time_sheet.start_time,"HH:mm").format("HH:mm"),icon:{url:t.ICON_FINISH,size:{width:45,height:45,f:"px",b:"px"},scaledSize:{width:45,height:45,f:"px",b:"px"}}}}):t._e(),t.map_marker_finish?i("GmapMarker",{attrs:{position:t.map_marker_finish,title:"Finished at: "+t.moment(t.select_time_sheet.driver_finish_time?t.select_time_sheet.driver_finish_time:t.select_time_sheet.finish_time,"HH:mm").format("HH:mm"),icon:{url:t.ICON_START,size:{width:45,height:45,f:"px",b:"px"},scaledSize:{width:45,height:45,f:"px",b:"px"}}}}):t._e(),t.map_marker_resturant?i("GmapMarker",{attrs:{position:t.map_marker_resturant,title:""+t.getRestaurantNameByID(t.select_time_sheet.restaurant_id)}}):t._e()],1)],1)],1)],1)],1)],1)],1),i("v-card",{staticStyle:{"margin-bottom":"-5px"},attrs:{color:"grey lighten-4",flat:"",tile:""}},[i("v-app-bar",{attrs:{fixed:"",bottom:"",height:"36px",color:"elevation-1 tool-bar__totals-panel"}},[i("v-spacer"),i("div",[i("v-btn",{staticClass:"shift-button_item",attrs:{tile:"",small:""}},[i("div",{staticClass:"shift-total_value"},[t._v(t._s(t.totals.approved))]),i("div",{staticClass:"shift-total_label"},[t._v("Approved Timesheets")])]),i("v-btn",{staticClass:"shift-button_item",attrs:{tile:"",small:""}},[i("div",{staticClass:"shift-total_value"},[t._v(t._s(t.totals.unapproved))]),i("div",{staticClass:"shift-total_label"},[t._v("Unapproved Timesheets")])]),i("v-btn",{staticClass:"shift-button_item",attrs:{tile:"",small:""}},[i("div",{staticClass:"shift-total_value"},[t._v(t._s(t.totals.free))]),i("div",{staticClass:"shift-total_label"},[t._v("Free Timesheets")])])],1),i("v-spacer"),i("div",[i("v-btn",{staticClass:"shift-button_item",attrs:{tile:"",small:""}},[i("div",{staticClass:"shift-total_value"},[t._v(t._s(t.totals.total_timesheets))]),i("div",{staticClass:"shift-total_label"},[t._v("Total Timesheets")])]),i("v-btn",{staticClass:"shift-button_item",attrs:{tile:"",small:""}},[i("div",{staticClass:"shift-total_value"},[t._v(t._s(t._f("formatHours")(t.totals.filled_hours)))]),i("div",{staticClass:"shift-total_label"},[t._v("Filled Hours")])]),i("v-btn",{staticClass:"shift-button_item",attrs:{tile:"",small:""}},[i("div",{staticClass:"shift-total_value"},[t._v("£"+t._s(t._f("formatFloat")(t.totals.estimated_cost)))]),i("div",{staticClass:"shift-total_label"},[t._v("Est. Cost")])]),i("v-btn",{staticClass:"shift-button_item",attrs:{tile:"",small:""}},[i("div",{staticClass:"shift-total_value"},[t._v("£"+t._s(t._f("formatFloat")(t.totals.expected_sales)))]),i("div",{staticClass:"shift-total_label"},[t._v("Expected Sales")])])],1)],1)],1)],1),t.is_mobile_version?i("v-col",[i("v-card",{staticStyle:{"margin-bottom":"6px"},attrs:{color:"grey lighten-4",flat:"",tile:""}},[i("v-toolbar",{attrs:{dense:"",color:"elevation-1 tool-bar__actions-panel header-btn-panel header-btn-panel-mobile"}},[i("v-row",{staticClass:"d-flex mb-auto"},[i("div",{staticClass:"menu-date__picker-mobile"},[i("v-btn",{on:{click:t.onPreviosRange}},[i("v-icon",[t._v("mdi-menu-left")])],1),i("v-menu",{attrs:{transition:"scale-transition","close-on-content-click":!1,"nudge-width":200,"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on;return[i("v-btn",t._g({},s),[t._v("\n                    "+t._s(t.dateRangeText(t.date_range_selected))+"\n                  ")])]}}],null,!1,1263868741),model:{value:t.menu_date_picker,callback:function(e){t.menu_date_picker=e},expression:"menu_date_picker"}},[i("v-card",{attrs:{"max-width":"346px"}},[i("v-date-picker",{attrs:{scrollable:"",actions:"","full-width":"","first-day-of-week":"1",range:"","title-date-format":t.dateRangeText},on:{"click:date":t.dateRangeSelect},model:{value:t.date_range_selected,callback:function(e){t.date_range_selected=e},expression:"date_range_selected"}}),i("v-divider")],1)],1),i("v-btn",{on:{click:t.onNextRange}},[i("v-icon",[t._v("mdi-menu-right")])],1)],1),i("div",{staticClass:"menu-interval-changer-mobile"},[i("v-select",{attrs:{items:t.interval_list,"item-text":"name","item-value":"id",dense:"",solo:"","hide-details":""},on:{change:t.onSelectInterval},model:{value:t.interval_selected_id,callback:function(e){t.interval_selected_id=e},expression:"interval_selected_id"}})],1),i("div",{staticClass:"menu-restaurant-changer-mobile"},[i("v-select",{attrs:{items:t.restaurantListSearched,"item-text":"name","item-value":"id",dense:"",solo:"","hide-details":""},on:{change:t.onSelectRestaurantMobile},model:{value:t.restaurant_id_mobile_selected,callback:function(e){t.restaurant_id_mobile_selected=e},expression:"restaurant_id_mobile_selected"}})],1),i("div",{staticClass:"menu-driver-changer-mobile"},[i("v-select",{attrs:{items:t.driverListSearched,"item-text":"full_name","item-value":"id",dense:"",solo:"",clearable:"","hide-details":""},on:{change:t.onSelectDriverMobile},model:{value:t.driver_id_mobile_selected,callback:function(e){t.driver_id_mobile_selected=e},expression:"driver_id_mobile_selected"}})],1)]),i("v-spacer"),i("v-row",{staticClass:"d-flex mb-auto"},[i("v-col",{attrs:{cols:"12",sm:"6",md:"6",xs:"6"}},[i("new-timesheet-restaurant-modal")],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6",xs:"6"}},[i("v-btn",{attrs:{loading:t.approvePeriodLoading},on:{click:t.approvePeriodTimesheets}},[i("v-icon",[t._v("mdi-post")]),t._v(" Approve All ["+t._s(t.unapprovedTimesheets)+"]\n              ")],1)],1)],1)],1)],1),i("div",{staticClass:"d-flex mb-auto",attrs:{flat:"",tile:""}},[i("v-card",{staticClass:"right-panel-calendar-mobile",attrs:{color:"elevation-0"}},[i("v-card",{staticClass:"calendar-v-card-header",attrs:{color:"elevation-1"}},t._l(t.timesheetListSearchedFilterDriver,(function(e,s){return i("v-row",{key:e.id},[i("v-col",{staticClass:"text-center"},[i("v-card",{staticClass:"calendar-v-card-body",attrs:{color:"elevation-0"}},[t.restaurant_item_mobile_selected?i("v-card",{attrs:{color:"grey lighten-2"}},[i("v-col",[t._v(t._s(t._f("moment")(e.period_date))+", "+t._s(t.getDrvierNameById(e.driver_id)))])],1):t._e(),i("v-row",{attrs:{align:"stretch"}},[i("v-col",{staticClass:"text-center"},[i("v-row",[i("v-col",[i("v-btn",{class:{orange:e.status==t.STATUS_PENDING,"red accent-4":e.status==t.STATUS_DISCARDED,green:e.status==t.STATUS_APPROVED},attrs:{outlined:"",color:"white",small:""}},[e.status==t.STATUS_PENDING?i("span",[t._v("Pending")]):t._e(),e.status==t.STATUS_DISCARDED?i("span",[t._v("Discarded")]):t._e(),e.status==t.STATUS_APPROVED?i("span",[t._v("Approved")]):t._e()])],1)],1),i("v-row",[i("v-col",[i("v-btn",{class:{blue:e.status_progress==t.STATUS_PROGRESS_IN_WORK,orange:e.status_progress==t.STATUS_PROGRESS_SUBMITED,"blue-grey lighten-4":e.status_progress==t.STATUS_PROGRESS_NOT_SUBMITED&&0==+e.driver_id,"blue-grey":e.status_progress==t.STATUS_PROGRESS_NOT_SUBMITED&&0!=+e.driver_id,green:e.status_progress==t.STATUS_PROGRESS_PAY_APPROVED,"deep-orange":e.status_progress==t.STATUS_PROGRESS_TIME_APPROVED,"red darken-4":e.status_progress==t.STATUS_PROGRESS_DISCARDED,"pink darken-4":e.status_progress==t.STATUS_PROGRESS_DISCARDED_BY_DRIVER},attrs:{outlined:"",color:"white",small:""}},[e.status_progress==t.STATUS_PROGRESS_IN_WORK?i("span",[t._v("In work")]):t._e(),e.status_progress==t.STATUS_PROGRESS_SUBMITED?i("span",[t._v("Submited")]):t._e(),e.status_progress==t.STATUS_PROGRESS_NOT_SUBMITED&&0==+e.driver_id?i("span",[t._v("Open shift")]):t._e(),e.status_progress==t.STATUS_PROGRESS_NOT_SUBMITED&&0!=+e.driver_id?i("span",[t._v("Not submited")]):t._e(),e.status_progress==t.STATUS_PROGRESS_PAY_APPROVED?i("span",[t._v("Pay approved")]):t._e(),e.status_progress==t.STATUS_PROGRESS_TIME_APPROVED?i("span",[t._v("Time approved")]):t._e(),e.status_progress==t.STATUS_PROGRESS_DISCARDED?i("span",[t._v("Discarded")]):t._e(),e.status_progress==t.STATUS_PROGRESS_DISCARDED_BY_DRIVER?i("span",[t._v("Discarded by driver")]):t._e()])],1)],1),i("v-row",[i("v-col",[t._v("\n                          "+t._s(t.getRestaurantNameByID(e.restaurant_id))+"\n                        ")])],1),i("v-row",[i("v-col",[i("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(s){var a=s.on;return[i("span",t._g({},a),[t._v("\n                                "+t._s(t._f("formatTime")(e.start_time))+" - "+t._s(t._f("formatTime")(e.finish_time))+"\n                              ")])]}}],null,!0)},[i("span",[t._v(t._s(t._f("formatTime")(e.driver_start_time))+" - "+t._s(t._f("formatTime")(e.driver_finish_time)))])]),t._v("\n\n                          "+t._s(t._f("formatHours")(t.getShiftHours(e)))+" Hrs\n                        ")],1)],1),i("v-row",[i("v-col",[i("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(s){var a=s.on;return[i("span",t._g({},a),[+e.cost_total<0?i("span",[t._v("-£"+t._s(Math.abs(e.cost_total)))]):i("span",[t._v("£"+t._s(t._f("formatFloat")(e.cost_total)))])])]}}],null,!0)},[i("span",[t._v(t._s(e.cost_per_hour)+"£ / Hr")])]),t._v("\n\n                           \n                          "),+e.cost_bonus>0?i("span",{staticClass:"bonus-plus"},[t._v(" +£"+t._s(e.cost_bonus)+" ")]):t._e(),+e.cost_bonus<0?i("span",{staticClass:"bonus-minus"},[t._v(" -£"+t._s(Math.abs(e.cost_bonus.toFixed(0))))]):t._e(),t._v("\n                           \n                          "),+e.const_fuel_bonus>0?i("span",{staticClass:"bonus-plus"},[t._v(" +£"+t._s(e.const_fuel_bonus)+" ")]):t._e(),+e.const_fuel_bonus<0?i("span",{staticClass:"bonus-minus"},[t._v(" -£"+t._s(Math.abs(e.const_fuel_bonus.toFixed(0))))]):t._e()],1)],1),i("v-row",{attrs:{align:"stretch"}},[i("v-col",{staticClass:"text-center"},[i("v-btn",{staticClass:"shift-button_item",attrs:{tile:"",small:"",block:"",loading:t.approvePeriodLoading},on:{click:function(e){return t.onShowDialog(s)}}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-post")]),t._v("Process\n                          ")],1)],1)],1)],1)],1)],1)],1)],1)})),1)],1)],1),i("v-dialog",{attrs:{width:"100%"},on:{"click:outside":t.onCloseDialog},model:{value:t.showModalMobile,callback:function(e){t.showModalMobile=e},expression:"showModalMobile"}},[i("v-card",[i("v-card-title",[i("span",{staticClass:"headline"},[t._v("Process timesheet")]),i("div",{staticClass:"dialog-closeBtn",on:{click:t.onCloseDialog}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-close")])],1)]),i("v-card-text",{staticClass:"dialog-card_body"},[i("v-row",{attrs:{align:"stretch"}},[i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("v-card",{staticClass:"ml-1 mr-1 mt-0",attrs:{color:"grey lighten-4"}},[i("v-card-title",{staticClass:"pt-1 pb-1"},[i("span",{staticClass:"summary_headline"},[t._v("Timesheet summary")])]),i("v-card-text",[t.compatable_shift?i("v-card",{staticClass:"yellow lighten-4 mb-3",attrs:{color:"elevation-1"}},[i("v-row",{attrs:{dense:""}},[i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[t._v("\n                                    Scheduled Details:\n                                      "),i("span",{class:{"orange accent-4":t.compatable_shift.period_date!=t.header2IsoDate(t.period_date)}},[t._v(t._s(t._f("headerData")(t.compatable_shift.period_date)))]),t._v("\n                                       \n                                      "),i("span",{class:{"orange accent-4":t.compatable_shift.restaurant_id!=t.restaurant_id}},[t._v("\n                                        -\n                                      ")]),t._v("\n                                       \n                                      "),i("span",{class:{"orange accent-4":t.compatable_shift.start_time!=t.start_time+":00"}},[t._v(t._s(t._f("formatTime")(t.compatable_shift.start_time)))]),t._v("\n                                       - \n                                      "),i("span",{class:{"orange accent-4":t.compatable_shift.finish_time!=t.finish_time+":00"}},[t._v(t._s(t._f("formatTime")(t.compatable_shift.finish_time)))]),t._v("\n                                       , bonus: \n                                      "),i("span",{class:{"orange accent-4":t.compatable_shift.cost_bonus!=t.cost_bonus}},[t._v("+£"+t._s(t.compatable_shift.cost_bonus))]),t._v("\n                                       , Fuel bonus: \n                                      "),i("span",{class:{"orange accent-4":t.compatable_shift.const_fuel_bonus!=t.const_fuel_bonus}},[t._v("+£"+t._s(t.compatable_shift.const_fuel_bonus))])]),i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("v-btn",{on:{click:t.onImportScheduledDetails}},[i("v-icon",[t._v("mdi-calendar-import")]),t._v(" Import Scheduled Details\n                                    ")],1)],1)],1)],1):t._e(),i("v-form",{ref:"form"},[i("v-row",{attrs:{dense:""}},[i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("v-autocomplete",{attrs:{"prepend-icon":"mdi-map-marker",label:"Restaurant","item-text":"name","item-value":"id",disabled:t.timeSheetEditDisabled,items:t.restaurant_list,"error-messages":t.selectAreaErrors,required:"",dense:"","hide-details":""},on:{blur:function(e){return t.$v.restaurant_id.$touch()}},model:{value:t.restaurant_id,callback:function(e){t.restaurant_id=e},expression:"restaurant_id"}})],1)],1),i("v-row",[i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-menu",{attrs:{transition:"scale-transition","close-on-content-click":!1,"nudge-width":200,"max-width":"346px","offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on;return[i("v-text-field",t._g({attrs:{"clear-icon":"mdi-close","prepend-icon":"mdi-calendar",clearable:"",outlined:"",label:"Date*",hint:"22/11/2019",required:"",disabled:t.timeSheetEditDisabled,"error-messages":t.periodDateErrors,autocomplete:"off",dense:""},on:{input:function(e){return t.$v.period_date.$touch()},blur:function(e){return t.$v.period_date.$touch()}},model:{value:t.period_date,callback:function(e){t.period_date=e},expression:"period_date"}},s))]}}],null,!1,1221811328),model:{value:t.timesheet_date_picker,callback:function(e){t.timesheet_date_picker=e},expression:"timesheet_date_picker"}},[i("v-card",{attrs:{"max-width":"346px"}},[i("v-date-picker",{attrs:{scrollable:"",actions:"","full-width":"","first-day-of-week":"1","title-date-format":t.getPeriodDateText,max:t.period_date_max},on:{"click:date":t.periodDateSelect},model:{value:t.period_date_selected,callback:function(e){t.period_date_selected=e},expression:"period_date_selected"}})],1)],1)],1),i("v-col",{attrs:{cols:"12",sm:"3",md:"3"}},[i("v-autocomplete",{staticClass:"hide-time-picker-indicator",attrs:{type:"time","menu-props":"auto, overflowY","clear-icon":"mdi-close","prepend-icon":"mdi-clock-outline",clearable:"",outlined:"",label:"Start Time*",hint:"Example: 08:00",required:"",disabled:t.timeSheetEditDisabled,items:t.timeList,"item-text":"name","item-value":"value","error-messages":t.startTimeErrors,"open-on-clear":"",dense:""},on:{input:[function(e){return t.$v.start_time.$touch()},t.onStartTimeChanged],focus:t.onStartTimeFocused,blur:t.onStartTimeBlur},model:{value:t.start_time,callback:function(e){t.start_time=e},expression:"start_time"}})],1),i("v-col",{attrs:{cols:"12",sm:"3",md:"3"}},[i("v-autocomplete",{staticClass:"hide-time-picker-indicator",attrs:{type:"time","menu-props":"auto, overflowY","clear-icon":"mdi-close","prepend-icon":"mdi-clock-outline",clearable:"",outlined:"",label:"Finish Time*",hint:"Example: 18:30",required:"",disabled:t.timeSheetEditDisabled,items:t.timeList,"item-text":"name","item-value":"value","error-messages":t.finishTimeErrors,"open-on-clear":"",dense:""},on:{focus:t.onFinishTimeFocused,input:t.onFinishTimeChanged,blur:t.onFinishTimeBlur},model:{value:t.finish_time,callback:function(e){t.finish_time=e},expression:"finish_time"}})],1)],1),i("v-row",[i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-autocomplete",{attrs:{"prepend-icon":"mdi-wallet-giftcard",label:"Add Driver Bonus","item-text":"name","item-value":"id",disabled:t.timeSheetEditDisabled,items:t.bonus_list,required:"",outlined:"",dense:""},model:{value:t.cost_bonus,callback:function(e){t.cost_bonus=e},expression:"cost_bonus"}})],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-row",[i("v-col",{attrs:{cols:"xl-3"}},[i("v-text-field",{attrs:{type:"number",label:"0-3",disabled:t.timeSheetEditDisabled,min:"0",required:"",outlined:"",dense:"","persistent-hint":""},on:{input:t.calculateBonus},model:{value:t.fuel_bonus_0,callback:function(e){t.fuel_bonus_0=e},expression:"fuel_bonus_0"}})],1),i("v-col",{attrs:{cols:"xl-2"}},[i("v-text-field",{attrs:{type:"number",label:"3-6",disabled:t.timeSheetEditDisabled,min:"0",required:"",outlined:"",dense:"","persistent-hint":""},on:{input:t.calculateBonus},model:{value:t.fuel_bonus_3,callback:function(e){t.fuel_bonus_3=e},expression:"fuel_bonus_3"}})],1),i("v-col",{attrs:{cols:"xl-2"}},[i("v-text-field",{attrs:{type:"number",label:"6+",disabled:t.timeSheetEditDisabled,min:"0",required:"",outlined:"",dense:"","persistent-hint":""},on:{input:t.calculateBonus},model:{value:t.fuel_bonus_6,callback:function(e){t.fuel_bonus_6=e},expression:"fuel_bonus_6"}})],1)],1),i("v-row",[i("v-col",{attrs:{cols:"1.5"}},[i("v-text-field",{attrs:{type:"number","prepend-icon":"mdi-gas-station",label:"Fuel Bonus",disabled:t.timeSheetEditDisabled,outlined:"",dense:""},model:{value:t.const_fuel_bonus,callback:function(e){t.const_fuel_bonus=e},expression:"const_fuel_bonus"}})],1)],1)],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-textarea",{attrs:{outlined:"",label:"Shift comment",disabled:t.timeSheetEditDisabled,"hide-details":"",rows:"2",dense:""},model:{value:t.comment,callback:function(e){t.comment=e},expression:"comment"}})],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-textarea",{attrs:{outlined:"",label:"Driver's comment",disabled:t.timeSheetEditDisabled,"hide-details":"",rows:"2",dense:""},model:{value:t.driver_comment,callback:function(e){t.driver_comment=e},expression:"driver_comment"}})],1)],1)],1)],1)],1),i("v-card",{staticClass:"mt-0 ml-0 mb-0 mr-0",attrs:{color:"grey lighten-4",tile:""}},[i("v-col",[i("v-row",[i("v-col",{staticClass:"pa-1",attrs:{cols:"12",sm:"12",md:"6",lg:"4"}},[i("v-btn",{staticClass:"mr-4 green",attrs:{depressed:"",disabled:this.$v.$invalid||t.localLoading||t.select_time_sheet&&t.select_time_sheet.status==t.STATUS_APPROVED,loading:t.localLoading,width:"100%"},on:{click:t.onApproveSelected}},[i("v-icon",[t._v("mdi-check-outline")]),t._v(" Approve\n                              ")],1)],1),i("v-col",{staticClass:"pa-1",attrs:{cols:"12",sm:"12",md:"6",lg:"4"}},[i("v-btn",{staticClass:"mr-4 red darken-4",attrs:{depressed:"",disabled:this.$v.$invalid||t.localLoading||t.select_time_sheet&&t.select_time_sheet.status==t.STATUS_DISCARDED,loading:t.localLoading,width:"100%"},on:{click:t.onDiscardSelected}},[i("v-icon",[t._v("mdi-delete-outline")]),t._v(" Discard\n                              ")],1)],1),i("v-col",{staticClass:"pa-1",attrs:{cols:"12",sm:"12",md:"6",lg:"4"}},[i("v-btn",{staticClass:"mr-4 red darken-4",attrs:{depressed:"",disabled:t.localLoading||!t.select_time_sheet||t.select_time_sheet.id<=0,loading:t.localLoading,width:"100%"},on:{click:t.onRemoveSelected}},[i("v-icon",[t._v("mdi-close-circle")]),t._v(" Remove\n                              ")],1)],1)],1),!t.select_time_sheet||t.select_time_sheet.status!=t.STATUS_APPROVED&&t.select_time_sheet.status_progress!=t.STATUS_PROGRESS_TIME_APPROVED?t._e():i("v-row",[i("v-col",{staticClass:"pa-1",attrs:{cols:"12",sm:"12",md:"12",lg:"6"}},[i("v-btn",{staticClass:"mr-4 deep-orange",attrs:{depressed:"",disabled:this.$v.$invalid||t.localLoading,loading:t.localLoading,width:"100%"},on:{click:t.onUnapproveTimeSelected}},[i("v-icon",[t._v("mdi-timer-off")]),t._v(" Unapprove Time\n                              ")],1)],1),i("v-col",{staticClass:"pa-1",attrs:{cols:"12",sm:"12",md:"12",lg:"6"}},[i("v-btn",{staticClass:"mr-4 orange",attrs:{depressed:"",disabled:this.$v.$invalid||t.localLoading||t.select_time_sheet.status_progress==t.STATUS_PROGRESS_TIME_APPROVED,loading:t.localLoading,width:"100%"},on:{click:t.onUnapprovePaySelected}},[i("v-icon",[t._v("mdi-steering-off")]),t._v(" Unapprove Pay\n                              ")],1)],1)],1)],1)],1),i("v-card",{staticStyle:{margin:"7px 0px 0px 0px"},attrs:{color:"grey lighten-4",tile:""}},[i("v-col",[i("GmapMap",{ref:"mapRef",staticStyle:{width:"100%",height:"320px"},attrs:{options:{zoomControl:!0,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,rotateControl:!1,fullscreenControl:!0,disableDefaultUi:!1},center:t.map_center,zoom:t.map_zoom,"map-type-id":"terrain"}},[t.map_marker_start?i("GmapMarker",{attrs:{position:t.map_marker_start,title:"Started at: "+t.moment(t.select_time_sheet.driver_start_time?t.select_time_sheet.driver_start_time:t.select_time_sheet.start_time,"HH:mm").format("HH:mm"),icon:{url:t.ICON_FINISH,size:{width:45,height:45,f:"px",b:"px"},scaledSize:{width:45,height:45,f:"px",b:"px"}}}}):t._e(),t.map_marker_finish?i("GmapMarker",{attrs:{position:t.map_marker_finish,title:"Finished at: "+t.moment(t.select_time_sheet.driver_finish_time?t.select_time_sheet.driver_finish_time:t.select_time_sheet.finish_time,"HH:mm").format("HH:mm"),icon:{url:t.ICON_START,size:{width:45,height:45,f:"px",b:"px"},scaledSize:{width:45,height:45,f:"px",b:"px"}}}}):t._e(),t.map_marker_resturant?i("GmapMarker",{attrs:{position:t.map_marker_resturant,title:""+t.getRestaurantNameByID(t.select_time_sheet.restaurant_id)}}):t._e()],1)],1)],1)],1)],1)],1)],1)],1)],1):t._e()],1)}),[],!1,null,"63287dcd",null);e.a=J.exports;D()(J,{VAppBar:k.a,VAutocomplete:w.a,VBtn:C.a,VCard:y.a,VCardText:Y.b,VCardTitle:Y.c,VCol:E.a,VDatePicker:R.a,VDialog:M.a,VDivider:A.a,VForm:L.a,VIcon:P.a,VList:I.a,VListItem:V.a,VListItemContent:O.a,VListItemGroup:q.a,VListItemIcon:F.a,VListItemSubtitle:O.b,VListItemTitle:O.c,VMenu:H.a,VNavigationDrawer:U.a,VRow:B.a,VSelect:N.a,VSpacer:G.a,VTextField:z.a,VTextarea:j.a,VToolbar:W.a,VTooltip:Z.a})},"4e29":function(t,e,i){"use strict";var s=i("1dce"),a=i("b5ae"),r=i("2f62"),o=i("c1df"),n=i.n(o),l=i("c64f"),d=i("2ef0"),c=i("156f"),_={mixins:[s.validationMixin],name:"NewTimesheetRestaurantModal",validations:{restaurant_id:{required:a.required},driver_id:{required:a.required},period_date:{required:a.required},start_time:{required:a.required},finish_time:{required:a.required},comment:{}},data:()=>({readOnly:!1,localLoading:!1,dialog:!1,period_date_max:n()().format("YYYY-MM-DD"),menu_date_picker:!1,timesheet_date_picker:!1,period_date_selected:null,restaurant_selected:void 0,area_selected:void 0,restaurant_id:void 0,driver_id:void 0,period_date:void 0,start_time:void 0,finish_time:void 0,comment:void 0,start_time_was_clean:!1,finish_time_was_clean:!1,restaurant_list:[]}),watch:{period_date:function(t,e){e!=t&&/\d\d\/\d\d\/\d\d\d\d/.test(t)&&(this.$data.period_date_selected=n()(t,"DD/MM/YYYY").format("YYYY-MM-DD"))}},computed:{...Object(r.c)({driver_list:"drivers",timeList:"timeList"}),driverListSearched(){return this.$data.restaurant_id?this.driver_list:[];
//!? need filter drivers by assigned restaurant and aread
},selectDriverErrors(){const t=[];return this.$v.driver_id.$dirty?(!this.$v.driver_id.required&&t.push("Driver is required"),t):t},selectAreaErrors(){const t=[];return this.$v.restaurant_id.$dirty?(!this.$v.restaurant_id.required&&t.push("Restaurant is required"),t):t},periodDateErrors(){const t=[];return this.$v.period_date.$dirty?(!this.$v.period_date.required&&t.push("Date is required."),!n()(this.$data.period_date,"DD/MM/YYYY").isValid()&&t.push("Date invalid format."),t):t},startTimeErrors(){const t=[];return this.$v.start_time.$dirty?(!this.$v.start_time.required&&t.push("Start Time is required."),!n()(this.$data.start_time,"HH:mm").isValid()&&t.push("Start Time invalid format."),t):t},finishTimeErrors(){const t=[];return this.$v.finish_time.$dirty?(!this.$v.finish_time.required&&t.push("Start Time is required."),!n()(this.$data.finish_time,"HH:mm").isValid()&&t.push("Finish Time invalid format."),t):t}},mounted(){let t=JSON.parse(localStorage.getItem("user")),e=[];d.each(t.restaurants,i=>{e.push({id:i.id,name:i.name,contact_name:i.contact_name,email:t.email,type:c.c})}),this.restaurant_list=e},methods:{submit(){if(this.$v.$touch(),!this.$v.$invalid){const t={shift_id:null,restaurant_id:this.$data.restaurant_id,driver_id:this.$data.driver_id,status:l.c,status_progress:l.i,period_date:n()(this.$data.period_date,"DD/MM/YYYY").format("YYYY-MM-DD"),start_time:this.$data.start_time,finish_time:this.$data.finish_time,meal_time:0,rest_time:0,cost_bonus:0,const_fuel_bonus:0,comment:this.$data.comment};this.localLoading=!0,this.$store.dispatch("createNewTimesheet",t).then(()=>{}).finally(()=>{this.localLoading=!1,this.clear(),this.dialog=!1})}},periodDateSelect:function(){this.$data.period_date=n()(this.$data.period_date_selected,"YYYY-MM-DD").format("DD/MM/YYYY"),this.$data.timesheet_date_picker=!1},getPeriodDateText:function(t){return n()(t,"YYYY-MM-DD").format("DD/MM/YYYY")},clear(){this.$v.$reset(),this.area_selected=void 0,this.restaurant_id=void 0,this.driver_id=void 0,this.start_time="",this.finish_time="",this.period_date=void 0},onStartTimeFocused:function(){this.start_time||(this.start_time=this.timeToApproximation(n()().format("HH:mm")),this.start_time_was_clean=!0)},onStartTimeChanged:function(){this.$v.start_time.$touch(),this.start_time_was_clean=!1},onStartTimeBlur:function(){this.start_time_was_clean&&(this.start_time=void 0),this.$v.start_time.$touch()},onFinishTimeFocused:function(){this.finish_time||(this.finish_time=this.timeToApproximation(n()().format("HH:mm")),this.finish_time_was_clean=!0)},onFinishTimeChanged:function(){this.$v.finish_time.$touch(),this.finish_time_was_clean=!1},onFinishTimeBlur:function(){this.finish_time_was_clean&&(this.finish_time=void 0),this.$v.finish_time.$touch()},timeToApproximation:function(t){let e=n()(t,"HH:mm:ss");if(!e.isValid())return t;let i=d.find(this.timeList,t=>(n()(t.value,"HH:mm")-e)/36e5>-.125);return i?i.value:t}}},m=i("2877"),u=i("6544"),h=i.n(u),v=i("c6a6"),p=i("8336"),f=i("b0af"),b=i("99d9"),g=i("62ad"),S=i("2e4b"),$=i("169a"),x=i("4bd4"),T=i("132d"),D=i("e449"),k=i("0fd9"),w=i("8654"),C=i("a844"),y=Object(m.a)(_,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-dialog",{attrs:{width:"700px"},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on;return[i("v-btn",t._g({},s),[i("v-icon",{attrs:{left:""}},[t._v("mdi-plus")]),t._v("Add Time Sheet\n        ")],1)]}}]),model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[t.dialog?i("v-card",[i("v-card-title",[i("span",{staticClass:"headline"},[t._v("Add a New Time Sheet")]),i("div",{staticClass:"dialog-closeBtn",on:{click:function(e){t.dialog=!1}}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-close")])],1)]),i("v-card-text",[i("v-row",{attrs:{align:"stretch"}},[i("v-col",[i("v-form",{ref:"form"},[i("v-row",[i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("v-autocomplete",{attrs:{"prepend-icon":"mdi-map-marker",label:"Select Restaurant","item-text":"name","item-value":"id",items:t.restaurant_list,"error-messages":t.selectAreaErrors,required:"",dense:""},on:{blur:function(e){return t.$v.restaurant_id.$touch()}},model:{value:t.restaurant_id,callback:function(e){t.restaurant_id=e},expression:"restaurant_id"}})],1),i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("v-autocomplete",{attrs:{"prepend-icon":"mdi-account",label:"Select driver","item-text":"full_name","item-value":"id",disabled:!t.restaurant_id,items:t.driverListSearched,"error-messages":t.selectDriverErrors,required:"",dense:""},on:{blur:function(e){return t.$v.driver_id.$touch()}},model:{value:t.driver_id,callback:function(e){t.driver_id=e},expression:"driver_id"}})],1),i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("v-menu",{attrs:{transition:"scale-transition","close-on-content-click":!1,"nudge-width":200,"max-width":"346px","offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on;return[i("v-text-field",t._g({attrs:{"clear-icon":"mdi-close","prepend-icon":"mdi-calendar",clearable:"",outlined:"",label:"Date*",hint:"22/11/2019",required:"","error-messages":t.periodDateErrors,autocomplete:"off"},on:{input:function(e){return t.$v.period_date.$touch()},blur:function(e){return t.$v.period_date.$touch()}},model:{value:t.period_date,callback:function(e){t.period_date=e},expression:"period_date"}},s))]}}],null,!1,2937805055),model:{value:t.timesheet_date_picker,callback:function(e){t.timesheet_date_picker=e},expression:"timesheet_date_picker"}},[i("v-card",{attrs:{"max-width":"346px"}},[i("v-date-picker",{attrs:{scrollable:"",actions:"","full-width":"","first-day-of-week":"1","title-date-format":t.getPeriodDateText,max:t.period_date_max},on:{"click:date":t.periodDateSelect},model:{value:t.period_date_selected,callback:function(e){t.period_date_selected=e},expression:"period_date_selected"}})],1)],1)],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-autocomplete",{staticClass:"hide-time-picker-indicator",attrs:{type:"text","menu-props":"auto, overflowY","clear-icon":"mdi-close","prepend-icon":"mdi-clock-outline",clearable:"",outlined:"",label:"Start Time*",hint:"Example: 08:00",required:"",items:t.timeList,"item-text":"name","item-value":"value","error-messages":t.startTimeErrors,"open-on-clear":"",dense:""},on:{focus:t.onStartTimeFocused,input:t.onStartTimeChanged,blur:t.onStartTimeBlur},model:{value:t.start_time,callback:function(e){t.start_time=e},expression:"start_time"}})],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[i("v-autocomplete",{staticClass:"hide-time-picker-indicator",attrs:{type:"text","menu-props":"auto, overflowY","clear-icon":"mdi-close","prepend-icon":"mdi-clock-outline",clearable:"",outlined:"",label:"Finish Time*",hint:"Example: 18:30",required:"",items:t.timeList,"item-text":"name","item-value":"value","error-messages":t.finishTimeErrors,"open-on-clear":"",dense:""},on:{focus:t.onFinishTimeFocused,input:t.onFinishTimeChanged,blur:t.onFinishTimeBlur},model:{value:t.finish_time,callback:function(e){t.finish_time=e},expression:"finish_time"}})],1),i("v-col",{staticClass:"pb-0",attrs:{cols:"12",sm:"12"}},[i("v-textarea",{attrs:{outlined:"",label:"Comment"},model:{value:t.comment,callback:function(e){t.comment=e},expression:"comment"}})],1)],1),i("div",{staticClass:"d-flex justify-center"},[i("v-btn",{staticClass:"mr-4 primary",attrs:{depressed:"",disabled:this.$v.$invalid||t.localLoading,loading:t.localLoading},on:{click:t.submit}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-upload")]),t._v("Create "),i("span",{staticClass:"hidden-sm-and-down"},[t._v("Time Sheet")])],1),i("v-btn",{staticClass:"mr-4",attrs:{loading:t.localLoading,depressed:""},on:{click:t.clear}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-rotate-left")]),i("span",{staticClass:"hidden-sm-and-down"},[t._v("Clear")])],1),i("v-btn",{staticClass:"mr-4 warning",attrs:{loading:t.localLoading,depressed:""},on:{click:function(e){t.dialog=!1}}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-cancel")]),t._v("Cancel")],1)],1)],1)],1)],1)],1)],1):t._e()],1)}),[],!1,null,"11eb5e16",null);e.a=y.exports;h()(y,{VAutocomplete:v.a,VBtn:p.a,VCard:f.a,VCardText:b.b,VCardTitle:b.c,VCol:g.a,VDatePicker:S.a,VDialog:$.a,VForm:x.a,VIcon:T.a,VMenu:D.a,VRow:k.a,VTextField:w.a,VTextarea:C.a})},bf0f:function(t,e,i){},d03e:function(t,e,i){"use strict";var s=i("1dce"),a=i("b5ae"),r=i("2f62"),o=i("c1df"),n=i.n(o),l=i("2ef0"),d={mixins:[s.validationMixin],name:"RequestInvoiceModal",props:["periodDateFrom","periodDateTo","restaurantId","driverId","disabled","comission"],validations:{invoice_number:{required:a.required},comission:{required:a.required}},data:()=>({localLoading:!1,dialog:!1,invoice_number:void 0,create_invoice_checkbox:!0,intersection_invoice:void 0,is_initialized:!1}),computed:{...Object(r.c)(["invoice_last_id","invoice_intersection"]),invoiceNumberErrors(){const t=[];return this.$v.invoice_number.$dirty?(!this.$v.invoice_number.required&&t.push("Invoice number is required"),t):t},invoiceComissionErrors(){const t=[];return this.$v.comission.$dirty?(!this.$v.comission.required&&t.push("Сommission is required"),t):t}},updated(){if(!this.$data.dialog)return this.$data.is_initialized=!1,void(this.intersection_invoice=void 0);this.$data.is_initialized||(this.$data.is_initialized=!0,this.intersection_invoice=void 0,this.$store.dispatch("fetchInvoiceCheck",{period_date_from:this.periodDateFrom,period_date_to:this.periodDateTo,restaurant_id:this.restaurantId}).then(()=>{if(this.invoice_number||(this.invoice_number=this.zeros(String(this.invoice_last_id),3)),!l.isEmpty(this.invoice_intersection)){let t=this.invoice_intersection[0];this.intersection_invoice=t}}))},methods:{submit(){if(this.$v.$touch(),!this.$v.$invalid){this.localLoading=!0;var t={invoice_number:this.invoice_number,comission:this.comission,period_date_from:this.periodDateFrom,period_date_to:this.periodDateTo,restaurant_id:this.restaurantId,driver_id:this.driverId};this.create_invoice_checkbox&&(t.create_invoice="1"),this.$store.dispatch("requestInvoice",t).then(()=>{this.create_invoice_checkbox&&this.$emit("invoiceGenerated",""),this.clear(),this.dialog=!1,this.invoice_number=void 0,this.create_invoice_checkbox=!0}).finally(()=>{this.localLoading=!1})}},preview(){if(this.$v.$touch(),!this.$v.$invalid){this.localLoading=!0;var t={invoice_number:this.invoice_number,comission:this.comission,period_date_from:this.periodDateFrom,period_date_to:this.periodDateTo,restaurant_id:this.restaurantId,driver_id:this.driverId};this.$store.dispatch("previewInvoice",t).then(()=>{}).finally(()=>{this.localLoading=!1})}},zeros(t,e){var i=t.length;if(i<e)for(var s=0;s<e-i;s++)t="0"+t;return t},clear(){this.$v.$reset(),this.invoice_number=void 0,this.comission=1.5}},filters:{headerDate:function(t){return n()(t,"YYYY-MM-DD").format("DD/MM/YYYY")}}},c=i("2877"),_=i("6544"),m=i.n(_),u=i("0798"),h=i("8336"),v=i("b0af"),p=i("99d9"),f=i("ac7c"),b=i("62ad"),g=i("169a"),S=i("4bd4"),$=i("132d"),x=i("0fd9"),T=i("8654"),D=i("3a2f"),k=Object(c.a)(d,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-dialog",{attrs:{width:"400px"},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on.click;return[i("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on;return[i("span",t._g({},t.disabled&&a),[i("v-btn",{attrs:{disabled:t.disabled},on:{click:s}},[i("v-icon",[t._v("mdi-file-document-outline")]),t._v(" Invoice\n                    ")],1)],1)]}}],null,!0)},[i("span",[t._v("Restaurant not selected")])])]}}]),model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[t.dialog?i("v-card",[i("v-card-title",[i("span",{staticClass:"headline"},[t._v("Request invoice")]),i("div",{staticClass:"dialog-closeBtn",on:{click:function(e){t.dialog=!1}}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-close")])],1)]),i("v-card-text",[i("v-row",{attrs:{align:"stretch"}},[i("v-col",[i("v-form",{ref:"form"},[t.intersection_invoice?i("v-row",[i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("v-alert",{attrs:{type:"warning"}},[t._v("\n                                    Found invoice on taken period."),i("br"),t._v("\n                                    Number: "+t._s(t.intersection_invoice.invoice_number)+", period from "+t._s(t._f("headerDate")(t.intersection_invoice.period_date_from))+" to "+t._s(t._f("headerDate")(t.intersection_invoice.period_date_to))+"\n                                ")])],1)],1):t._e(),i("v-row",[i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("v-text-field",{attrs:{outlined:"",label:"Invoice number*",hint:"A000125",required:"","error-messages":t.invoiceNumberErrors,dense:""},on:{input:function(e){return t.$v.invoice_number.$touch()},blur:function(e){return t.$v.invoice_number.$touch()}},model:{value:t.invoice_number,callback:function(e){t.invoice_number=e},expression:"invoice_number"}})],1)],1),i("v-row",[i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("v-text-field",{attrs:{outlined:"",label:"Сommission £ / hour *",hint:"Dream Drivers Сommission",required:"","error-messages":t.invoiceComissionErrors,dense:""},on:{input:function(e){return t.$v.comission.$touch()},blur:function(e){return t.$v.comission.$touch()}},model:{value:t.comission,callback:function(e){t.comission=e},expression:"comission"}})],1)],1),i("v-row",[i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("v-checkbox",{attrs:{label:"Build invoice for restaurant"},model:{value:t.create_invoice_checkbox,callback:function(e){t.create_invoice_checkbox=e},expression:"create_invoice_checkbox"}})],1)],1),i("div",{staticClass:"d-flex justify-center"},[i("v-btn",{staticClass:"mr-4 primary",attrs:{depressed:"",disabled:this.$v.$invalid||t.localLoading,loading:t.localLoading},on:{click:t.preview}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-eye")]),t._v("Preview")],1),i("v-btn",{staticClass:"mr-4 primary",attrs:{depressed:"",disabled:this.$v.$invalid||t.localLoading,loading:t.localLoading},on:{click:t.submit}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-upload")]),t._v("Download")],1),i("v-btn",{staticClass:"mr-4 warning",attrs:{loading:t.localLoading,depressed:""},on:{click:function(e){t.dialog=!1}}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-cancel")]),t._v("Cancel")],1)],1)],1)],1)],1)],1)],1):t._e()],1)}),[],!1,null,"060c7b3e",null);e.a=k.exports;m()(k,{VAlert:u.a,VBtn:h.a,VCard:v.a,VCardText:p.b,VCardTitle:p.c,VCheckbox:f.a,VCol:b.a,VDialog:g.a,VForm:S.a,VIcon:$.a,VRow:x.a,VTextField:T.a,VTooltip:D.a})},fd10:function(t,e,i){"use strict";i("30d0")}}]);