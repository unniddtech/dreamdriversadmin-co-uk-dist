(window.webpackJsonp=window.webpackJsonp||[]).push([["app~069f6afa"],{2660:function(e,s,t){"use strict";var a=t("2f62"),r=t("2ef0"),i=t("1dce"),l=t("b5ae");var n={mixins:[i.validationMixin],name:"EditUserModal",props:["thisUserData"],validations:{firstName:{required:l.required},role:{required:l.required},email:{required:l.required,email:l.email},area_ids:{},restaurant_ids:{}},data:()=>({switch_change_password:!1,showPassword:!1,passwordRules:[e=>!!e||"Please enter your password",e=>e&&e.length>=6||"Password should be at least six symbols long"],userData:null,localLoading:!1,dialog:!1,firstName:"",role:void 0,email:"",lastName:"",password:"",ROLE_ADMIN:10,ROLE_MANAGER:20,role_list:[{id:10,name:"Administrator"},{id:20,name:"Manager"}],area_ids:[],restaurant_ids:[],response_errors:[]}),computed:{...Object(a.c)(["areas","restaurants"]),firstNameErrors(){const e=[];return this.$v.firstName.$dirty?(
/*!this.$v.name.maxLength && errors.push('Name must be at most 10 characters long')*/
!this.$v.firstName.required&&e.push("First name is required."),e):e},roleErrors(){const e=[];return this.$v.role.$dirty?(!this.$v.role.required&&e.push("Role is required."),e):e},emailErrors(){const e=[];if(!this.$v.email.$dirty)return e;!this.$v.email.email&&e.push("Must be valid e-mail"),!this.$v.email.required&&e.push("E-mail is required");let s=r.get(this.response_errors,"email",[]);return r.each(s,s=>e.push(s)),e},selectAreaErrors(){const e=[];return this.$v.area_ids.$dirty,e},selectRestaurantErrors(){const e=[];return this.$v.restaurant_ids.$dirty,e},areasList(){return this.areas},restaurantsList(){return 0==this.area_ids.length?[]:r.filter(this.restaurants,e=>-1!==this.area_ids.indexOf(+e.area_id))}},mounted(){this.userData=this.thisUserData,this.id=this.thisUserData.id,this.firstName=this.thisUserData.first_name,this.lastName=this.thisUserData.last_name,this.role=this.thisUserData.role,this.email=this.thisUserData.email,this.area_ids=r.map(this.thisUserData.area_ids,e=>+e.area_id),this.restaurant_ids=r.map(this.thisUserData.restaurant_ids,e=>+e.restaurant_id)},methods:{...Object(a.b)("user",["editUser"]),onChangeArea(){let e=r.map(this.restaurantsList,e=>e.id);this.restaurant_ids=r.intersection(e,this.restaurant_ids)},onChangeRestaurant(){},cancel(){this.id=this.thisUserData.id,this.firstName=this.thisUserData.first_name,this.lastName=this.thisUserData.last_name,this.role=this.thisUserData.role,this.email=this.thisUserData.email,this.area_ids=r.map(this.thisUserData.area_ids,e=>+e.area_id),this.restaurant_ids=r.map(this.thisUserData.restaurant_ids,e=>+e.restaurant_id),this.dialog=!1},submit(){if(this.localLoading=!0,this.dialog=!0,this.$v.$touch(),!this.$v.$invalid){const e={id:this.id,first_name:this.firstName,last_name:this.lastName,role:this.role,email:this.email,area_ids:this.area_ids,restaurant_ids:this.restaurant_ids};this.switch_change_password&&(e.password=this.password),this.editUser(e).then(()=>{this.dialog=!1,this.password="",this.switch_change_password=!1,this.$emit("userUpdated","")}).catch(e=>{this.response_errors=e}).finally(()=>{this.localLoading=!1})}}}},o=t("2877"),d=t("6544"),c=t.n(d),u=t("c6a6"),h=t("8336"),m=t("b0af"),v=t("99d9"),p=t("62ad"),_=t("a523"),f=t("169a"),b=t("4bd4"),g=t("132d"),w=t("0fd9"),$=t("b974"),x=t("b73d"),N=t("8654"),C=Object(o.a)(n,(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",[t("v-dialog",{attrs:{width:"700px"},scopedSlots:e._u([{key:"activator",fn:function(s){var a=s.on;return[t("span",e._g({},a),[e._t("default")],2)]}}],null,!0),model:{value:e.dialog,callback:function(s){e.dialog=s},expression:"dialog"}},[t("v-card",[t("v-card-title",[t("span",{staticClass:"headline"},[e._v("Edit User")]),t("div",{staticClass:"dialog-closeBtn",on:{click:function(s){e.dialog=!1}}},[t("v-icon",{attrs:{left:""}},[e._v("mdi-close")])],1)]),t("v-card-text",[t("v-container",[t("v-form",{ref:"form"},[t("v-row",[t("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[t("v-text-field",{attrs:{"clear-icon":"mdi-close",clearable:"",outlined:"",label:"First Name*",hint:"enter first name",required:"","error-messages":e.firstNameErrors},on:{input:function(s){return e.$v.firstName.$touch()},blur:function(s){return e.$v.firstName.$touch()}},model:{value:e.firstName,callback:function(s){e.firstName=s},expression:"firstName"}})],1),t("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[t("v-text-field",{attrs:{"clear-icon":"mdi-close",clearable:"",outlined:"",label:"Last Name",hint:"enter a last name"},model:{value:e.lastName,callback:function(s){e.lastName=s},expression:"lastName"}})],1),t("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[t("v-autocomplete",{attrs:{outlined:"",dense:"",label:"Role",items:e.role_list,"item-text":"name","item-value":"id",hint:"Select user role",required:"","error-messages":e.roleErrors},on:{input:function(s){return e.$v.role.$touch()},blur:function(s){return e.$v.role.$touch()}},model:{value:e.role,callback:function(s){e.role=s},expression:"role"}})],1),t("v-col",{attrs:{cols:"12",sm:"12"}},[t("v-text-field",{attrs:{"clear-icon":"mdi-close",clearable:"",outlined:"",label:"User Email*",required:"","error-messages":e.emailErrors},on:{input:function(s){return e.$v.email.$touch()},blur:function(s){return e.$v.email.$touch()}},model:{value:e.email,callback:function(s){e.email=s},expression:"email"}})],1),e.role==e.ROLE_MANAGER?t("v-col",{staticClass:"area-select",attrs:{cols:"12",sm:"12"}},[t("v-select",{attrs:{outlined:"",label:"Areas Assigned to*",multiple:"",chips:"","deletable-chips":"",hint:"leave blank not to assign driver to any areas","persistent-hint":"",items:e.areasList,"item-text":"name","item-value":"id","error-messages":e.selectAreaErrors},on:{change:e.onChangeArea,blur:function(s){return e.$v.area_ids.$touch()}},model:{value:e.area_ids,callback:function(s){e.area_ids=s},expression:"area_ids"}})],1):e._e(),e.role==e.ROLE_MANAGER?t("v-col",{staticClass:"drivers_resturants-select",attrs:{cols:"12",sm:"12"}},[t("v-select",{attrs:{outlined:"",label:"Area's Restaurants Assigned to",multiple:"",chips:"","deletable-chips":"",hint:"if leave blank driver to be assigned to all Area's restaurants","persistent-hint":"",items:e.restaurantsList,"item-text":"name","item-value":"id",disabled:0==e.area_ids.length,"error-messages":e.selectRestaurantErrors},on:{change:e.onChangeRestaurant,blur:function(s){return e.$v.restaurant_ids.$touch()}},model:{value:e.restaurant_ids,callback:function(s){e.restaurant_ids=s},expression:"restaurant_ids"}})],1):e._e(),t("v-col",{attrs:{cols:"12",sm:"12"}},[t("v-switch",{attrs:{label:"Change Password"},model:{value:e.switch_change_password,callback:function(s){e.switch_change_password=s},expression:"switch_change_password"}})],1),e.switch_change_password?t("v-col",{attrs:{cols:"12",sm:"12"}},[t("v-text-field",{attrs:{"append-icon":e.showPassword?"mdi-eye":"mdi-eye-off",type:e.showPassword?"text":"password","clear-icon":"mdi-close",clearable:"",outlined:"",name:"password",label:"Password",rules:e.passwordRules,counter:12},on:{"click:append":function(s){e.showPassword=!e.showPassword}},model:{value:e.password,callback:function(s){e.password=s},expression:"password"}})],1):e._e()],1),t("div",{staticClass:"d-flex justify-center"},[t("v-btn",{staticClass:"mr-4 primary",attrs:{depressed:"",disabled:this.$v.$invalid||e.localLoading,loading:e.localLoading},on:{click:e.submit}},[t("v-icon",{attrs:{left:""}},[e._v("mdi-check-box-outline")]),e._v("\n                Accept Changes\n              ")],1),t("v-btn",{staticClass:"warning",attrs:{depressed:"",loading:e.localLoading},on:{click:e.cancel}},[t("v-icon",{attrs:{left:""}},[e._v("mdi-cancel")]),e._v("\n                Cancel\n              ")],1)],1)],1)],1)],1)],1)],1)],1)}),[],!1,null,"30a3c5de",null),E=C.exports;c()(C,{VAutocomplete:u.a,VBtn:h.a,VCard:m.a,VCardText:v.b,VCardTitle:v.c,VCol:p.a,VContainer:_.a,VDialog:f.a,VForm:b.a,VIcon:g.a,VRow:w.a,VSelect:$.a,VSwitch:x.a,VTextField:N.a});var A=t("bc3a"),y=t.n(A);var k={mixins:[i.validationMixin],name:"NewUserModal",validations:{firstName:{required:l.required},role:{required:l.required},email:{required:l.required,email:l.email},area_ids:{},restaurant_ids:{}},data:()=>({switch_change_password:!1,showPassword:!1,passwordRules:[e=>!!e||"Please enter your password",e=>e&&e.length>=6||"Password should be at least six symbols long"],localLoading:!1,dialog:!1,firstName:"",role:void 0,email:"",lastName:"",password:"",ROLE_ADMIN:10,ROLE_MANAGER:20,role_list:[{id:10,name:"Administrator"},{id:20,name:"Manager"}],area_ids:[],restaurant_ids:[],response_errors:[]}),computed:{...Object(a.c)(["areas","restaurants"]),firstNameErrors(){const e=[];return this.$v.firstName.$dirty?(
/*!this.$v.name.maxLength && errors.push('Name must be at most 10 characters long')*/
!this.$v.firstName.required&&e.push("First name is required."),e):e},roleErrors(){const e=[];return this.$v.role.$dirty?(!this.$v.role.required&&e.push("Role is required."),e):e},emailErrors(){const e=[];if(!this.$v.email.$dirty)return e;!this.$v.email.email&&e.push("Must be valid e-mail"),!this.$v.email.required&&e.push("E-mail is required");let s=r.get(this.response_errors,"email",[]);return r.each(s,s=>e.push(s)),e},selectAreaErrors(){const e=[];return this.$v.area_ids.$dirty,e},selectRestaurantErrors(){const e=[];return this.$v.restaurant_ids.$dirty,e},areasList(){return this.areas},restaurantsList(){return 0==this.area_ids.length?[]:r.filter(this.restaurants,e=>-1!==this.area_ids.indexOf(+e.area_id))}},methods:{...Object(a.b)("user",["createNewUser"]),onChangeArea(){let e=r.map(this.restaurantsList,e=>e.id);this.restaurant_ids=r.intersection(e,this.restaurant_ids)},onChangeRestaurant(){},submit(){let e=JSON.parse(localStorage.getItem("user"));if(this.localLoading=!0,this.dialog=!0,this.$v.$touch(),!this.$v.$invalid){const s={first_name:this.firstName,last_name:this.lastName,role:this.role,email:this.email,area_ids:this.area_ids,restaurant_ids:this.restaurant_ids};this.switch_change_password&&(s.password=this.password),this.createNewUser({payload:s}).then(s=>{this.dialog=!1,this.clear(),s.restCredentials.link=""+this.appConfig.app_url,y.a.post(this.appConfig.app_url+"/api/sendEmailUser",s.restCredentials,{headers:{"X-Requested-With":"XMLHttpRequest",Authorization:"Bearer "+e.access_token}}).then(e=>{console.log(e)})}).catch(e=>{this.response_errors=e}).finally(()=>{this.localLoading=!1})}},clear(){this.$v.$reset(),this.firstName="",this.role=void 0,this.email="",this.lastName="",this.password="",this.switch_change_password=!1,this.area_ids=[],this.restaurant_ids=[]}}},L=Object(o.a)(k,(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("v-dialog",{attrs:{width:"700px"},scopedSlots:e._u([{key:"activator",fn:function(s){var a=s.on;return[t("span",e._g({},a),[e._t("default")],2)]}}],null,!0),model:{value:e.dialog,callback:function(s){e.dialog=s},expression:"dialog"}},[t("v-card",[t("v-card-title",[t("span",{staticClass:"headline"},[e._v("Create Administrator")]),t("div",{staticClass:"dialog-closeBtn",on:{click:function(s){e.dialog=!1}}},[t("v-icon",{attrs:{left:""}},[e._v("mdi-close")])],1)]),t("v-card-text",[t("v-container",[t("v-form",{ref:"form"},[t("v-row",[t("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[t("v-text-field",{attrs:{"clear-icon":"mdi-close",clearable:"",outlined:"",label:"First Name*",hint:"enter first name",required:"","error-messages":e.firstNameErrors},on:{input:function(s){return e.$v.firstName.$touch()},blur:function(s){return e.$v.firstName.$touch()}},model:{value:e.firstName,callback:function(s){e.firstName=s},expression:"firstName"}})],1),t("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[t("v-text-field",{attrs:{"clear-icon":"mdi-close",clearable:"",outlined:"",label:"Last Name",hint:"enter a last name"},model:{value:e.lastName,callback:function(s){e.lastName=s},expression:"lastName"}})],1),t("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[t("v-autocomplete",{attrs:{outlined:"",dense:"",label:"Role",items:e.role_list,"item-text":"name","item-value":"id",hint:"Select user role",required:"","error-messages":e.roleErrors},on:{input:function(s){return e.$v.role.$touch()},blur:function(s){return e.$v.role.$touch()}},model:{value:e.role,callback:function(s){e.role=s},expression:"role"}})],1),t("v-col",{attrs:{cols:"12",sm:"12"}},[t("v-text-field",{attrs:{"clear-icon":"mdi-close",clearable:"",outlined:"",label:"User Email*",required:"","error-messages":e.emailErrors},on:{input:function(s){return e.$v.email.$touch()},blur:function(s){return e.$v.email.$touch()}},model:{value:e.email,callback:function(s){e.email=s},expression:"email"}})],1),e.role==e.ROLE_MANAGER?t("v-col",{staticClass:"area-select",attrs:{cols:"12",sm:"12"}},[t("v-select",{attrs:{outlined:"",label:"Areas Assigned to*",multiple:"",chips:"","deletable-chips":"",hint:"leave blank not to assign driver to any areas","persistent-hint":"",items:e.areasList,"item-text":"name","item-value":"id","error-messages":e.selectAreaErrors},on:{change:e.onChangeArea,blur:function(s){return e.$v.area_ids.$touch()}},model:{value:e.area_ids,callback:function(s){e.area_ids=s},expression:"area_ids"}})],1):e._e(),e.role==e.ROLE_MANAGER?t("v-col",{staticClass:"drivers_resturants-select",attrs:{cols:"12",sm:"12"}},[t("v-select",{attrs:{outlined:"",label:"Area's Restaurants Assigned to",multiple:"",chips:"","deletable-chips":"",hint:"if leave blank driver to be assigned to all Area's restaurants","persistent-hint":"",items:e.restaurantsList,"item-text":"name","item-value":"id",disabled:0==e.area_ids.length,"error-messages":e.selectRestaurantErrors},on:{change:e.onChangeRestaurant,blur:function(s){return e.$v.restaurant_ids.$touch()}},model:{value:e.restaurant_ids,callback:function(s){e.restaurant_ids=s},expression:"restaurant_ids"}})],1):e._e(),t("v-col",{attrs:{cols:"12",sm:"12"}},[t("v-switch",{attrs:{label:"Change Password"},model:{value:e.switch_change_password,callback:function(s){e.switch_change_password=s},expression:"switch_change_password"}})],1),e.switch_change_password?t("v-col",{attrs:{cols:"12",sm:"12"}},[t("v-text-field",{attrs:{"append-icon":e.showPassword?"mdi-eye":"mdi-eye-off",type:e.showPassword?"text":"password","clear-icon":"mdi-close",clearable:"",outlined:"",name:"password",label:"Password",rules:e.passwordRules,counter:12},on:{"click:append":function(s){e.showPassword=!e.showPassword}},model:{value:e.password,callback:function(s){e.password=s},expression:"password"}})],1):e._e()],1),t("div",{staticClass:"d-flex justify-center"},[t("v-btn",{staticClass:"mr-4 primary",attrs:{depressed:"",disabled:this.$v.$invalid||e.localLoading,loading:e.localLoading},on:{click:e.submit}},[e._v("Create\n            ")]),t("v-btn",{staticClass:"warning",attrs:{loading:e.localLoading,depressed:""},on:{click:e.clear}},[t("v-icon",{attrs:{left:""}},[e._v("mdi-cancel")]),e._v("\n              Clear\n            ")],1)],1)],1)],1)],1)],1)],1)}),[],!1,null,"61c70e25",null),V=L.exports;c()(L,{VAutocomplete:u.a,VBtn:h.a,VCard:m.a,VCardText:v.b,VCardTitle:v.c,VCol:p.a,VContainer:_.a,VDialog:f.a,VForm:b.a,VIcon:g.a,VRow:w.a,VSelect:$.a,VSwitch:x.a,VTextField:N.a});var R={name:"Users",components:{"edit-user-modal":E,"new-user-modal":V},data:()=>({localLoading:!1,searchData:null}),mounted(){this.fetchUsers(),this.fetchAreas(),this.fetchRestaurants()},created(){},computed:{...Object(a.c)("user",{users:"users"}),usersSearched(){let e=this.users;return r.isEmpty(this.searchData)||(e=r.filter(e,e=>-1!==e.full_name.indexOf(this.searchData)||-1!==e.email.toLowerCase().indexOf(this.searchData))),e}},methods:{...Object(a.b)("user",["fetchUsers","deleteUser"]),...Object(a.b)(["fetchAreas","fetchRestaurants"]),onDeleteUser(e){confirm("Remove user "+e.full_name+"?")&&(this.localLoading=!0,this.deleteUser(e).then(()=>{}).finally(()=>{this.localLoading=!1}))},clearSearch(){this.searchData=null},editedUser(){this.clearSearch()}}},U=t("0e8f"),D=t("8860"),q=t("da13"),O=t("5d23"),S=t("e449"),M=t("1f4f"),P=t("2fa4"),j=Object(o.a)(R,(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("v-container",[t("div",[t("v-flex",[t("v-row",[t("h1",{staticClass:"page-title"},[e._v("Administrators")]),t("v-spacer",{staticClass:"line"}),t("hr"),t("new-user-modal",[t("v-btn",{staticClass:"primary dropdown-menu-activator",attrs:{tile:"",small:"",depressed:""}},[t("v-icon",{attrs:{left:""}},[e._v("mdi-plus")]),e._v("Add User\n          ")],1)],1)],1)],1),t("v-row",[t("v-col",{staticClass:"col-sm-8 pl-0"}),t("v-col",{staticClass:"col-sm-4 pr-0"},[t("v-text-field",{attrs:{solo:"","hide-details":"","prepend-inner-icon":"mdi-magnify",label:"Search",clearable:""},model:{value:e.searchData,callback:function(s){e.searchData=s},expression:"searchData"}})],1)],1),t("v-card",{attrs:{loading:e.localLoading}},[t("v-simple-table",[t("thead",[t("tr",[t("th",{staticClass:"text-left"},[e._v("Name")]),t("th",{staticClass:"text-left"},[e._v("Email")]),t("th",{staticStyle:{width:"170px"}},[e._v("Actions")])])]),t("tbody",e._l(e.usersSearched,(function(s){return t("tr",{key:s.id},[t("td",[e._v("\n              "+e._s(s.full_name)+"\n            ")]),t("td",[e._v("\n              "+e._s(s.email)+"\n            ")]),t("td",[t("edit-user-modal",{staticStyle:{display:"inline"},attrs:{thisUserData:s},on:{userUpdated:e.editedUser}},[t("v-btn",{attrs:{small:"",color:"primary",tile:"",depressed:""}},[e._v("\n                  Edit User\n                ")])],1),t("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(s){var a=s.on;return[t("v-btn",e._g({staticClass:"primary dropdown-menu-activator",attrs:{tile:"",small:"",depressed:""}},a),[t("v-icon",[e._v("mdi-menu-down")])],1)]}}],null,!0)},[t("v-list",[t("v-list-item",{on:{click:function(t){return e.onDeleteUser(s)}}},[t("v-list-item-title",[e._v("Delete")])],1)],1)],1)],1)])})),0)])],1)],1)])}),[],!1,null,"7de603e4",null);s.a=j.exports;c()(j,{VBtn:h.a,VCard:m.a,VCol:p.a,VContainer:_.a,VFlex:U.a,VIcon:g.a,VList:D.a,VListItem:q.a,VListItemTitle:O.c,VMenu:S.a,VRow:w.a,VSimpleTable:M.a,VSpacer:P.a,VTextField:N.a})},fcb3:function(e,s){e.exports={app_url:"https://api.dreamdriversadmin.co.uk",app_socket_url:"https://dreamdriversadmin.co.uk",GOOGLE_MAP_API_KEY:"AIzaSyDyoWZ1tWbWnX6SLdZMNohAz_FN7bGciCI"}}}]);